
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "content/SSHydro/plot_3b_soil3d_from_weil.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        Click :ref:`here <sphx_glr_download_content_SSHydro_plot_3b_soil3d_from_weil.py>`
        to download the full example code

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_content_SSHydro_plot_3b_soil3d_from_weil.py:


Soil 3d from a Digital Elevation Model (DEM)
============================================

Weill, S., et al. ¬´ Coupling Water Flow and Solute Transport into a Physically-Based Surface‚ÄìSubsurface Hydrological Model ¬ª. 
Advances in Water Resources, vol. 34, no 1, janvier 2011, p. 128‚Äë36. DOI.org (Crossref), 
https://doi.org/10.1016/j.advwatres.2010.10.001.

This example shows how to use pyCATHY object to build a 3d soil properties from a DEM and run the hydrological model.

*Estimated time to run the notebook = 5min*

.. GENERATED FROM PYTHON SOURCE LINES 16-33

.. code-block:: default



    # !! run preprocessor change the DEM shape !
    # dtm_13 does not have the same shape anymore!

    import os

    import matplotlib.pyplot as plt
    import numpy as np
    import pandas as pd

    import pyCATHY.meshtools as mt
    from pyCATHY import cathy_tools
    from pyCATHY.importers import cathy_inputs as in_CT
    from pyCATHY.importers import cathy_outputs as out_CT
    from pyCATHY.plotters import cathy_plots as cplt








.. GENERATED FROM PYTHON SOURCE LINES 34-35

------------------------

.. GENERATED FROM PYTHON SOURCE LINES 35-39

.. code-block:: default

    path2prj = "../SSHydro/"  # add your local path here
    simu = cathy_tools.CATHY(dirName=path2prj, prj_name="soil3d_from_weil", clear_src=True)

    rootpath = os.path.join(simu.workdir + simu.project_name)




.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    üèÅ Initiate CATHY object
    clear src files
    üòü src files not found
    working directory is:/home/ben/Documents/GitHub/BenjMy/pycathy_wrapper/examples/SSHydro/../SSHydro/
    üì• Fetch cathy src files
    üì• Fetch cathy prepro src files
    üì• Fetch cathy inputfiles




.. GENERATED FROM PYTHON SOURCE LINES 40-41

the dimension of the mesh is squared (20,20)

.. GENERATED FROM PYTHON SOURCE LINES 41-78

.. code-block:: default



    dem_mat, str_hd_dem = in_CT.read_dem(
        os.path.join(simu.workdir, simu.project_name, "prepro/dem"),
        os.path.join(simu.workdir, simu.project_name, "prepro/dtm_13.val"),
    )

    simu.show_input(prop="dem")

    maxdepth = 10
    # # linear z depth
    # # -------------------------------------------------------------
    zb = np.linspace(0, maxdepth, 10)
    nstr = len(zb)
    zr = list((np.ones(len(zb))) / (nstr))

    sum(zr)

    # zb = np.geomspace(1e-1, maxdepth, num=15)
    # nstr=len(zb)
    # zr = [abs(zb[0]/maxdepth)]
    # zr.extend(list(abs(np.diff(zb)/maxdepth)))

    # np.shape(dem_mat)
    simu.update_prepo_inputs(
        DEM=dem_mat,
        nstr=nstr,
        zratio=zr,
        base=max(zb),
    )
    fig = plt.figure()
    ax = plt.axes(projection="3d")
    simu.show_input(prop="dem", ax=ax)

    # simu.update_soil()
    simu.create_mesh_vtk(verbose=True)



.. rst-class:: sphx-glr-script-out

.. code-block:: pytb

    Traceback (most recent call last):
      File "/home/ben/Documents/GitHub/BenjMy/pycathy_wrapper/examples/SSHydro/plot_3b_soil3d_from_weil.py", line 76, in <module>
        simu.create_mesh_vtk(verbose=True)
      File "/home/ben/Documents/GitHub/BenjMy/pycathy_wrapper/pyCATHY/cathy_tools.py", line 3164, in create_mesh_vtk
        self.run_processor(IPRT1=3, verbose=verbose)
      File "/home/ben/Documents/GitHub/BenjMy/pycathy_wrapper/pyCATHY/cathy_tools.py", line 542, in run_processor
        self.grid3d = in_CT.read_grid3d(
      File "/home/ben/Documents/GitHub/BenjMy/pycathy_wrapper/pyCATHY/importers/cathy_inputs.py", line 518, in read_grid3d
        grid3d_file = open(os.path.join(project_name, "output/grid3d"), "r")
    FileNotFoundError: [Errno 2] No such file or directory: '/home/ben/Documents/GitHub/BenjMy/pycathy_wrapper/examples/SSHydro/../SSHydro/soil3d_from_weil/output/grid3d'




.. GENERATED FROM PYTHON SOURCE LINES 79-84

.. code-block:: default

    simu.update_zone()

    layers = {1: [0, 2], 2: [2, 6], 3: [6, 10]}
    zone3d_flag = mt.map_layers_2_DEM(layers, simu.DEM, simu.zone, simu.dem_parameters)


.. GENERATED FROM PYTHON SOURCE LINES 85-98

.. code-block:: default


    SPP_map = {
        "PERMX": [0.000188] * 3,
        "PERMY": [0.000188] * 3,
        "PERMZ": [0.000188] * 3,
        "ELSTOR": [1e-05] * 3,
        "POROS": [0.55, 0.65, 0.5],
        "VGNCELL": [1.46, 1.46, 1.46],
        "VGRMCCELL": [0.15, 0.15, 0.15],
        "VGPSATCELL": [0.03125] * 3,
    }



.. GENERATED FROM PYTHON SOURCE LINES 99-106

.. code-block:: default


    simu.update_soil(
        SPP_map=SPP_map,
        zone3d=zone3d_flag,
    )



.. GENERATED FROM PYTHON SOURCE LINES 107-112

.. code-block:: default

    simu.update_zone()

    layers = {1: [0, 2], 2: [2, 100]}
    zone3d_flag = mt.map_layers_2_DEM(layers, simu.DEM, simu.zone, simu.dem_parameters)


.. GENERATED FROM PYTHON SOURCE LINES 113-126

.. code-block:: default


    SPP_map = {
        "PERMX": [0.000188] * 3,
        "PERMY": [0.000188] * 3,
        "PERMZ": [0.000188] * 3,
        "ELSTOR": [1e-05] * 3,
        "POROS": [0.55, 0.65, 0.5],
        "VGNCELL": [1.46, 1.46, 1.46],
        "VGRMCCELL": [0.15, 0.15, 0.15],
        "VGPSATCELL": [0.03125] * 3,
    }



.. GENERATED FROM PYTHON SOURCE LINES 127-134

.. code-block:: default


    simu.update_soil(
        SPP_map=SPP_map,
        zone3d=zone3d_flag,
    )



.. GENERATED FROM PYTHON SOURCE LINES 135-137

.. code-block:: default


    simu.run_processor(IPRT1=2, verbose=True)


.. rst-class:: sphx-glr-timing

   **Total running time of the script:** ( 0 minutes  17.962 seconds)


.. _sphx_glr_download_content_SSHydro_plot_3b_soil3d_from_weil.py:


.. only :: html

 .. container:: sphx-glr-footer
    :class: sphx-glr-footer-example



  .. container:: sphx-glr-download sphx-glr-download-python

     :download:`Download Python source code: plot_3b_soil3d_from_weil.py <plot_3b_soil3d_from_weil.py>`



  .. container:: sphx-glr-download sphx-glr-download-jupyter

     :download:`Download Jupyter notebook: plot_3b_soil3d_from_weil.ipynb <plot_3b_soil3d_from_weil.ipynb>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
