
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "content/SSHydro/plot_3_meshing_from_weil.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        Click :ref:`here <sphx_glr_download_content_SSHydro_plot_3_meshing_from_weil.py>`
        to download the full example code

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_content_SSHydro_plot_3_meshing_from_weil.py:


Meshing from a Digital Elevation Model (DEM)
============================================

Weill, S., et al. « Coupling Water Flow and Solute Transport into a Physically-Based Surface–Subsurface Hydrological Model ». 
Advances in Water Resources, vol. 34, no 1, janvier 2011, p. 128‑36. DOI.org (Crossref), 
https://doi.org/10.1016/j.advwatres.2010.10.001.

This example shows how to use pyCATHY object to mesh from a DEM and run the hydrological model.

*Estimated time to run the notebook = 5min*

.. GENERATED FROM PYTHON SOURCE LINES 16-33

.. code-block:: default



    # !! run preprocessor change the DEM shape !
    # dtm_13 does not have the same shape anymore!

    import os

    import matplotlib.pyplot as plt
    import numpy as np
    import pandas as pd

    import pyCATHY.meshtools as mt
    from pyCATHY import cathy_tools
    from pyCATHY.importers import cathy_inputs as in_CT
    from pyCATHY.importers import cathy_outputs as out_CT
    from pyCATHY.plotters import cathy_plots as cplt








.. GENERATED FROM PYTHON SOURCE LINES 34-35

------------------------

.. GENERATED FROM PYTHON SOURCE LINES 35-40

.. code-block:: default

    path2prj = "../SSHydro/"  # add your local path here
    simu = cathy_tools.CATHY(dirName=path2prj, prj_name="meshing_from_weil", clear_src=True)

    rootpath = os.path.join(simu.workdir + simu.project_name)





.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    🏁 Initiate CATHY object
    clear src files
    😟 src files not found
    working directory is:/home/ben/Documents/GitHub/BenjMy/pycathy_wrapper/examples/SSHydro/../SSHydro/
    📥 Fetch cathy src files
    📥 Fetch cathy prepro src files
    📥 Fetch cathy inputfiles




.. GENERATED FROM PYTHON SOURCE LINES 45-46

the dimension of the mesh is squared (20,20)

.. GENERATED FROM PYTHON SOURCE LINES 46-72

.. code-block:: default



    dem_mat, str_hd_dem = in_CT.read_dem(
        os.path.join(simu.workdir, simu.project_name, "prepro/dem"),
        os.path.join(simu.workdir, simu.project_name, "prepro/dtm_13.val"),
    )

    fig, ax = plt.subplots(1)
    img = ax.imshow(dem_mat)
    plt.colorbar(img)


    simu.show_input(prop="dem")

    print(dem_mat)

    simu.update_prepo_inputs(
        DEM=dem_mat,
        # N=np.shape(dem_mat)[1],
        # M=np.shape(dem_mat)[0],
    )

    fig = plt.figure()
    ax = plt.axes(projection="3d")
    simu.show_input(prop="dem", ax=ax)
    simu.create_mesh_vtk(verbose=True)



.. rst-class:: sphx-glr-horizontal


    *

      .. image-sg:: /content/SSHydro/images/sphx_glr_plot_3_meshing_from_weil_001.png
         :alt: plot 3 meshing from weil
         :srcset: /content/SSHydro/images/sphx_glr_plot_3_meshing_from_weil_001.png
         :class: sphx-glr-multi-img

    *

      .. image-sg:: /content/SSHydro/images/sphx_glr_plot_3_meshing_from_weil_002.png
         :alt: plot 3 meshing from weil
         :srcset: /content/SSHydro/images/sphx_glr_plot_3_meshing_from_weil_002.png
         :class: sphx-glr-multi-img

    *

      .. image-sg:: /content/SSHydro/images/sphx_glr_plot_3_meshing_from_weil_003.png
         :alt: plot 3 meshing from weil
         :srcset: /content/SSHydro/images/sphx_glr_plot_3_meshing_from_weil_003.png
         :class: sphx-glr-multi-img


.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    🔄 Update hap.in file
    🔄 update dem_parameters file 
    [[1.    0.99  0.98  0.97  0.96  0.95  0.94  0.93  0.92  0.91  0.9   0.89
      0.88  0.87  0.86  0.85  0.84  0.83  0.82  0.81 ]
     [0.975 0.965 0.955 0.945 0.935 0.925 0.915 0.905 0.895 0.885 0.875 0.865
      0.855 0.845 0.835 0.825 0.815 0.805 0.795 0.785]
     [0.95  0.94  0.93  0.92  0.91  0.9   0.89  0.88  0.87  0.86  0.85  0.84
      0.83  0.82  0.81  0.8   0.79  0.78  0.77  0.76 ]
     [0.925 0.915 0.905 0.895 0.885 0.875 0.865 0.855 0.845 0.835 0.825 0.815
      0.805 0.795 0.785 0.775 0.765 0.755 0.745 0.735]
     [0.9   0.89  0.88  0.87  0.86  0.85  0.84  0.83  0.82  0.81  0.8   0.79
      0.78  0.77  0.76  0.75  0.74  0.73  0.72  0.71 ]
     [0.875 0.865 0.855 0.845 0.835 0.825 0.815 0.805 0.795 0.785 0.775 0.765
      0.755 0.745 0.735 0.725 0.715 0.705 0.695 0.685]
     [0.85  0.84  0.83  0.82  0.81  0.8   0.79  0.78  0.77  0.76  0.75  0.74
      0.73  0.72  0.71  0.7   0.69  0.68  0.67  0.66 ]
     [0.825 0.815 0.805 0.795 0.785 0.775 0.765 0.755 0.745 0.735 0.725 0.715
      0.705 0.695 0.685 0.675 0.665 0.655 0.645 0.635]
     [0.8   0.79  0.78  0.77  0.76  0.75  0.74  0.73  0.72  0.71  0.7   0.69
      0.68  0.67  0.66  0.65  0.64  0.63  0.62  0.61 ]
     [0.775 0.765 0.755 0.745 0.735 0.725 0.715 0.705 0.695 0.685 0.675 0.665
      0.655 0.645 0.635 0.625 0.615 0.605 0.595 0.585]
     [0.75  0.74  0.73  0.72  0.71  0.7   0.69  0.68  0.67  0.66  0.65  0.64
      0.63  0.62  0.61  0.6   0.59  0.58  0.57  0.56 ]
     [0.725 0.715 0.705 0.695 0.685 0.675 0.665 0.655 0.645 0.635 0.625 0.615
      0.605 0.595 0.585 0.575 0.565 0.555 0.545 0.535]
     [0.7   0.69  0.68  0.67  0.66  0.65  0.64  0.63  0.62  0.61  0.6   0.59
      0.58  0.57  0.56  0.55  0.54  0.53  0.52  0.51 ]
     [0.675 0.665 0.655 0.645 0.635 0.625 0.615 0.605 0.595 0.585 0.575 0.565
      0.555 0.545 0.535 0.525 0.515 0.505 0.495 0.485]
     [0.65  0.64  0.63  0.62  0.61  0.6   0.59  0.58  0.57  0.56  0.55  0.54
      0.53  0.52  0.51  0.5   0.49  0.48  0.47  0.46 ]
     [0.625 0.615 0.605 0.595 0.585 0.575 0.565 0.555 0.545 0.535 0.525 0.515
      0.505 0.495 0.485 0.475 0.465 0.455 0.445 0.435]
     [0.6   0.59  0.58  0.57  0.56  0.55  0.54  0.53  0.52  0.51  0.5   0.49
      0.48  0.47  0.46  0.45  0.44  0.43  0.42  0.41 ]
     [0.575 0.565 0.555 0.545 0.535 0.525 0.515 0.505 0.495 0.485 0.475 0.465
      0.455 0.445 0.435 0.425 0.415 0.405 0.395 0.385]
     [0.55  0.54  0.53  0.52  0.51  0.5   0.49  0.48  0.47  0.46  0.45  0.44
      0.43  0.42  0.41  0.4   0.39  0.38  0.37  0.36 ]
     [0.525 0.515 0.505 0.495 0.485 0.475 0.465 0.455 0.445 0.435 0.425 0.415
      0.405 0.395 0.385 0.375 0.365 0.355 0.345 0.335]]
    🔄 Update hap.in file
    🔄 Update dtm_13 file
    ─────────────────────────────────────────────────────────────────────────────────────── ⚠ warning messages above ⚠ ────────────────────────────────────────────────────────────────────────────────────────

                                The parm dictionnary is empty
                                Falling back to defaults to update CATHYH
                                This can have consequences !!
                            
    ───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
    🔄 update parm file 
    ─────────────────────────────────────────────────────────────────────────────────────── ⚠ warning messages above ⚠ ────────────────────────────────────────────────────────────────────────────────────────
    ['Adjusting TMAX with respect to time of interests requested\n']
    ───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
    🔄 update dem_parameters file 
    🍳 gfortran compilation
    👟 Run preprocessor

     wbb...

     searching the dtm_13.val input file...
     assigned nodata value =  -9999.0000000000000     

     number of processed cells =         400

     ...wbb completed

     rn...
     csort I...
     ...completed

     depit...
     dem modifications =            0
     dem modifications =            0 (total)
     ...completed

     csort II...
     ...completed

     cca...

     contour curvature threshold value =    9.99999996E+11
     ...completed

     smean...
     mean (min,max) facet slope =  0.052056253 ( 0.020000000, 0.053851648)
     ...completed

     dsf...
     the drainage direction of the outlet cell (           8 ) is used
     ...completed

     hg...
     ...completed

     saving the data in the basin_b/basin_i files...

     ...rn completed

     mrbb...


     Select the header type:
     0) None
     1) ESRI ascii file
     2) GRASS ascii file
     (Ctrl C to exit)

     -> 
     Select the nodata value:
     (Ctrl C to exit)

     -> 
     Select the pointer system:
     1) HAP system
     2) Arc/Gis system
     (Ctrl C to exit)

     ->  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

     dem file

     min value = 0.335000E+00
     max value = 0.100000E+01
     number of cells =   400
     mean value = 0.667500E+00

     writing the output file...

     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

     lakes_map file

     min value =     0
     max value =     0
     number of cells =   400
     mean value =     0.000000

     writing the output file...

     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

     zone file

     min value =     1
     max value =     1
     number of cells =   400
     mean value =     1.000000

     writing the output file...

     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

     dtm_w_1 file

     min value = 0.515524E+00
     max value = 0.100000E+01
     number of cells =   400
     mean value = 0.607575E+00

     writing the output file...

     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

     dtm_w_2 file

     min value = 0.000000E+00
     max value = 0.484476E+00
     number of cells =   400
     mean value = 0.392425E+00

     writing the output file...

     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

     dtm_p_outflow_1 file

     min value =     4
     max value =     8
     number of cells =   400
     mean value =     4.200000

     writing the output file...

     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

     dtm_p_outflow_2 file

     min value =     0
     max value =     9
     number of cells =   400
     mean value =     6.792500

     writing the output file...

     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

     A_inflow file

     min value = 0.000000000000E+00
     max value = 0.997499787031E+02
     number of cells =   400
     mean value = 0.388447785378E+01

     writing the output file...

     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

     dtm_local_slope_1 file

     min value = 0.200000E-01
     max value = 0.500000E-01
     number of cells =   400
     mean value = 0.485000E-01

     writing the output file...

     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

     dtm_local_slope_2 file

     min value = 0.000000E+00
     max value = 0.494975E-01
     number of cells =   400
     mean value = 0.400930E-01

     writing the output file...

     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

     dtm_epl_1 file

     min value = 0.500000E+00
     max value = 0.500000E+00
     number of cells =   400
     mean value = 0.500000E+00

     writing the output file...

     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

     dtm_epl_2 file

     min value = 0.000000E+00
     max value = 0.707107E+00
     number of cells =   400
     mean value = 0.572757E+00

     writing the output file...

     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

     dtm_kSs1_sf_1 file

     min value = 0.240040E+02
     max value = 0.240040E+02
     number of cells =   400
     mean value = 0.240040E+02

     writing the output file...

     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

     dtm_kSs1_sf_2 file

     min value = 0.000000E+00
     max value = 0.240040E+02
     number of cells =   400
     mean value = 0.194432E+02

     writing the output file...

     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

     dtm_Ws1_sf file

     min value = 0.100000E+01
     max value = 0.100000E+01
     number of cells =   400
     mean value = 0.100000E+01

     writing the output file...

     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

     dtm_Ws1_sf_2 file

     min value = 0.000000E+00
     max value = 0.100000E+01
     number of cells =   400
     mean value = 0.810000E+00

     writing the output file...

     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

     dtm_b1_sf file

     min value = 0.000000E+00
     max value = 0.000000E+00
     number of cells =   400
     mean value = 0.000000E+00

     writing the output file...

     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

     dtm_y1_sf file

     min value = 0.000000E+00
     max value = 0.000000E+00
     number of cells =   400
     mean value = 0.000000E+00

     writing the output file...

     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

     dtm_hcID file

     min value =     0
     max value =     0
     number of cells =   400
     mean value =     0.000000

     writing the output file...

     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

     dtm_q_output file

     min value =     0
     max value =     0
     number of cells =   400
     mean value =     0.000000

     writing the output file...

     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

     dtm_nrc file

     min value = 0.100000E+01
     max value = 0.100000E+01
     number of cells =   400
     mean value = 0.100000E+01

     writing the output file...

     ...mrbb completed

     bb2shp...

     writing file river_net.shp

    Note: The following floating-point exceptions are signalling: IEEE_UNDERFLOW_FLAG IEEE_DENORMAL

    🔄 update parm file 
    🛠  Recompile src files [10s]
    🍳 gfortran compilation [21s]
    😔 Cannot find the new processsor
    👟 Run processor
    b'\n\n IPRT1=3: Program terminating after output of X, Y, Z coordinate values\n'
    b''




.. GENERATED FROM PYTHON SOURCE LINES 73-80

.. code-block:: default

    meshfile = rootpath + "/vtk/" + simu.project_name + ".vtk"
    import pyvista as pv

    mesh2plot = pv.read(meshfile)
    mesh2plot.plot(show_edges=True, show_axes=True, show_bounds=True)





.. image-sg:: /content/SSHydro/images/sphx_glr_plot_3_meshing_from_weil_004.png
   :alt: plot 3 meshing from weil
   :srcset: /content/SSHydro/images/sphx_glr_plot_3_meshing_from_weil_004.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 81-86

.. code-block:: default


    simu.update_prepo_inputs(
                               DEM=dem_mat,
    )





.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    🔄 Update hap.in file
    🔄 Update dtm_13 file
    🔄 update dem_parameters file 




.. GENERATED FROM PYTHON SOURCE LINES 87-91

.. code-block:: default

    simu.update_dem_parameters(
                                delta_x=10,
                                )





.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    🔄 update dem_parameters file 




.. GENERATED FROM PYTHON SOURCE LINES 92-100

.. code-block:: default

    simu.update_zone()
    simu.update_veg_map()

    fig = plt.figure()
    ax = plt.axes(projection="3d")
    simu.show_input(prop="dem", ax=ax)
    simu.create_mesh_vtk(verbose=True)




.. image-sg:: /content/SSHydro/images/sphx_glr_plot_3_meshing_from_weil_005.png
   :alt: plot 3 meshing from weil
   :srcset: /content/SSHydro/images/sphx_glr_plot_3_meshing_from_weil_005.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    🔄 update zone file 
    🔄 update dem_parameters file 
    🔄 update parm file 
    🍳 gfortran compilation
    👟 Run preprocessor

     wbb...

     searching the dtm_13.val input file...
     assigned nodata value =  -9999.0000000000000     

     number of processed cells =         400

     ...wbb completed

     rn...
     csort I...
     ...completed

     depit...
     dem modifications =            0
     dem modifications =            0 (total)
     ...completed

     csort II...
     ...completed

     cca...

     contour curvature threshold value =    9.99999996E+11
     ...completed

     smean...
     mean (min,max) facet slope =  0.052056253 ( 0.020000000, 0.053851648)
     ...completed

     dsf...
     the drainage direction of the outlet cell (           8 ) is used
     ...completed

     hg...
     ...completed

     saving the data in the basin_b/basin_i files...

     ...rn completed

     mrbb...


     Select the header type:
     0) None
     1) ESRI ascii file
     2) GRASS ascii file
     (Ctrl C to exit)

     -> 
     Select the nodata value:
     (Ctrl C to exit)

     -> 
     Select the pointer system:
     1) HAP system
     2) Arc/Gis system
     (Ctrl C to exit)

     ->  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

     dem file

     min value = 0.335000E+00
     max value = 0.100000E+01
     number of cells =   400
     mean value = 0.667500E+00

     writing the output file...

     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

     lakes_map file

     min value =     0
     max value =     0
     number of cells =   400
     mean value =     0.000000

     writing the output file...

     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

     zone file

     min value =     1
     max value =     1
     number of cells =   400
     mean value =     1.000000

     writing the output file...

     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

     dtm_w_1 file

     min value = 0.515524E+00
     max value = 0.100000E+01
     number of cells =   400
     mean value = 0.607575E+00

     writing the output file...

     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

     dtm_w_2 file

     min value = 0.000000E+00
     max value = 0.484476E+00
     number of cells =   400
     mean value = 0.392425E+00

     writing the output file...

     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

     dtm_p_outflow_1 file

     min value =     4
     max value =     8
     number of cells =   400
     mean value =     4.200000

     writing the output file...

     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

     dtm_p_outflow_2 file

     min value =     0
     max value =     9
     number of cells =   400
     mean value =     6.792500

     writing the output file...

     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

     A_inflow file

     min value = 0.000000000000E+00
     max value = 0.997499787031E+02
     number of cells =   400
     mean value = 0.388447785378E+01

     writing the output file...

     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

     dtm_local_slope_1 file

     min value = 0.200000E-01
     max value = 0.500000E-01
     number of cells =   400
     mean value = 0.485000E-01

     writing the output file...

     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

     dtm_local_slope_2 file

     min value = 0.000000E+00
     max value = 0.494975E-01
     number of cells =   400
     mean value = 0.400930E-01

     writing the output file...

     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

     dtm_epl_1 file

     min value = 0.500000E+00
     max value = 0.500000E+00
     number of cells =   400
     mean value = 0.500000E+00

     writing the output file...

     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

     dtm_epl_2 file

     min value = 0.000000E+00
     max value = 0.707107E+00
     number of cells =   400
     mean value = 0.572757E+00

     writing the output file...

     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

     dtm_kSs1_sf_1 file

     min value = 0.240040E+02
     max value = 0.240040E+02
     number of cells =   400
     mean value = 0.240040E+02

     writing the output file...

     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

     dtm_kSs1_sf_2 file

     min value = 0.000000E+00
     max value = 0.240040E+02
     number of cells =   400
     mean value = 0.194432E+02

     writing the output file...

     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

     dtm_Ws1_sf file

     min value = 0.100000E+01
     max value = 0.100000E+01
     number of cells =   400
     mean value = 0.100000E+01

     writing the output file...

     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

     dtm_Ws1_sf_2 file

     min value = 0.000000E+00
     max value = 0.100000E+01
     number of cells =   400
     mean value = 0.810000E+00

     writing the output file...

     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

     dtm_b1_sf file

     min value = 0.000000E+00
     max value = 0.000000E+00
     number of cells =   400
     mean value = 0.000000E+00

     writing the output file...

     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

     dtm_y1_sf file

     min value = 0.000000E+00
     max value = 0.000000E+00
     number of cells =   400
     mean value = 0.000000E+00

     writing the output file...

     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

     dtm_hcID file

     min value =     0
     max value =     0
     number of cells =   400
     mean value =     0.000000

     writing the output file...

     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

     dtm_q_output file

     min value =     0
     max value =     0
     number of cells =   400
     mean value =     0.000000

     writing the output file...

     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

     dtm_nrc file

     min value = 0.100000E+01
     max value = 0.100000E+01
     number of cells =   400
     mean value = 0.100000E+01

     writing the output file...

     ...mrbb completed

     bb2shp...

     writing file river_net.shp

    Note: The following floating-point exceptions are signalling: IEEE_UNDERFLOW_FLAG IEEE_DENORMAL

    🔄 update parm file 
    🛠  Recompile src files [29s]
    🍳 gfortran compilation [40s]
    😔 Cannot find the new processsor
    👟 Run processor
    b'\n\n IPRT1=3: Program terminating after output of X, Y, Z coordinate values\n'
    b''




.. GENERATED FROM PYTHON SOURCE LINES 101-110

.. code-block:: default

    meshfile = rootpath + "/vtk/" + simu.project_name + ".vtk"
    import pyvista as pv

    mesh2plot = pv.read(meshfile)
    mesh2plot.plot(show_edges=True, show_axes=True, show_bounds=True)







.. image-sg:: /content/SSHydro/images/sphx_glr_plot_3_meshing_from_weil_006.png
   :alt: plot 3 meshing from weil
   :srcset: /content/SSHydro/images/sphx_glr_plot_3_meshing_from_weil_006.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 111-112

the new dimension of the mesh is rectangle (10,20)

.. GENERATED FROM PYTHON SOURCE LINES 112-127

.. code-block:: default


    dem_crop = dem_mat[0:10, :]
    print("DEM shape is {}".format(np.shape(dem_crop)))

    simu.update_prepo_inputs(
        DEM=dem_crop,
    )

    simu.update_zone()
    simu.update_veg_map()

    fig = plt.figure()
    ax = plt.axes(projection="3d")
    simu.show_input(prop="dem", ax=ax)
    simu.create_mesh_vtk(verbose=True)



.. image-sg:: /content/SSHydro/images/sphx_glr_plot_3_meshing_from_weil_007.png
   :alt: plot 3 meshing from weil
   :srcset: /content/SSHydro/images/sphx_glr_plot_3_meshing_from_weil_007.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    DEM shape is (10, 20)
    🔄 Update hap.in file
    🔄 Update dtm_13 file
    🔄 update dem_parameters file 
    🔄 update zone file 
    🔄 update dem_parameters file 
    🔄 update parm file 
    🍳 gfortran compilation
    👟 Run preprocessor

     wbb...

     searching the dtm_13.val input file...
     assigned nodata value =  -9999.0000000000000     

     number of processed cells =         200

     ...wbb completed

     rn...
     csort I...
     ...completed

     depit...
     dem modifications =            0
     dem modifications =            0 (total)
     ...completed

     csort II...
     ...completed

     cca...

     contour curvature threshold value =    9.99999996E+11
     ...completed

     smean...
     mean (min,max) facet slope =  0.050445386 ( 0.020000000, 0.053851648)
     ...completed

     dsf...
     the drainage direction of the outlet cell (           8 ) is used
     ...completed

     hg...
     ...completed

     saving the data in the basin_b/basin_i files...

     ...rn completed

     mrbb...


     Select the header type:
     0) None
     1) ESRI ascii file
     2) GRASS ascii file
     (Ctrl C to exit)

     -> 
     Select the nodata value:
     (Ctrl C to exit)

     -> 
     Select the pointer system:
     1) HAP system
     2) Arc/Gis system
     (Ctrl C to exit)

     ->  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

     dem file

     min value = 0.585000E+00
     max value = 0.100000E+01
     number of cells =   200
     mean value = 0.792500E+00

     writing the output file...

     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

     lakes_map file

     min value =     0
     max value =     0
     number of cells =   200
     mean value =     0.000000

     writing the output file...

     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

     zone file

     min value =     1
     max value =     1
     number of cells =   200
     mean value =     1.000000

     writing the output file...

     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

     dtm_w_1 file

     min value = 0.515524E+00
     max value = 0.100000E+01
     number of cells =   200
     mean value = 0.651177E+00

     writing the output file...

     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

     dtm_w_2 file

     min value = 0.000000E+00
     max value = 0.484476E+00
     number of cells =   200
     mean value = 0.348823E+00

     writing the output file...

     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

     dtm_p_outflow_1 file

     min value =     4
     max value =     8
     number of cells =   200
     mean value =     4.400000

     writing the output file...

     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

     dtm_p_outflow_2 file

     min value =     0
     max value =     9
     number of cells =   200
     mean value =     6.885000

     writing the output file...

     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

     A_inflow file

     min value = 0.000000000000E+00
     max value = 0.497499945034E+02
     number of cells =   200
     mean value = 0.305322909355E+01

     writing the output file...

     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

     dtm_local_slope_1 file

     min value = 0.200000E-01
     max value = 0.500000E-01
     number of cells =   200
     mean value = 0.470000E-01

     writing the output file...

     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

     dtm_local_slope_2 file

     min value = 0.000000E+00
     max value = 0.494975E-01
     number of cells =   200
     mean value = 0.356382E-01

     writing the output file...

     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

     dtm_epl_1 file

     min value = 0.500000E+00
     max value = 0.500000E+00
     number of cells =   200
     mean value = 0.500000E+00

     writing the output file...

     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

     dtm_epl_2 file

     min value = 0.000000E+00
     max value = 0.707107E+00
     number of cells =   200
     mean value = 0.509117E+00

     writing the output file...

     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

     dtm_kSs1_sf_1 file

     min value = 0.240040E+02
     max value = 0.240040E+02
     number of cells =   200
     mean value = 0.240040E+02

     writing the output file...

     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

     dtm_kSs1_sf_2 file

     min value = 0.000000E+00
     max value = 0.240040E+02
     number of cells =   200
     mean value = 0.172829E+02

     writing the output file...

     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

     dtm_Ws1_sf file

     min value = 0.100000E+01
     max value = 0.100000E+01
     number of cells =   200
     mean value = 0.100000E+01

     writing the output file...

     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

     dtm_Ws1_sf_2 file

     min value = 0.000000E+00
     max value = 0.100000E+01
     number of cells =   200
     mean value = 0.720000E+00

     writing the output file...

     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

     dtm_b1_sf file

     min value = 0.000000E+00
     max value = 0.000000E+00
     number of cells =   200
     mean value = 0.000000E+00

     writing the output file...

     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

     dtm_y1_sf file

     min value = 0.000000E+00
     max value = 0.000000E+00
     number of cells =   200
     mean value = 0.000000E+00

     writing the output file...

     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

     dtm_hcID file

     min value =     0
     max value =     0
     number of cells =   200
     mean value =     0.000000

     writing the output file...

     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

     dtm_q_output file

     min value =     0
     max value =     0
     number of cells =   200
     mean value =     0.000000

     writing the output file...

     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

     dtm_nrc file

     min value = 0.100000E+01
     max value = 0.100000E+01
     number of cells =   200
     mean value = 0.100000E+01

     writing the output file...

     ...mrbb completed

     bb2shp...

     writing file river_net.shp

    Note: The following floating-point exceptions are signalling: IEEE_UNDERFLOW_FLAG IEEE_DENORMAL

    🔄 update parm file 
    🛠  Recompile src files [49s]
    🍳 gfortran compilation [61s]
    😔 Cannot find the new processsor
    👟 Run processor
    b'\n\n IPRT1=3: Program terminating after output of X, Y, Z coordinate values\n'
    b''




.. GENERATED FROM PYTHON SOURCE LINES 128-138

.. code-block:: default

    meshfile = rootpath + "/vtk/" + simu.project_name + ".vtk"
    import pyvista as pv

    mesh2plot = pv.read(meshfile)
    mesh2plot.plot(show_edges=True, show_axes=True, show_bounds=True)








.. image-sg:: /content/SSHydro/images/sphx_glr_plot_3_meshing_from_weil_008.png
   :alt: plot 3 meshing from weil
   :srcset: /content/SSHydro/images/sphx_glr_plot_3_meshing_from_weil_008.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 139-148

.. code-block:: default

    meshfile = rootpath + "/vtk/" + simu.project_name + ".vtk"
    import pyvista as pv

    mesh2plot = pv.read(meshfile)
    mesh2plot.plot(show_edges=True, show_axes=True, show_bounds=True)







.. image-sg:: /content/SSHydro/images/sphx_glr_plot_3_meshing_from_weil_009.png
   :alt: plot 3 meshing from weil
   :srcset: /content/SSHydro/images/sphx_glr_plot_3_meshing_from_weil_009.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 149-163

.. code-block:: default


    simu.update_prepo_inputs(
        DEM=dem_crop,
        xllcorner=1e4,
        yllcorner=4e3,
    )

    simu.update_zone()
    simu.update_veg_map()

    fig = plt.figure()
    ax = plt.axes(projection="3d")
    simu.show_input(prop="dem", ax=ax)
    simu.create_mesh_vtk(verbose=False)



.. image-sg:: /content/SSHydro/images/sphx_glr_plot_3_meshing_from_weil_010.png
   :alt: plot 3 meshing from weil
   :srcset: /content/SSHydro/images/sphx_glr_plot_3_meshing_from_weil_010.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    🔄 Update hap.in file
    🔄 Update dtm_13 file
    🔄 update dem_parameters file 
    🔄 update zone file 
    🔄 update dem_parameters file 
    🔄 update parm file 
    🍳 gfortran compilation
    👟 Run preprocessor
    🔄 update parm file 
    🛠  Recompile src files [69s]
    🍳 gfortran compilation [80s]
    😔 Cannot find the new processsor
    👟 Run processor




.. GENERATED FROM PYTHON SOURCE LINES 164-170

.. code-block:: default

    meshfile = rootpath + "/vtk/" + simu.project_name + ".vtk"
    import pyvista as pv

    mesh2plot = pv.read(meshfile)
    mesh2plot.plot(show_edges=True, show_axes=True, show_bounds=True)




.. image-sg:: /content/SSHydro/images/sphx_glr_plot_3_meshing_from_weil_011.png
   :alt: plot 3 meshing from weil
   :srcset: /content/SSHydro/images/sphx_glr_plot_3_meshing_from_weil_011.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 171-186

.. code-block:: default


    dem_crop_flipy = np.flipud(dem_crop)

    simu.update_prepo_inputs(
        DEM=dem_crop_flipy,
        xllcorner=1e4,
        yllcorner=4e3,
    )

    simu.update_zone()
    simu.update_veg_map()
    fig = plt.figure()
    ax = plt.axes(projection="3d")
    simu.show_input(prop="dem", ax=ax)
    simu.create_mesh_vtk(verbose=False)



.. image-sg:: /content/SSHydro/images/sphx_glr_plot_3_meshing_from_weil_012.png
   :alt: plot 3 meshing from weil
   :srcset: /content/SSHydro/images/sphx_glr_plot_3_meshing_from_weil_012.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    🔄 Update hap.in file
    🔄 Update dtm_13 file
    🔄 update dem_parameters file 
    🔄 update zone file 
    🔄 update dem_parameters file 
    🔄 update parm file 
    🍳 gfortran compilation
    👟 Run preprocessor
    🔄 update parm file 
    🛠  Recompile src files [88s]
    🍳 gfortran compilation [100s]
    😔 Cannot find the new processsor
    👟 Run processor




.. GENERATED FROM PYTHON SOURCE LINES 187-194

.. code-block:: default

    meshfile = rootpath + "/vtk/" + simu.project_name + ".vtk"
    import pyvista as pv

    mesh2plot = pv.read(meshfile)
    mesh2plot.plot(show_edges=True, show_axes=True, show_bounds=True)





.. image-sg:: /content/SSHydro/images/sphx_glr_plot_3_meshing_from_weil_013.png
   :alt: plot 3 meshing from weil
   :srcset: /content/SSHydro/images/sphx_glr_plot_3_meshing_from_weil_013.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 195-218

.. code-block:: default


    dem_crop_3layers = np.flipud(dem_crop)
    maxdepth = 10

    # linear z depth
    # -------------------------------------------------------------
    zb = np.linspace(0, maxdepth, 3)
    nstr = len(zb) - 1
    zr = list((np.ones(len(zb))) / (nstr))


    simu.update_prepo_inputs(
        DEM=dem_crop,
        xllcorner=1e4,
        yllcorner=4e3,
        nstr=nstr,
        zratio=zr,
        base=max(zb),
    )
    fig = plt.figure()
    ax = plt.axes(projection="3d")
    simu.show_input(prop="dem", ax=ax)
    simu.create_mesh_vtk(verbose=False)



.. image-sg:: /content/SSHydro/images/sphx_glr_plot_3_meshing_from_weil_014.png
   :alt: plot 3 meshing from weil
   :srcset: /content/SSHydro/images/sphx_glr_plot_3_meshing_from_weil_014.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    🔄 Update hap.in file
    🔄 Update dtm_13 file
    🔄 update dem_parameters file 
    ─────────────────────────────────────────────────────────────────────────────────────── ⚠ warning messages above ⚠ ────────────────────────────────────────────────────────────────────────────────────────
    The sum of all the layers is not equal to 1 but to 1.5
    ───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
    🍳 gfortran compilation
    👟 Run preprocessor
    🔄 update parm file 
    🛠  Recompile src files [108s]
    🍳 gfortran compilation [120s]
    😔 Cannot find the new processsor
    👟 Run processor




.. GENERATED FROM PYTHON SOURCE LINES 219-226

.. code-block:: default

    meshfile = rootpath + "/vtk/" + simu.project_name + ".vtk"
    import pyvista as pv

    mesh2plot = pv.read(meshfile)
    mesh2plot.plot(show_edges=True, show_axes=True, show_bounds=True)





.. image-sg:: /content/SSHydro/images/sphx_glr_plot_3_meshing_from_weil_015.png
   :alt: plot 3 meshing from weil
   :srcset: /content/SSHydro/images/sphx_glr_plot_3_meshing_from_weil_015.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 227-246

.. code-block:: default


    # the fraction of total grid height that each layer is to occupy
    # log z depth
    # -------------------------------------------------------------
    zb = np.geomspace(1e-1, maxdepth, num=15)
    nstr = len(zb)
    zr = [abs(zb[0] / maxdepth)]
    zr.extend(list(abs(np.diff(zb) / maxdepth)))


    simu.update_prepo_inputs(
        DEM=dem_crop,
        xllcorner=1e4,
        yllcorner=4e3,
        nstr=nstr,
        zratio=zr,
        base=max(zb),
    )
    simu.create_mesh_vtk(verbose=False)




.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    🔄 Update hap.in file
    🔄 Update dtm_13 file
    🔄 update dem_parameters file 
    🍳 gfortran compilation
    👟 Run preprocessor
    🔄 update parm file 
    🛠  Recompile src files [127s]
    🍳 gfortran compilation [138s]
    😔 Cannot find the new processsor
    👟 Run processor




.. GENERATED FROM PYTHON SOURCE LINES 247-254

.. code-block:: default

    meshfile = rootpath + "/vtk/" + simu.project_name + ".vtk"
    import pyvista as pv

    mesh2plot = pv.read(meshfile)
    mesh2plot.plot(show_edges=True, show_axes=True, show_bounds=True)





.. image-sg:: /content/SSHydro/images/sphx_glr_plot_3_meshing_from_weil_016.png
   :alt: plot 3 meshing from weil
   :srcset: /content/SSHydro/images/sphx_glr_plot_3_meshing_from_weil_016.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 255-257

.. code-block:: default


    simu.run_processor(IPRT1=2, verbose=True)




.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    🔄 update parm file 
    🛠  Recompile src files [138s]
    🍳 gfortran compilation [150s]
    😔 Cannot find the new processsor
    👟 Run processor
    b'\n     nsf  (# of seepage faces)               =      0\n'
    b''





.. rst-class:: sphx-glr-timing

   **Total running time of the script:** ( 2 minutes  30.996 seconds)


.. _sphx_glr_download_content_SSHydro_plot_3_meshing_from_weil.py:


.. only :: html

 .. container:: sphx-glr-footer
    :class: sphx-glr-footer-example



  .. container:: sphx-glr-download sphx-glr-download-python

     :download:`Download Python source code: plot_3_meshing_from_weil.py <plot_3_meshing_from_weil.py>`



  .. container:: sphx-glr-download sphx-glr-download-jupyter

     :download:`Download Jupyter notebook: plot_3_meshing_from_weil.ipynb <plot_3_meshing_from_weil.ipynb>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
