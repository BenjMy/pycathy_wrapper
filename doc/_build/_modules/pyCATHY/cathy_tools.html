

<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
        <title>pyCATHY.cathy_tools | pyCATHY v0.1.1</title>
    

    
  <link href="../../_static/css/theme.css" rel="stylesheet">
  <link href="../../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-book-theme.css?digest=84ace793992934648b4de8eed757e5a2" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/jupyter-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/thebelab.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-rendered-html.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/thebelab-helper.js"></script>
    <script src="../../_static/design-tabs.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.1/dist/embed-amd.js"></script>
    <script src="../../_static/sphinx-book-theme.9d8b4a8b9bb19db25eeaddc40d639ba2.js"></script>
    <link rel="shortcut icon" href="../../_static/sphx_glr_pyCATHY_weilletal_thumb.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <!-- Plausible analytics for anonymous usage statistics -->
    <script defer data-domain="fatiando.org" src="https://plausible.io/js/plausible.js"></script>

  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<div class="col-12 col-md-3 bd-sidebar site-navigation " id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/sphx_glr_pyCATHY_weilletal_001.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">pyCATHY <span class="project-release">v0.1.1</span></h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Getting started
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../content/overview.html">
   Overview
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../content/installing.html">
   Installing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../content/citing.html">
   Citing pyCATHY
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Gallery of examples
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../content/SSHydro/index.html">
   Surface subsurface hydrological model
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/SSHydro/plot_1_pyCATHY_weilletal.html">
     Weil et al example
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/SSHydro/plot_2_pyCATHY_inputs.html">
     Input plots
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/SSHydro/plot_3_meshing_from_weil.html">
     Meshing from a Digital Elevation Model (DEM)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/SSHydro/plot_3b_soil3d_from_weil.html">
     Soil 3d from a Digital Elevation Model (DEM)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/SSHydro/plot_4_pyCATHY_outputs.html">
     Output plots
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../content/DA/index.html">
   Data Assimilation
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/DA/plot_Weilletal_sensitivityAnalysis.html">
     Sensitivity analysis
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Reference documentation
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../content/api/api.html">
   API reference: The
   <code class="docutils literal notranslate">
    <span class="pre">
     pyCATHY
    </span>
   </code>
   package
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../content/api/generated/cathy_tools.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       cathy_tools
      </span>
     </code>
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
    <label for="toctree-checkbox-4">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/cathy_tools.CATHY.html">
       cathy_tools.CATHY
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/cathy_tools.OrderedDict.html">
       cathy_tools.OrderedDict
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/cathy_tools.Repo.html">
       cathy_tools.Repo
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/cathy_tools.isfile.html">
       cathy_tools.isfile
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/cathy_tools.join.html">
       cathy_tools.join
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/cathy_tools.listdir.html">
       cathy_tools.listdir
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/cathy_tools.make_console.html">
       cathy_tools.make_console
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/cathy_tools.print.html">
       cathy_tools.print
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/cathy_tools.subprocess_run_multi.html">
       cathy_tools.subprocess_run_multi
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../content/api/generated/importers.cathy_outputs.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       importers.cathy_outputs
      </span>
     </code>
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
    <label for="toctree-checkbox-5">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/importers.cathy_outputs.read_cumflowvol.html">
       importers.cathy_outputs.read_cumflowvol
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/importers.cathy_outputs.read_dtcoupling.html">
       importers.cathy_outputs.read_dtcoupling
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/importers.cathy_outputs.read_hgraph.html">
       importers.cathy_outputs.read_hgraph
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/importers.cathy_outputs.read_hgsfdet.html">
       importers.cathy_outputs.read_hgsfdet
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/importers.cathy_outputs.read_mbeconv.html">
       importers.cathy_outputs.read_mbeconv
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/importers.cathy_outputs.read_psi.html">
       importers.cathy_outputs.read_psi
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/importers.cathy_outputs.read_sw.html">
       importers.cathy_outputs.read_sw
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/importers.cathy_outputs.read_vp.html">
       importers.cathy_outputs.read_vp
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/importers.cathy_outputs.read_wtdepth.html">
       importers.cathy_outputs.read_wtdepth
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../content/api/generated/importers.cathy_inputs.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       importers.cathy_inputs
      </span>
     </code>
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
    <label for="toctree-checkbox-6">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/importers.cathy_inputs.read_atmbc.html">
       importers.cathy_inputs.read_atmbc
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/importers.cathy_inputs.read_dem.html">
       importers.cathy_inputs.read_dem
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/importers.cathy_inputs.read_dem_parameters.html">
       importers.cathy_inputs.read_dem_parameters
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/importers.cathy_inputs.read_grid3d.html">
       importers.cathy_inputs.read_grid3d
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/importers.cathy_inputs.read_raster.html">
       importers.cathy_inputs.read_raster
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/importers.cathy_inputs.read_root_map.html">
       importers.cathy_inputs.read_root_map
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/importers.cathy_inputs.read_soil.html">
       importers.cathy_inputs.read_soil
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/importers.cathy_inputs.read_zone.html">
       importers.cathy_inputs.read_zone
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../content/api/generated/DA.cathy_DA.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       DA.cathy_DA
      </span>
     </code>
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
    <label for="toctree-checkbox-7">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/DA.cathy_DA.CATHY.html">
       DA.cathy_DA.CATHY
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/DA.cathy_DA.DA.html">
       DA.cathy_DA.DA
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/DA.cathy_DA.partial.html">
       DA.cathy_DA.partial
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/DA.cathy_DA.Archie_pert_rules.html">
       DA.cathy_DA.Archie_pert_rules
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/DA.cathy_DA.Carsel_Parrish_VGN_pert.html">
       DA.cathy_DA.Carsel_Parrish_VGN_pert
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/DA.cathy_DA.Evensen2003.html">
       DA.cathy_DA.Evensen2003
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/DA.cathy_DA.Johnson1970.html">
       DA.cathy_DA.Johnson1970
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/DA.cathy_DA.VG_pert_rules.html">
       DA.cathy_DA.VG_pert_rules
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/DA.cathy_DA.atmbc_pert_rules.html">
       DA.cathy_DA.atmbc_pert_rules
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/DA.cathy_DA.build_dict_attributes_pert.html">
       DA.cathy_DA.build_dict_attributes_pert
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/DA.cathy_DA.dictObs_2pd.html">
       DA.cathy_DA.dictObs_2pd
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/DA.cathy_DA.perturbate_dist.html">
       DA.cathy_DA.perturbate_dist
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/DA.cathy_DA.perturbate_parm.html">
       DA.cathy_DA.perturbate_parm
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/DA.cathy_DA.resynchronise_times.html">
       DA.cathy_DA.resynchronise_times
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/DA.cathy_DA.run_analysis.html">
       DA.cathy_DA.run_analysis
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/DA.cathy_DA.sampling_dist.html">
       DA.cathy_DA.sampling_dist
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/DA.cathy_DA.sampling_dist_trunc.html">
       DA.cathy_DA.sampling_dist_trunc
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/DA.cathy_DA.subprocess_run_multi.html">
       DA.cathy_DA.subprocess_run_multi
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/DA.cathy_DA.track.html">
       DA.cathy_DA.track
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../content/api/generated/ERT.petro_Archie.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       ERT.petro_Archie
      </span>
     </code>
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
    <label for="toctree-checkbox-8">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/ERT.petro_Archie.Archie_rho_DA.html">
       ERT.petro_Archie.Archie_rho_DA
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/ERT.petro_Archie.CATHY_2_Resipy.html">
       ERT.petro_Archie.CATHY_2_Resipy
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/ERT.petro_Archie.CATHY_2_pg.html">
       ERT.petro_Archie.CATHY_2_pg
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/ERT.petro_Archie.SW_2_ERa_DA.html">
       ERT.petro_Archie.SW_2_ERa_DA
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/ERT.petro_Archie.get_Archie_ens_i.html">
       ERT.petro_Archie.get_Archie_ens_i
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/ERT.petro_Archie.get_sw_ens_i.html">
       ERT.petro_Archie.get_sw_ens_i
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/ERT.petro_Archie.print.html">
       ERT.petro_Archie.print
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../content/api/generated/ERT.simulate_ERT.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       ERT.simulate_ERT
      </span>
     </code>
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
    <label for="toctree-checkbox-9">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/ERT.simulate_ERT.R2.html">
       ERT.simulate_ERT.R2
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/ERT.simulate_ERT.Archie_ERT.html">
       ERT.simulate_ERT.Archie_ERT
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/ERT.simulate_ERT.create_ERT_survey_Resipy.html">
       ERT.simulate_ERT.create_ERT_survey_Resipy
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/ERT.simulate_ERT.create_ERT_survey_pg.html">
       ERT.simulate_ERT.create_ERT_survey_pg
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/ERT.simulate_ERT.fwd_ERT_survey.html">
       ERT.simulate_ERT.fwd_ERT_survey
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/ERT.simulate_ERT.invert_ERT_survey.html">
       ERT.simulate_ERT.invert_ERT_survey
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../content/api/generated/sensitivity.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       sensitivity
      </span>
     </code>
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
    <label for="toctree-checkbox-10">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/sensitivity.analysis_Morris.html">
       sensitivity.analysis_Morris
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/sensitivity.define_Morris.html">
       sensitivity.define_Morris
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/sensitivity.df_Morris.html">
       sensitivity.df_Morris
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/sensitivity.err_weighted_rmse.html">
       sensitivity.err_weighted_rmse
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/sensitivity.plot_Morris.html">
       sensitivity.plot_Morris
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/sensitivity.print_Morris_out.html">
       sensitivity.print_Morris_out
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/sensitivity.run_sensitivity_analysis.html">
       sensitivity.run_sensitivity_analysis
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/sensitivity.samples_generation.html">
       sensitivity.samples_generation
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../content/api/generated/plotters.cathy_plots.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       plotters.cathy_plots
      </span>
     </code>
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
    <label for="toctree-checkbox-11">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/plotters.cathy_plots.FormatStrFormatter.html">
       plotters.cathy_plots.FormatStrFormatter
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/plotters.cathy_plots.LogNorm.html">
       plotters.cathy_plots.LogNorm
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/plotters.cathy_plots.DA_RMS.html">
       plotters.cathy_plots.DA_RMS
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/plotters.cathy_plots.DA_plot_Archie.html">
       plotters.cathy_plots.DA_plot_Archie
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/plotters.cathy_plots.DA_plot_parm_dynamic.html">
       plotters.cathy_plots.DA_plot_parm_dynamic
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/plotters.cathy_plots.DA_plot_parm_dynamic_scatter.html">
       plotters.cathy_plots.DA_plot_parm_dynamic_scatter
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/plotters.cathy_plots.DA_plot_time_dynamic.html">
       plotters.cathy_plots.DA_plot_time_dynamic
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/plotters.cathy_plots.change_x2date.html">
       plotters.cathy_plots.change_x2date
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/plotters.cathy_plots.convert_time_units.html">
       plotters.cathy_plots.convert_time_units
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/plotters.cathy_plots.dem_plot_2d_top.html">
       plotters.cathy_plots.dem_plot_2d_top
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/plotters.cathy_plots.get_dem_coords.html">
       plotters.cathy_plots.get_dem_coords
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/plotters.cathy_plots.label_units.html">
       plotters.cathy_plots.label_units
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/plotters.cathy_plots.plot_VGP.html">
       plotters.cathy_plots.plot_VGP
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/plotters.cathy_plots.plot_hist_perturbated_parm.html">
       plotters.cathy_plots.plot_hist_perturbated_parm
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/plotters.cathy_plots.plot_mesh_bounds.html">
       plotters.cathy_plots.plot_mesh_bounds
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/plotters.cathy_plots.prepare_DA_plot_time_dynamic.html">
       plotters.cathy_plots.prepare_DA_plot_time_dynamic
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/plotters.cathy_plots.show_COCumflowvol.html">
       plotters.cathy_plots.show_COCumflowvol
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/plotters.cathy_plots.show_DA_process_ens.html">
       plotters.cathy_plots.show_DA_process_ens
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/plotters.cathy_plots.show_atmbc.html">
       plotters.cathy_plots.show_atmbc
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/plotters.cathy_plots.show_atmbc_3d.html">
       plotters.cathy_plots.show_atmbc_3d
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/plotters.cathy_plots.show_dem.html">
       plotters.cathy_plots.show_dem
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/plotters.cathy_plots.show_dtcoupling.html">
       plotters.cathy_plots.show_dtcoupling
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/plotters.cathy_plots.show_hgraph.html">
       plotters.cathy_plots.show_hgraph
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/plotters.cathy_plots.show_hgsfdet.html">
       plotters.cathy_plots.show_hgsfdet
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/plotters.cathy_plots.show_indice_veg.html">
       plotters.cathy_plots.show_indice_veg
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/plotters.cathy_plots.show_raster.html">
       plotters.cathy_plots.show_raster
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/plotters.cathy_plots.show_soil.html">
       plotters.cathy_plots.show_soil
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/plotters.cathy_plots.show_vp_DEPRECATED.html">
       plotters.cathy_plots.show_vp_DEPRECATED
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/plotters.cathy_plots.show_vtk.html">
       plotters.cathy_plots.show_vtk
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/plotters.cathy_plots.show_vtk_TL.html">
       plotters.cathy_plots.show_vtk_TL
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/plotters.cathy_plots.show_wtdepth.html">
       plotters.cathy_plots.show_wtdepth
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/plotters.cathy_plots.show_zone.html">
       plotters.cathy_plots.show_zone
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/plotters.cathy_plots.transform2_time_delta.html">
       plotters.cathy_plots.transform2_time_delta
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../content/api/generated/pyCATHY.cathy_utils.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       pyCATHY.cathy_utils
      </span>
     </code>
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/>
    <label for="toctree-checkbox-12">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/pyCATHY.cathy_utils.change_x2date.html">
       pyCATHY.cathy_utils.change_x2date
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/pyCATHY.cathy_utils.convert_time_units.html">
       pyCATHY.cathy_utils.convert_time_units
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/pyCATHY.cathy_utils.dictObs_2pd.html">
       pyCATHY.cathy_utils.dictObs_2pd
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/pyCATHY.cathy_utils.kPa2cm.html">
       pyCATHY.cathy_utils.kPa2cm
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/pyCATHY.cathy_utils.kPa2m.html">
       pyCATHY.cathy_utils.kPa2m
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/pyCATHY.cathy_utils.label_units.html">
       pyCATHY.cathy_utils.label_units
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/pyCATHY.cathy_utils.transform2_time_delta.html">
       pyCATHY.cathy_utils.transform2_time_delta
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../content/api/generated/pyCATHY.meshtools.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       pyCATHY.meshtools
      </span>
     </code>
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/>
    <label for="toctree-checkbox-13">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/pyCATHY.meshtools.CATHY_2_Resipy.html">
       pyCATHY.meshtools.CATHY_2_Resipy
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/pyCATHY.meshtools.CATHY_2_Simpeg.html">
       pyCATHY.meshtools.CATHY_2_Simpeg
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/pyCATHY.meshtools.CATHY_2_pg.html">
       pyCATHY.meshtools.CATHY_2_pg
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/pyCATHY.meshtools.add_attribute_2mesh.html">
       pyCATHY.meshtools.add_attribute_2mesh
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/pyCATHY.meshtools.add_markers2mesh.html">
       pyCATHY.meshtools.add_markers2mesh
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/pyCATHY.meshtools.create_layers_inzones3d.html">
       pyCATHY.meshtools.create_layers_inzones3d
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/pyCATHY.meshtools.find_nearest_node.html">
       pyCATHY.meshtools.find_nearest_node
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/pyCATHY.meshtools.get_layer_depth.html">
       pyCATHY.meshtools.get_layer_depth
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/pyCATHY.meshtools.get_layer_depths.html">
       pyCATHY.meshtools.get_layer_depths
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/pyCATHY.meshtools.get_zone3d_layer_depths.html">
       pyCATHY.meshtools.get_zone3d_layer_depths
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/pyCATHY.meshtools.het_soil_layers_mapping_generic.html">
       pyCATHY.meshtools.het_soil_layers_mapping_generic
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/pyCATHY.meshtools.map_layers_2_DEM.html">
       pyCATHY.meshtools.map_layers_2_DEM
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/pyCATHY.meshtools.plot_2d_interpolation_quality.html">
       pyCATHY.meshtools.plot_2d_interpolation_quality
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/pyCATHY.meshtools.plot_zones3d_layered.html">
       pyCATHY.meshtools.plot_zones3d_layered
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/pyCATHY.meshtools.set_interpolation_radius.html">
       pyCATHY.meshtools.set_interpolation_radius
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/pyCATHY.meshtools.trace_mesh.html">
       pyCATHY.meshtools.trace_mesh
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/pyCATHY.meshtools.trace_mesh_pg.html">
       pyCATHY.meshtools.trace_mesh_pg
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/api/generated/pyCATHY.meshtools.zone3d.html">
       pyCATHY.meshtools.zone3d
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../content/change_log.html">
   Change log
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../content/cathy_list_citation.html">
   Who uses CATHY ?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../content/references.html">
   References
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Getting help and contributed
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../content/contribute.html">
   Contribute and support
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
</div>

</div>


          


          
<!-- This is an invisible pixel that we watch to see if we've scrolled. -->
<div class="sbt-scroll-pixel-helper"></div>
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            <div class="topbar-left">
                
                <label class="nav-toggle-button" for="__navigation">
                    <div class="visually-hidden">Toggle navigation</div>
                    <i class="fas fa-bars"></i>
                </label>
                
            </div>
            
            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/BenjMy/pycathy_wrapper"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/BenjMy/pycathy_wrapper/issues/new?title=Issue%20on%20page%20%2F_modules/pyCATHY/cathy_tools.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1></h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                    </div>
                </div>
            </div>
            
              <div>
                
  <h1>Source code for pyCATHY.cathy_tools</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Main class controlling the wrapper.</span>

<span class="sd">This class is managing three main components: </span>
<span class="sd">    </span>
<span class="sd">1. Reading/writing inputs and output files </span>

<span class="sd">We used a generic formalation for the function&#39;s names based on the CATHY files. </span>

<span class="sd">Example:</span>
<span class="sd">-------</span>
<span class="sd">    In order to update the soil file:</span>
<span class="sd">        `update_soil(arguments)`</span>
<span class="sd">    In order to update the atmbc file:</span>
<span class="sd">        `update_atmbc(arguments)`</span>
<span class="sd">        </span>
<span class="sd">    Note that the name of the arguments are similar to the name of the variable to update</span>
<span class="sd">    In order to update the parm file with a new minimum time step DTMIN:</span>
<span class="sd">        `update_parm(DTMIN=1e3)`</span>
<span class="sd">        </span>
<span class="sd">The update function is composed of three main actions:</span>
<span class="sd">    - Set the defaut parameters (it is actually not reading the input file to set the defaut parameters)</span>
<span class="sd">    - replace values by the new ones introduced via the function argument</span>
<span class="sd">    - write the new file (it overwrites the existing file)</span>
<span class="sd">    </span>
<span class="sd">Note also that updating an input file may affect the CATHY.H control file. </span>
<span class="sd">When needed, the code takes care of updating values of the CATHY.H file retroactivelly.</span>

<span class="sd">Remenber to update all your prepo files before calling `run_preprocessor()`, and</span>
<span class="sd">all you input files before calling `run_processor()` </span>

<span class="sd">2. Compiling the fortran files</span>
<span class="sd">3. Running executable</span>

<span class="sd">Once all the files were updated, the `run_preprocessor()` or `run_processor()` </span>
<span class="sd">are taking care of recompiling the source files via bash cmd.</span>
<span class="sd">   </span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">git</span> <span class="kn">import</span> <span class="n">Repo</span>  <span class="c1"># In order to fetch the file directly from the repo</span>

<span class="kn">import</span> <span class="nn">pyCATHY.meshtools</span> <span class="k">as</span> <span class="nn">mt</span>
<span class="kn">from</span> <span class="nn">pyCATHY.importers</span> <span class="kn">import</span> <span class="n">cathy_inputs</span> <span class="k">as</span> <span class="n">in_CT</span>
<span class="kn">from</span> <span class="nn">pyCATHY.importers</span> <span class="kn">import</span> <span class="n">cathy_outputs</span> <span class="k">as</span> <span class="n">out_CT</span>
<span class="kn">from</span> <span class="nn">pyCATHY.plotters</span> <span class="kn">import</span> <span class="n">cathy_plots</span> <span class="k">as</span> <span class="n">plt_CT</span>

<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">DeprecationWarning</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">time</span>  <span class="c1"># measure time of computation</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">OrderedDict</span>
<span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">listdir</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">isfile</span><span class="p">,</span> <span class="n">join</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">pyvista</span> <span class="k">as</span> <span class="nn">pv</span>  <span class="c1"># read .vtk files</span>
<span class="kn">import</span> <span class="nn">rich.console</span>
<span class="kn">from</span> <span class="nn">rich</span> <span class="kn">import</span> <span class="nb">print</span>

<span class="c1"># import matplotlib.pyplot as plt</span>


<span class="c1"># -----------------------------------------------------------------------------</span>
<div class="viewcode-block" id="subprocess_run_multi"><a class="viewcode-back" href="../../content/api/generated/DA.cathy_DA.subprocess_run_multi.html#DA.cathy_DA.subprocess_run_multi">[docs]</a><span class="k">def</span> <span class="nf">subprocess_run_multi</span><span class="p">(</span><span class="n">pathexe_list</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Run multiple exe files in parallel.</span>

<span class="sd">    Multiprocessor functions outside main CATHY object</span>
<span class="sd">    # https://stackoverflow.com/questions/44144584/typeerror-cant-pickle-thread-lock-objects</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;x= </span><span class="si">{</span><span class="n">pathexe_list</span><span class="si">}</span><span class="s2">, PID = </span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">pathexe_list</span><span class="p">)</span>
    <span class="n">callexe</span> <span class="o">=</span> <span class="s2">&quot;./&quot;</span> <span class="o">+</span> <span class="s2">&quot;cathy&quot;</span>

    <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
            <span class="p">[</span><span class="n">callexe</span><span class="p">],</span>
            <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="c1"># capture_output=True</span>
            <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
            <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">p</span></div>


<span class="k">def</span> <span class="nf">make_console</span><span class="p">(</span><span class="n">verbose</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Start up the :class:`rich.console.Console` instance we&#39;ll use.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    verbose : bool</span>
<span class="sd">        Whether or not to print status messages to stderr.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">rich</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">Console</span><span class="p">(</span><span class="n">stderr</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="ow">not</span> <span class="n">verbose</span><span class="p">)</span>


<span class="c1"># -----------------------------------------------------------------------------</span>
<div class="viewcode-block" id="CATHY"><a class="viewcode-back" href="../../content/api/generated/DA.cathy_DA.CATHY.html#DA.cathy_DA.CATHY">[docs]</a><span class="k">class</span> <span class="nc">CATHY</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Main CATHY object.</span>

<span class="sd">    When instantiated it creates the tree project directories with &#39;prj_name&#39; as root folder.</span>
<span class="sd">    The src files are fetched from the online repository if not existing</span>
<span class="sd">    (note that it is possible to call a specific version).</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">dirName</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">prj_name</span><span class="o">=</span><span class="s2">&quot;my_cathy_prj&quot;</span><span class="p">,</span>
        <span class="n">notebook</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">version</span><span class="o">=</span><span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create CATHY object.</span>

<span class="sd">        ..note:</span>
<span class="sd">            All variables in CAPITAL LETTERS use the semantic from the CATHY legacy fortran codes,</span>
<span class="sd">            while the others are created exclusively for the wrapper.</span>

<span class="sd">        ..note:</span>
<span class="sd">            All file variable are self dictionnary objects; example: soil file is contained in self.soil</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>  <span class="c1"># executation time estimate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">console</span> <span class="o">=</span> <span class="n">make_console</span><span class="p">(</span><span class="n">verbose</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;:checkered_flag: [b]Initiate CATHY object[/b]&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># flag for notebook execution</span>
        <span class="c1"># ---------------------------------------------------------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">notebook</span> <span class="o">=</span> <span class="n">notebook</span>  <span class="c1"># flag if the script is run in a notebook</span>

        <span class="c1"># create working and project dir</span>
        <span class="c1"># ---------------------------------------------------------------------</span>
        <span class="k">if</span> <span class="n">dirName</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="n">dirName</span><span class="p">)</span>

        <span class="c1"># change working directory</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">)):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># os.chdir(self.workdir)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span> <span class="o">=</span> <span class="n">prj_name</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">)):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># convention for directory tree</span>
        <span class="c1"># ---------------------------------------------------------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processor_name</span> <span class="o">=</span> <span class="s2">&quot;cathy&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_dirname</span> <span class="o">=</span> <span class="s2">&quot;input&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_dirname</span> <span class="o">=</span> <span class="s2">&quot;output&quot;</span>

        <span class="c1"># dict related to CATHY inputs files</span>
        <span class="c1"># ---------------------------------------------------------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parm</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># dict of parm input parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">soil</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># dict of soil input parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ic</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># dict of ic input parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cathyH</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># dict of cathyH C header parameters</span>
        <span class="c1"># self.nudging = {&#39;NUDN&#39;: 0}   # Temporary</span>

        <span class="c1"># THIS SHOULD BE REMOVED #</span>
        <span class="c1"># dict related to Data assimilation</span>
        <span class="c1"># ---------------------------------------------------------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DAFLAG</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># Flag to trigger data assimilation process</span>
        <span class="c1"># (self.dict_obs is assimiliatiom times size)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict_obs</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>  <span class="c1"># dictionnary containing all the observation data</span>
        <span class="c1"># (self.stacked_data_cov is data_size * assimiliatiom times size)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count_DA_cycle</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># counter of the Assimilation Cycle</span>
        <span class="c1"># self.df_performance = pd.DataFrame() # pandas dataframe with performence evaluation metrics</span>

        <span class="c1"># dict related to the mesh</span>
        <span class="c1"># ---------------------------------------------------------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid3d</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># clear src files if required</span>
            <span class="c1"># ---------------------------------------------------------------------</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;clear_src&quot;</span><span class="p">:</span>  <span class="c1"># clear src files</span>
                <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;src&quot;</span><span class="p">)</span>
                    <span class="p">):</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;clear src files&quot;</span><span class="p">)</span>
                        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span>
                            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;src&quot;</span><span class="p">)</span>
                        <span class="p">)</span>
                        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span>
                            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;input&quot;</span><span class="p">)</span>
                        <span class="p">)</span>
                        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span>
                            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;prepro&quot;</span><span class="p">)</span>
                        <span class="p">)</span>

        <span class="c1"># fetch src files if not existing from Gitbucket repo</span>
        <span class="c1"># ---------------------------------------------------------------------</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;src&quot;</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;:worried_face: [b]src files not found[/b]&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;working directory is:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">)))</span>

            <span class="k">if</span> <span class="n">version</span> <span class="o">==</span> <span class="s2">&quot;1.0.0&quot;</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">Repo</span><span class="o">.</span><span class="n">clone_from</span><span class="p">(</span>
                        <span class="s2">&quot;https://bitbucket.org/cathy1_0/cathy.git&quot;</span><span class="p">,</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;tmp_src&quot;</span><span class="p">),</span>
                        <span class="n">branch</span><span class="o">=</span><span class="s2">&quot;master&quot;</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;:inbox_tray: [b]Fetch cathy src files[/b]&quot;</span><span class="p">)</span>
                    <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;tmp_src/src&quot;</span><span class="p">),</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;src&quot;</span><span class="p">),</span>
                    <span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span>
                        <span class="s2">&quot;:inbox_tray: [b]Fetch cathy prepro src files[/b]&quot;</span>
                    <span class="p">)</span>
                    <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span>
                            <span class="s2">&quot;tmp_src/runs/weilletal/prepro&quot;</span><span class="p">,</span>
                        <span class="p">),</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;prepro&quot;</span><span class="p">),</span>
                    <span class="p">)</span>
                    <span class="c1"># os.remove(os.path.join(</span>
                    <span class="c1">#      self.workdir, self.project_name, &quot;prepro&quot;) + &#39;/dem&#39; )</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;:inbox_tray: [b]Fetch cathy inputfiles[/b]&quot;</span><span class="p">)</span>
                    <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span>
                            <span class="s2">&quot;tmp_src/runs/weilletal/input&quot;</span><span class="p">,</span>
                        <span class="p">),</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;input&quot;</span><span class="p">),</span>
                    <span class="p">)</span>

                    <span class="n">pathsrc</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;tmp_src/runs/weilletal/&quot;</span>
                    <span class="p">)</span>

                    <span class="n">onlyfiles</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">listdir</span><span class="p">(</span><span class="n">pathsrc</span><span class="p">)</span> <span class="k">if</span> <span class="n">isfile</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">pathsrc</span><span class="p">,</span> <span class="n">f</span><span class="p">))</span>
                    <span class="p">]</span>

                    <span class="k">for</span> <span class="p">(</span>
                        <span class="n">file</span>
                    <span class="p">)</span> <span class="ow">in</span> <span class="p">(</span>
                        <span class="n">onlyfiles</span>
                    <span class="p">):</span>  <span class="c1"># You could shorten this to one line, but it runs on a bit.</span>
                        <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span>
                            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pathsrc</span><span class="p">,</span> <span class="n">file</span><span class="p">),</span>
                            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="n">file</span><span class="p">),</span>
                        <span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">create_output</span><span class="p">(</span><span class="n">output_dirname</span><span class="o">=</span><span class="s2">&quot;output&quot;</span><span class="p">)</span>

                    <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;tmp_src&quot;</span><span class="p">)</span>
                    <span class="p">)</span>

                <span class="k">except</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;no internet connection to fetch the files&quot;</span><span class="p">)</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
                    <span class="k">pass</span>

            <span class="k">if</span> <span class="n">version</span> <span class="o">==</span> <span class="s2">&quot;G. Manoli&quot;</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;fetch cathy G. Manoli src files&quot;</span><span class="p">)</span>
                <span class="n">path_manoli</span> <span class="o">=</span> <span class="s2">&quot;/home/ben/Documents/CATHY/CathyGitbucket/Test_Gabriele/1_Gabriele_Piante_NON_modificato/CATHY_RWU_ABL_1D/&quot;</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span>
                    <span class="n">path_manoli</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;src&quot;</span><span class="p">)</span>
                <span class="p">)</span>

        <span class="c1"># clear output files if required</span>
        <span class="c1"># ---------------------------------------------------------------------</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;clear_outputs&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;output&quot;</span><span class="p">)</span>
                    <span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">create_output</span><span class="p">(</span><span class="n">output_dirname</span><span class="o">=</span><span class="s2">&quot;output&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span>
                            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;output&quot;</span><span class="p">)</span>
                        <span class="p">)</span>
                        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span>
                            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;vtk&quot;</span><span class="p">)</span>
                        <span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">create_output</span><span class="p">(</span><span class="n">output_dirname</span><span class="o">=</span><span class="s2">&quot;output&quot;</span><span class="p">)</span>

        <span class="k">pass</span>

    <span class="c1"># --------------------------------------------------------------------------- #</span>
    <span class="c1"># replace console cmd by a subprocess call</span>
    <span class="c1"># --------------------------------------------------------------------------- #</span>
<div class="viewcode-block" id="CATHY.run_preprocessor"><a class="viewcode-back" href="../../content/api/generated/DA.cathy_DA.CATHY.html#DA.cathy_DA.CATHY.run_preprocessor">[docs]</a>    <span class="k">def</span> <span class="nf">run_preprocessor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">KeepOutlet</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Run cppp.exe</span>
<span class="sd">        1. updates cathy parameters prepo</span>
<span class="sd">        2. recompile the source files prepo</span>
<span class="sd">        3. run the preprocessor using bash cmd</span>

<span class="sd">        Running the executable file has allowed to generate a complete set of</span>
<span class="sd">        files describing physiographic features of the drainage system, as shown in Table 2.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;:cooking: [b]gfortran compilation[/b]&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">loopi</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>  <span class="c1"># run it twice (to avoid the first error)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;prepro/src/&quot;</span><span class="p">))</span>

            <span class="c1"># clean all files compiled</span>
            <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*.o&quot;</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

            <span class="c1"># if self.notebook==False:</span>
            <span class="n">bashCommand</span> <span class="o">=</span> <span class="s2">&quot;gfortran -O -o pycppp mpar.f90 mbbio.f90 wbb_sr.f90 csort.f90 qsort.f90 depit.f90 cca.f90 smean.f90 dsf.f90 facet.f90 hg.f90 mrbb_sr.f90 bb2shp_sr.f90 shape.f90 dbase.f90 streamer.f90 cppp.f90&quot;</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">bashCommand</span> <span class="o">+</span> <span class="s2">&quot;&gt; /dev/null 2&gt;&amp;1&quot;</span><span class="p">)</span>
                <span class="c1"># run it twice (to avoid the first error)</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">bashCommand</span> <span class="o">+</span> <span class="s2">&quot;&gt; /dev/null 2&gt;&amp;1&quot;</span><span class="p">)</span>

            <span class="k">except</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;bash cmd not recognized&quot;</span><span class="p">)</span>

            <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">)</span>
        <span class="c1"># move to the directory where the source FORTRAN files are contained (cathy_main.f)</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;prepro/src/pycppp&quot;</span><span class="p">),</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;prepro/pycppp&quot;</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;:athletic_shoe: [b]Run preprocessor[/b]&quot;</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;prepro&quot;</span><span class="p">))</span>

        <span class="n">bashcmd</span> <span class="o">=</span> <span class="s2">&quot;./pycppp&quot;</span>
        <span class="n">my_data</span> <span class="o">=</span> <span class="s2">&quot;2</span><span class="se">\n</span><span class="s2">0</span><span class="se">\n</span><span class="s2">1</span><span class="se">\n</span><span class="s2">&quot;</span>  <span class="c1"># user input data</span>
        <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
                <span class="p">[</span><span class="n">bashcmd</span><span class="p">],</span>
                <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="nb">input</span><span class="o">=</span><span class="n">my_data</span><span class="p">,</span>
                <span class="c1"># capture_output=True,</span>
                <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
                <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;DEM resolution is not a multiple of the rivulet spacing!&quot;</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">stdout</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DEM resolution is not a multiple of the rivulet spacing!&quot;</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
        <span class="k">if</span> <span class="s2">&quot;catchment with more than one outlet cell!&quot;</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">stdout</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;catchment with more than one outlet cell!&quot;</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">KeepOutlet</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;remove outlet&quot;</span><span class="p">)</span>
            <span class="n">idoutlet</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DEM</span> <span class="o">==</span> <span class="nb">min</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DEM</span><span class="p">)))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">DEM</span><span class="p">[</span><span class="n">idoutlet</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">idoutlet</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DEM</span><span class="p">))</span>

        <span class="c1"># if np.shape(self.DEM)[1]==self.hapin[&#39;N&#39;]:</span>
        <span class="c1">#     self.console.rule(&#39;&#39;&#39;:warning: !transposing DEM dimension!</span>
        <span class="c1">#                           This should be avoided in a future version</span>
        <span class="c1">#                           :warning:&#39;&#39;&#39;,</span>
        <span class="c1">#                             style=&quot;yellow&quot;)</span>
        <span class="c1">#     self.update_prepo_inputs(N=self.hapin[&#39;M&#39;],</span>
        <span class="c1">#                               M=self.hapin[&#39;N&#39;])</span>

        <span class="c1">#     self.update_cathyH(</span>
        <span class="c1">#                         ROWMAX=self.hapin[&#39;N&#39;],</span>
        <span class="c1">#                         COLMAX=self.hapin[&#39;M&#39;]</span>
        <span class="c1">#                         )</span>
        <span class="c1"># self.update_zone()</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">)</span>

        <span class="k">pass</span></div>

<div class="viewcode-block" id="CATHY.recompileSrc"><a class="viewcode-back" href="../../content/api/generated/DA.cathy_DA.CATHY.html#DA.cathy_DA.CATHY.recompileSrc">[docs]</a>    <span class="k">def</span> <span class="nf">recompileSrc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Other option is self.run_processor(runProcess=False)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ti</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>  <span class="c1"># executation time estimate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span>
            <span class="s2">&quot;:hammer_and_wrench: [b] Recompile src files[/b] [&quot;</span>
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">ti</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">t0</span><span class="p">)))</span>
            <span class="o">+</span> <span class="s2">&quot;s]&quot;</span>
        <span class="p">)</span>
        <span class="c1"># clean all files previously compiled</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*.o&quot;</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        <span class="c1"># list all the fortran files to compile and compile</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*.f&quot;</span><span class="p">):</span>
            <span class="n">bashCommand</span> <span class="o">=</span> <span class="s2">&quot;gfortran -c &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
            <span class="c1"># gfortran -c *.f</span>
            <span class="c1"># gfortran *.o -L\MinGW\lib -llapack -lblas -o cathy</span>
            <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
                <span class="n">process</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span>
                    <span class="n">bashCommand</span><span class="o">.</span><span class="n">split</span><span class="p">(),</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span>
                <span class="p">)</span>
                <span class="c1"># if verbose==True:</span>
                <span class="c1">#     output, error = process.communicate()</span>
                <span class="n">output</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
        <span class="c1"># list all the fortran compiled files to compile and run</span>
        <span class="n">files</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*.o&quot;</span><span class="p">):</span>
            <span class="n">files</span> <span class="o">+=</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        <span class="n">bashCommand</span> <span class="o">=</span> <span class="s2">&quot;gfortran&quot;</span> <span class="o">+</span> <span class="n">files</span> <span class="o">+</span> <span class="s2">&quot; -llapack -lblas -o &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">processor_name</span>
        <span class="n">ti</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>  <span class="c1"># executation time estimate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span>
            <span class="s2">&quot;:cooking: [b]gfortran compilation[/b] [&quot;</span>
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">ti</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">t0</span><span class="p">)))</span>
            <span class="o">+</span> <span class="s2">&quot;s]&quot;</span>
        <span class="p">)</span>

        <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
            <span class="n">process</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span>
                <span class="n">bashCommand</span><span class="o">.</span><span class="n">split</span><span class="p">(),</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span>
            <span class="p">)</span>
            <span class="n">output</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;src&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">processor_name</span>
                <span class="p">),</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">processor_name</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;:pensive_face: [b]Cannot find the new processsor[/b]&quot;</span><span class="p">)</span>

        <span class="k">pass</span></div>

<div class="viewcode-block" id="CATHY.run_processor"><a class="viewcode-back" href="../../content/api/generated/DA.cathy_DA.CATHY.html#DA.cathy_DA.CATHY.run_processor">[docs]</a>    <span class="k">def</span> <span class="nf">run_processor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">recompile</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">runProcess</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Run cathy.exe</span>

<span class="sd">        1. updates cathy parameters and cathyH based on **kwargs</span>
<span class="sd">        2. recompile the source files (set False for notebook) and create the executable</span>
<span class="sd">        3. run the processor using bash cmd if runProcess is True</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        recompile : Bool, optional</span>
<span class="sd">            recomplile CATHY src files. The default is True.</span>
<span class="sd">        runProcess : Bool, optional</span>
<span class="sd">            exectute compile CATHY exe. The default is True.</span>
<span class="sd">        verbose : Bool, optional</span>
<span class="sd">            Output CATHY log. The default is False.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># set parallel flag for mutirun (used for DA ensemble)</span>
        <span class="c1"># --------------------------------------------------------------------</span>
        <span class="n">parallel</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="s2">&quot;parallel&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">parallel</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;parallel&quot;</span><span class="p">]</span>

        <span class="c1"># update parm and cathyH</span>
        <span class="c1"># --------------------------------------------------------------------</span>
        <span class="c1"># VERY VERY IMPORTANT NEVER COMMENT !</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">check_DEM_versus_inputs</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_parm</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_cathyH</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">recompile</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="c1"># recompile</span>
            <span class="c1"># --------------------------------------------------------------------</span>
            <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;src&quot;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">recompileSrc</span><span class="p">()</span>

        <span class="k">if</span> <span class="s2">&quot;path_CATHY_folder&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;path_CATHY_folder&quot;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># back to root dir</span>
            <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">))</span>

        <span class="c1"># some checkings</span>
        <span class="c1"># --------------------------------------------------------------------</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;inputs&quot;</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;input folder missing&quot;</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

        <span class="c1"># check if output folder</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;output&quot;</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="s2">&quot;output&quot;</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># check if vtk folder</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;vtk&quot;</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="s2">&quot;vtk&quot;</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># run the processor</span>
        <span class="c1"># --------------------------------------------------------------------</span>
        <span class="k">if</span> <span class="n">runProcess</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>

            <span class="c1"># t0 = time.time()  # executation time estimate</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;:athletic_shoe: [b]Run processor[/b]&quot;</span><span class="p">)</span>
            <span class="n">callexe</span> <span class="o">=</span> <span class="s2">&quot;./&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">processor_name</span>

            <span class="c1"># case of simple simulation</span>
            <span class="c1"># ----------------------------------------------------------------</span>
            <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">callexe</span><span class="p">],</span>
                    <span class="c1"># text=True,</span>
                    <span class="c1"># capture_output=True,</span>
                    <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
                    <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grid3d</span> <span class="o">=</span> <span class="n">in_CT</span><span class="o">.</span><span class="n">read_grid3d</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="c1"># computation time</span>
            <span class="c1"># ----------------------------------------------------------------</span>
            <span class="c1"># t1 = time.time()</span>
            <span class="c1"># self.total_computation_time = t1 - t0</span>

        <span class="k">return</span></div>

<div class="viewcode-block" id="CATHY.create_output"><a class="viewcode-back" href="../../content/api/generated/DA.cathy_DA.CATHY.html#DA.cathy_DA.CATHY.create_output">[docs]</a>    <span class="k">def</span> <span class="nf">create_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_dirname</span><span class="o">=</span><span class="s2">&quot;output&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create output directories</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        output_dirname : str, optional</span>
<span class="sd">            Name of the dir. The default is &quot;output&quot;.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># create project_name/output folders</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="n">output_dirname</span><span class="p">)):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="n">output_dirname</span><span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;vtk&quot;</span><span class="p">)):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;vtk&quot;</span><span class="p">))</span>

        <span class="c1"># compute the processor (make clean make) using the Makefile</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="CATHY.display_time_run"><a class="viewcode-back" href="../../content/api/generated/DA.cathy_DA.CATHY.html#DA.cathy_DA.CATHY.display_time_run">[docs]</a>    <span class="k">def</span> <span class="nf">display_time_run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">total</span></div>

    <span class="c1">#%% Checkings</span>

<div class="viewcode-block" id="CATHY.check_DEM_versus_inputs"><a class="viewcode-back" href="../../content/api/generated/DA.cathy_DA.CATHY.html#DA.cathy_DA.CATHY.check_DEM_versus_inputs">[docs]</a>    <span class="k">def</span> <span class="nf">check_DEM_versus_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Chech shape consistency between attributes and DEM</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;veg_map&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">veg_map</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DEM</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s2">&quot;Inconsistent shapes between vegetation map and DEM - need to update veg first&quot;</span>
                    <span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span></div>

    <span class="c1">#%%</span>
    <span class="c1"># --------------------------------------------------------------------------- #</span>
    <span class="c1"># update files</span>
    <span class="c1"># --------------------------------------------------------------------------- #</span>

<div class="viewcode-block" id="CATHY.update_cathyH"><a class="viewcode-back" href="../../content/api/generated/DA.cathy_DA.CATHY.html#DA.cathy_DA.CATHY.update_cathyH">[docs]</a>    <span class="k">def</span> <span class="nf">update_cathyH</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update CathyH file input based on **kwargs parameters.</span>

<span class="sd">        Parameters ---------- **kwargs : all variable parameters included into cathyH. For instance</span>
<span class="sd">        ROWMAX # maximum NROW, with NROW = number of rows in the DEM.</span>

<span class="sd">        Returns ------- type Write a modified cathyH file based on new parameters parsed</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">indent</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">kk</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">kk</span> <span class="o">==</span> <span class="s2">&quot;indent&quot;</span><span class="p">:</span>
                <span class="n">indent</span> <span class="o">=</span> <span class="n">value</span>

        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span>
                <span class="n">indent</span> <span class="o">+</span> <span class="s2">&quot;:arrows_counterclockwise: [b]Update cathyH files[/b]&quot;</span>
            <span class="p">)</span>

        <span class="n">CATHYH_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;src&quot;</span><span class="p">,</span> <span class="s2">&quot;CATHY.H&quot;</span><span class="p">),</span> <span class="s2">&quot;r&quot;</span>
        <span class="p">)</span>
        <span class="n">Lines0_109</span> <span class="o">=</span> <span class="n">CATHYH_file</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="n">CATHYH_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c1"># check if hapin and parm exist</span>
        <span class="c1"># create them if not existing</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;hapin&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_prepo_inputs</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;dem_parameters&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_dem_parameters</span><span class="p">()</span>
        <span class="k">if</span> <span class="s2">&quot;NR&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parm</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">rule</span><span class="p">(</span>
                <span class="s2">&quot;:warning: warning messages above :warning:&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span>
<span class="w">                </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                            The parm dictionnary is empty</span>
<span class="sd">                            Falling back to defaults to update CATHYH</span>
<span class="sd">                            This can have consequences !!</span>
<span class="sd">                            &quot;&quot;&quot;</span><span class="p">,</span>
                <span class="n">style</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">rule</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">update_parm</span><span class="p">()</span>

        <span class="n">DEMRES</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cathyH</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">cathyH</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;ROWMAX&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">hapin</span><span class="p">[</span>
                    <span class="s2">&quot;N&quot;</span>
                <span class="p">],</span>  <span class="c1"># maximum NROW, with NROW = number of rows in the DEM</span>
                <span class="s2">&quot;COLMAX&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">hapin</span><span class="p">[</span>
                    <span class="s2">&quot;M&quot;</span>
                <span class="p">],</span>  <span class="c1"># maximum NCOL, with NCOL = number of columns in the DEM</span>
                <span class="c1"># &#39;COARSE&#39;: ,</span>
                <span class="s2">&quot;MAXCEL&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hapin</span><span class="p">[</span><span class="s2">&quot;N&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hapin</span><span class="p">[</span><span class="s2">&quot;M&quot;</span><span class="p">]),</span>
                <span class="s2">&quot;MAXRES&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s2">&quot;DEMRES&quot;</span><span class="p">:</span> <span class="n">DEMRES</span><span class="p">,</span>
                <span class="s2">&quot;NODMAX&quot;</span><span class="p">:</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hapin</span><span class="p">[</span><span class="s2">&quot;N&quot;</span><span class="p">])</span> <span class="o">/</span> <span class="n">DEMRES</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                <span class="o">*</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hapin</span><span class="p">[</span><span class="s2">&quot;M&quot;</span><span class="p">])</span> <span class="o">/</span> <span class="n">DEMRES</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
                <span class="s2">&quot;NTRMAX&quot;</span><span class="p">:</span> <span class="mi">2</span>
                <span class="o">*</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hapin</span><span class="p">[</span><span class="s2">&quot;N&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hapin</span><span class="p">[</span><span class="s2">&quot;M&quot;</span><span class="p">]))</span>
                <span class="o">/</span> <span class="p">(</span><span class="n">DEMRES</span> <span class="o">*</span> <span class="n">DEMRES</span><span class="p">),</span>
                <span class="s2">&quot;NP2MAX&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s2">&quot;MAXSTR&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dem_parameters</span><span class="p">[</span><span class="s2">&quot;nstr&quot;</span><span class="p">],</span>
                <span class="s2">&quot;NPMAX&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s2">&quot;NQMAX&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s2">&quot;NSFMAX&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s2">&quot;NNSFMX&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s2">&quot;MAXNUDN&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>  <span class="c1"># self.nudging[&quot;NUDN&quot;],</span>
                <span class="s2">&quot;MAXNUDT&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s2">&quot;MAXNUDC&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="c1"># &#39;MAXNENS&#39;: ,</span>
                <span class="s2">&quot;MAXZON&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dem_parameters</span><span class="p">[</span>
                    <span class="s2">&quot;nzone&quot;</span>
                <span class="p">],</span>  <span class="c1"># maximum NZONE, with NZONE = number of material types in the porous medium</span>
                <span class="s2">&quot;MAXTRM&quot;</span><span class="p">:</span> <span class="mi">52111</span><span class="p">,</span>
                <span class="s2">&quot;MAXIT&quot;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
                <span class="s2">&quot;NRMAX&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">parm</span><span class="p">[</span><span class="s2">&quot;NR&quot;</span><span class="p">],</span>
                <span class="c1"># maximum NPRT (ref. parm file), with NPRT = number of time values for detailed output</span>
                <span class="s2">&quot;MAXPRT&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">parm</span><span class="p">[</span><span class="s2">&quot;NPRT&quot;</span><span class="p">],</span>
                <span class="c1"># maximum NUMVP (ref. parm input file), NUMVP = number of surface nodes for vertical profile output</span>
                <span class="s2">&quot;MAXVP&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parm</span><span class="p">[</span><span class="s2">&quot;NUMVP&quot;</span><span class="p">]),</span>
                <span class="s2">&quot;N1MAX&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dem_parameters</span><span class="p">[</span>
                    <span class="s2">&quot;n1&quot;</span>
                <span class="p">],</span>  <span class="c1"># maximum N1 (it is good to have N1 ≤ 20), N1 = maximum number of element connections to a node</span>
                <span class="s2">&quot;MAXBOT&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s2">&quot;INTBOT&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s2">&quot;NTAB&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
                <span class="s2">&quot;MAXQOUT&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s2">&quot;MAXVTKPRT&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">parm</span><span class="p">[</span><span class="s2">&quot;NPRT&quot;</span><span class="p">],</span>
                <span class="c1"># Is related to data assimilation (DA) (to do not considered if you do not have DA)</span>
                <span class="s2">&quot;MAXENNOUT&quot;</span><span class="p">:</span> <span class="mi">52560</span><span class="p">,</span>
                <span class="s2">&quot;MAXVEG&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="p">}</span>

        <span class="c1"># create dictionnary from kwargs</span>
        <span class="k">for</span> <span class="n">kk</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">kk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cathyH</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cathyH</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                <span class="c1"># if verbose:</span>
                <span class="c1">#     self.console.print(f&quot;modified: {kk} | value: {value}&quot;)</span>

        <span class="c1"># ---------------------------------------------------------------------</span>
        <span class="c1"># write new cathy H</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;src&quot;</span><span class="p">,</span> <span class="s2">&quot;CATHY.H&quot;</span><span class="p">),</span> <span class="s2">&quot;w+&quot;</span>
        <span class="p">)</span> <span class="k">as</span> <span class="n">CATHYH_file</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">Lines0_109</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">109</span><span class="p">:</span>
                    <span class="n">CATHYH_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>

            <span class="n">CATHYH_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="s2">&quot;      PARAMETER (ROWMAX=</span><span class="si">{}</span><span class="s2">,COLMAX=</span><span class="si">{}</span><span class="s2">,DEMRES=</span><span class="si">{}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cathyH</span><span class="p">[</span><span class="s2">&quot;ROWMAX&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">cathyH</span><span class="p">[</span><span class="s2">&quot;COLMAX&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">cathyH</span><span class="p">[</span><span class="s2">&quot;DEMRES&quot;</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">CATHYH_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;      PARAMETER (MAXCEL=ROWMAX*COLMAX,MAXRES=1)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">CATHYH_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="s2">&quot;      PARAMETER (NODMAX=(ROWMAX/DEMRES+1)*(COLMAX/DEMRES+1))</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="n">CATHYH_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="s2">&quot;      PARAMETER (NTRMAX=2*MAXCEL/(DEMRES*DEMRES))</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="n">CATHYH_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="s2">&quot;      PARAMETER (NP2MAX=1,MAXSTR=</span><span class="si">{}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cathyH</span><span class="p">[</span><span class="s2">&quot;MAXSTR&quot;</span><span class="p">])</span>
            <span class="p">)</span>
            <span class="n">CATHYH_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;      PARAMETER (NFACEMAX=74000)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">())</span>
            <span class="n">CATHYH_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="s2">&quot;      PARAMETER (NMAX=NODMAX*(MAXSTR + 1),NTEMAX=3*NTRMAX*MAXSTR)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="n">CATHYH_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="s2">&quot;      PARAMETER (NPMAX=</span><span class="si">{}</span><span class="s2">,NPMAX_TRA=1,NQMAX=</span><span class="si">{}</span><span class="s2">,NSFMAX=</span><span class="si">{}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cathyH</span><span class="p">[</span><span class="s2">&quot;NPMAX&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">cathyH</span><span class="p">[</span><span class="s2">&quot;NQMAX&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">cathyH</span><span class="p">[</span><span class="s2">&quot;NSFMAX&quot;</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">CATHYH_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="s2">&quot;      PARAMETER (NNSFMX=</span><span class="si">{}</span><span class="s2">,MAXDIR=NODMAX+NPMAX+NSFMAX*NNSFMX)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cathyH</span><span class="p">[</span><span class="s2">&quot;NNSFMX&quot;</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">CATHYH_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="s2">&quot;      PARAMETER (MAXNUDN=</span><span class="si">{}</span><span class="s2">,MAXNUDT=</span><span class="si">{}</span><span class="s2">,MAXNUDC=</span><span class="si">{}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cathyH</span><span class="p">[</span><span class="s2">&quot;MAXNUDN&quot;</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cathyH</span><span class="p">[</span><span class="s2">&quot;MAXNUDT&quot;</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cathyH</span><span class="p">[</span><span class="s2">&quot;MAXNUDC&quot;</span><span class="p">],</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">CATHYH_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="s2">&quot;      PARAMETER (MAXZON=</span><span class="si">{}</span><span class="s2">,MAXTRM=</span><span class="si">{}</span><span class="s2">,MAXIT=</span><span class="si">{}</span><span class="s2">,MAXVEG=</span><span class="si">{}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cathyH</span><span class="p">[</span><span class="s2">&quot;MAXZON&quot;</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cathyH</span><span class="p">[</span><span class="s2">&quot;MAXTRM&quot;</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cathyH</span><span class="p">[</span><span class="s2">&quot;MAXIT&quot;</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cathyH</span><span class="p">[</span><span class="s2">&quot;MAXVEG&quot;</span><span class="p">],</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">CATHYH_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="s2">&quot;      PARAMETER (NRMAX=</span><span class="si">{}</span><span class="s2">,MAXPRT=</span><span class="si">{}</span><span class="s2">,MAXVP=</span><span class="si">{}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cathyH</span><span class="p">[</span><span class="s2">&quot;NRMAX&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">cathyH</span><span class="p">[</span><span class="s2">&quot;MAXPRT&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">cathyH</span><span class="p">[</span><span class="s2">&quot;MAXVP&quot;</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">CATHYH_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="s2">&quot;      PARAMETER (N1MAX=</span><span class="si">{}</span><span class="s2">,NTPMAX=N1MAX*NMAX)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cathyH</span><span class="p">[</span><span class="s2">&quot;N1MAX&quot;</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">CATHYH_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="s2">&quot;      PARAMETER (MAXBOT=</span><span class="si">{}</span><span class="s2">,INTBOT=</span><span class="si">{}</span><span class="s2">,MAXQOUT=</span><span class="si">{}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cathyH</span><span class="p">[</span><span class="s2">&quot;MAXBOT&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">cathyH</span><span class="p">[</span><span class="s2">&quot;INTBOT&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">cathyH</span><span class="p">[</span><span class="s2">&quot;MAXQOUT&quot;</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">CATHYH_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="s2">&quot;cxcx  PARAMETER (NIAUXMAX=NFACEMAX + MAXTRM + 1)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="n">CATHYH_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="s2">&quot;cxcx  PARAMETER (NRAUXMAX=5*NFACEMAX + MAXTRM,NQMAX_TRA=NODMAX)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="n">CATHYH_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;      PARAMETER (NIAUXMAX=NMAX + MAXTRM + 1)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">())</span>
            <span class="n">CATHYH_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="s2">&quot;      PARAMETER (NRAUXMAX=5*NMAX + MAXTRM,NQMAX_TRA=NODMAX)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="n">CATHYH_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="s2">&quot;      PARAMETER (MAXVTKPRT=</span><span class="si">{}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cathyH</span><span class="p">[</span><span class="s2">&quot;MAXVTKPRT&quot;</span><span class="p">])</span>
            <span class="p">)</span>

            <span class="c1"># CATHYH_file.write(&quot;      PARAMETER (MAXVTKPRT=9)\n&quot;.format())</span>
            <span class="n">CATHYH_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;      PARAMETER (MAXFCONTONODE=100,MAXLKP=3)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">CATHYH_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="CATHY.update_hapin"><a class="viewcode-back" href="../../content/api/generated/DA.cathy_DA.CATHY.html#DA.cathy_DA.CATHY.update_hapin">[docs]</a>    <span class="k">def</span> <span class="nf">update_hapin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Lines</span><span class="p">,</span> <span class="n">hapin</span><span class="p">,</span> <span class="n">tmp_lnb</span><span class="p">,</span> <span class="n">tmp_param_value</span><span class="p">):</span>

        <span class="n">L</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">tmp_param_value_new</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># Loop over hap.in file lines</span>
        <span class="c1"># --------------------------------------------------------------------</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">Lines</span><span class="p">):</span>
            <span class="n">xnew</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">xnew</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># skip lines with no =</span>

                <span class="c1"># loop over hapin dictionnary</span>
                <span class="c1"># -----------------------------------</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hapin</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">count</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">hapin</span><span class="p">):</span>

                        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="n">hapin</span><span class="p">[</span><span class="n">tmp_lnb</span><span class="p">[</span><span class="n">count</span><span class="p">]]:</span>
                            <span class="k">if</span> <span class="n">value</span> <span class="o">!=</span> <span class="n">tmp_param_value</span><span class="p">[</span><span class="n">count</span><span class="p">]:</span>
                                <span class="c1"># print(key)</span>
                                <span class="c1"># print(value)</span>
                                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                                    <span class="n">value_str</span> <span class="o">=</span> <span class="s2">&quot;/t&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                                    <span class="n">xnew</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">value_str</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">xnew</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                                <span class="n">line</span> <span class="o">=</span> <span class="n">xnew</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;=              &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">xnew</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="n">tmp_param_value_new</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

                <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># count line nb</span>
            <span class="n">L</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

        <span class="c1"># # write the new hap.in file</span>

        <span class="n">hap_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;prepro/hap.in&quot;</span><span class="p">),</span> <span class="s2">&quot;w+&quot;</span>
        <span class="p">)</span>
        <span class="n">hap_file</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>
        <span class="n">hap_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="CATHY.update_prepo_inputs"><a class="viewcode-back" href="../../content/api/generated/DA.cathy_DA.CATHY.html#DA.cathy_DA.CATHY.update_prepo_inputs">[docs]</a>    <span class="k">def</span> <span class="nf">update_prepo_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">DEM</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update default prepro inputs i.e. hap.in and dtm_13.val files based on kwargs</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        DEM : TYPE, optional</span>
<span class="sd">            DESCRIPTION. The default is None.</span>
<span class="sd">        verbose : TYPE, optional</span>
<span class="sd">            DESCRIPTION. The default is False.</span>
<span class="sd">        show : TYPE, optional</span>
<span class="sd">            DESCRIPTION. The default is False.</span>
<span class="sd">        **kwargs : TYPE</span>
<span class="sd">            DESCRIPTION.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># print(&quot;update hap.in&quot;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;:arrows_counterclockwise: [b]Update hap.in file[/b]&quot;</span><span class="p">)</span>

        <span class="n">structural_parameter</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;delta_x&quot;</span><span class="p">,</span>
            <span class="s2">&quot;delta_y&quot;</span><span class="p">,</span>
            <span class="s2">&quot;N&quot;</span><span class="p">,</span>
            <span class="s2">&quot;M&quot;</span><span class="p">,</span>
            <span class="s2">&quot;N_celle&quot;</span><span class="p">,</span>
            <span class="s2">&quot;xllcorner&quot;</span><span class="p">,</span>
            <span class="s2">&quot;yllcorner&quot;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="n">terrain_parameter</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;pt&quot;</span><span class="p">,</span>
            <span class="s2">&quot;imethod&quot;</span><span class="p">,</span>
            <span class="s2">&quot;lambda&quot;</span><span class="p">,</span>
            <span class="s2">&quot;CC_threshold&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ndcf&quot;</span><span class="p">,</span>
            <span class="s2">&quot;nchc&quot;</span><span class="p">,</span>
            <span class="s2">&quot;A_threshold&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ASk_threshold&quot;</span><span class="p">,</span>
            <span class="s2">&quot;kas&quot;</span><span class="p">,</span>
            <span class="s2">&quot;DN_threshold&quot;</span><span class="p">,</span>
            <span class="s2">&quot;local_slope_t&quot;</span><span class="p">,</span>
            <span class="s2">&quot;p_outflow_vo&quot;</span><span class="p">,</span>
            <span class="s2">&quot;bcc&quot;</span><span class="p">,</span>
            <span class="s2">&quot;cqm&quot;</span><span class="p">,</span>
            <span class="s2">&quot;cqg&quot;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="c1"># &#39;RIVULET NETWORK PARAMETERS (HYDRAULIC GEOMETRY OF THE SINGLE RIVULET)&#39;</span>
        <span class="n">rivulet_parameter</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;dr&quot;</span><span class="p">,</span>
            <span class="s2">&quot;As_rf&quot;</span><span class="p">,</span>
            <span class="s2">&quot;(Qsf_rf,w_rf)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;(Wsf_rf,b1_rf,b2_rf)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;(kSsf_rf,y1_rf,y2_rf)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Qsi_rf&quot;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="n">channel_parameter</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;As_cf&quot;</span><span class="p">,</span>
            <span class="s2">&quot;(Qsf_cf,w_cf)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;(Wsf_cf,b1_cf,b2_cf)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;(kSsf_cf,y1_cf,y2_cf)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Qsi_cf&quot;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="c1"># idhapin = np.ones(22) + [1,1,2,3,3,1] #+ [1,2,3,3,1]</span>
        <span class="n">hapin</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">structural_parameter</span>
            <span class="o">+</span> <span class="n">terrain_parameter</span>
            <span class="o">+</span> <span class="n">rivulet_parameter</span>
            <span class="o">+</span> <span class="n">channel_parameter</span>
        <span class="p">)</span>

        <span class="n">hap_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;prepro/hap.in&quot;</span><span class="p">),</span> <span class="s2">&quot;r&quot;</span>
        <span class="p">)</span>
        <span class="n">Lines</span> <span class="o">=</span> <span class="n">hap_file</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="n">hap_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c1"># read current values in hap.in</span>

        <span class="n">tmp_param_value</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">tmp_lnb</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># save line nb where values are existing</span>
        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">Lines</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># skip lines with no =</span>
                <span class="n">xs</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
                <span class="n">xsr</span> <span class="o">=</span> <span class="n">xs</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;,&quot;</span><span class="p">)</span>
                <span class="n">l</span> <span class="o">=</span> <span class="n">xsr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                    <span class="n">l</span> <span class="o">=</span> <span class="s2">&quot;/t&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
                <span class="n">tmp_param_value</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
                <span class="n">tmp_lnb</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
                <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">hapin</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tmp_param_value</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;/t&quot;</span><span class="p">,</span> <span class="n">tmp_param_value</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">tmp_param_value</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
                    <span class="n">tmp_param_value</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tmp_param_value</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">tmp_param_value</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">tmp_param_value</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">list_tmp</span> <span class="o">=</span> <span class="n">tmp_param_value</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/t&quot;</span><span class="p">)</span>
                <span class="n">tmp_param_value</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_tmp</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">hapin</span><span class="p">[</span><span class="n">hapin</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tmp_param_value</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hapin</span><span class="p">[</span><span class="s2">&quot;dr&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hapin</span><span class="p">[</span><span class="s2">&quot;delta_x&quot;</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;adapt rivulet param to dem resolution&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hapin</span><span class="p">[</span><span class="s2">&quot;dr&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hapin</span><span class="p">[</span><span class="s2">&quot;delta_x&quot;</span><span class="p">]</span>
            <span class="c1"># sys.exit()</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hapin</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_hapin</span><span class="p">(</span><span class="n">Lines</span><span class="p">,</span> <span class="n">hapin</span><span class="p">,</span> <span class="n">tmp_lnb</span><span class="p">,</span> <span class="n">tmp_param_value</span><span class="p">)</span>

        <span class="c1"># dtm_13.val</span>
        <span class="c1"># If we start with a DEM file (&quot;dtm_13.val&quot;) for an already delineated</span>
        <span class="c1"># catchment (i.e., a &quot;catchment&quot; DEM file instead of a &quot;full&quot; DEM file), then</span>
        <span class="c1"># only the last step in the above procedure (i.e., run &quot;cppp&quot; just once) is</span>
        <span class="c1"># needed (make sure that &quot;Boundary channel construction&quot; is set to 0 in</span>
        <span class="c1"># &quot;hap.in&quot;).</span>

        <span class="k">if</span> <span class="n">DEM</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">DEM</span> <span class="o">=</span> <span class="n">DEM</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">hapin</span><span class="p">[</span><span class="s2">&quot;N&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">DEM</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hapin</span><span class="p">[</span><span class="s2">&quot;M&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">DEM</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">update_hapin</span><span class="p">(</span><span class="n">Lines</span><span class="p">,</span> <span class="n">hapin</span><span class="p">,</span> <span class="n">tmp_lnb</span><span class="p">,</span> <span class="n">tmp_param_value</span><span class="p">)</span>

            <span class="c1"># check consistency with hapin</span>

            <span class="c1"># check presence of the outlet</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">DEM</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error: outlet not defined&quot;</span><span class="p">)</span>
                <span class="n">DEM</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="c1"># self.DEM = DEM_withOutlet</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;:arrows_counterclockwise: [b]Update dtm_13 file[/b]&quot;</span><span class="p">)</span>
            <span class="c1"># self.update_dem(DEM)</span>
            <span class="c1"># self.update_zone()</span>

            <span class="c1"># import matplotlib.pyplot as plt</span>
            <span class="c1"># plt.imshow(np.flipud(DEM))</span>

            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;prepro/dtm_13.val&quot;</span><span class="p">),</span> <span class="s2">&quot;w+&quot;</span>
            <span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="c1"># use exponential notation</span>
                <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">DEM</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%1.4e</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="c1"># np.shape(DEM)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">update_cathyH</span><span class="p">(</span><span class="n">ROWMAX</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hapin</span><span class="p">[</span><span class="s2">&quot;M&quot;</span><span class="p">],</span> <span class="n">COLMAX</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hapin</span><span class="p">[</span><span class="s2">&quot;N&quot;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_dem_parameters</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">show</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">plt_CT</span><span class="o">.</span><span class="n">show_dem</span><span class="p">(</span>
                <span class="n">workdir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span>
                <span class="n">project_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span>
                <span class="n">hapin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hapin</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">pass</span></div>

<div class="viewcode-block" id="CATHY.update_dem_parameters"><a class="viewcode-back" href="../../content/api/generated/DA.cathy_DA.CATHY.html#DA.cathy_DA.CATHY.update_dem_parameters">[docs]</a>    <span class="k">def</span> <span class="nf">update_dem_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update DEM parameters - if no args reset to default values</span>


<span class="sd">        ivert</span>
<span class="sd">        =0 each layer will be parallel to the surface, including the base of the 3‐d grid. ZRATIO is applied to each vertical cross section.</span>
<span class="sd">        =1 base of the 3‐d grid will be flat, and ZRATIO is applied to each vertical cross section</span>
<span class="sd">        =2 base of the 3‐d grid will be flat, as will the NSTR‐1 horizontal cross sections above it. ZRATIO is applied only to the vertical cross section having the lowest elevation.</span>
<span class="sd">        =3 for each cell of the dem a single depth value is read in file input IIN60 (basement). ZRATIO is applied to each vertical cross section.</span>
<span class="sd">        =4 the first NSTR‐1 layers from the surface will be parallel to the surface and the base of the 3‐d grid will be flat. ZRATIO is applied only to the vertical cross section having the lowest elevation.</span>

<span class="sd">        isp</span>
<span class="sd">        =0 for flat surface layer (only one Z value is read in, and is replicated to all surface nodes);</span>
<span class="sd">            otherwise surface layer is not flat (Z values read in for each surface node);</span>
<span class="sd">            (for ISP=0, IVERT=0, 1, and 2 yield the same 3‐d mesh, given the same values of BASE and ZRATIO).</span>

<span class="sd">        base</span>
<span class="sd">        Value which defines the thickness or base of the 3‐d mesh.</span>
<span class="sd">        For IVERT=0, BASE is subtracted from each surface elevation value, so that each vertical cross section will be of thickness BASE, and the base of the 3‐d mesh will be parallel to the surface. For IVERT=1 or 2, BASE is subtracted from the lowest surface elevation value, say ZMIN, so that each vertical cross section will be of thickness (Z ‐ ZMIN) + BASE, where Z is the surface elevation for that cross section. The base of the 3‐d mesh will thus be flat.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span>
            <span class="s2">&quot;:arrows_counterclockwise: [b]update dem_parameters file [/b]&quot;</span>
        <span class="p">)</span>

        <span class="c1"># set default parameters</span>
        <span class="c1"># --------------------------------------------------------------------</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;dem_parameters&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span>
                <span class="s2">&quot;:pensive_face: [b]cannot find existing dem paramters[/b]&quot;</span>
            <span class="p">)</span>

            <span class="c1"># layers default</span>
            <span class="n">ltmp</span> <span class="o">=</span> <span class="p">[</span>
                <span class="mf">0.002</span><span class="p">,</span>
                <span class="mf">0.004</span><span class="p">,</span>
                <span class="mf">0.006</span><span class="p">,</span>
                <span class="mf">0.008</span><span class="p">,</span>
                <span class="mf">0.01</span><span class="p">,</span>
                <span class="mf">0.01</span><span class="p">,</span>
                <span class="mf">0.02</span><span class="p">,</span>
                <span class="mf">0.02</span><span class="p">,</span>
                <span class="mf">0.05</span><span class="p">,</span>
                <span class="mf">0.05</span><span class="p">,</span>
                <span class="mf">0.1</span><span class="p">,</span>
                <span class="mf">0.1</span><span class="p">,</span>
                <span class="mf">0.2</span><span class="p">,</span>
                <span class="mf">0.2</span><span class="p">,</span>
                <span class="mf">0.22</span><span class="p">,</span>
            <span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">dem_parameters</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;delta_x&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">hapin</span><span class="p">[</span>
                    <span class="s2">&quot;delta_x&quot;</span>
                <span class="p">],</span>  <span class="c1"># Cell dimensions for the resolution of the DEM</span>
                <span class="s2">&quot;delta_y&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">hapin</span><span class="p">[</span><span class="s2">&quot;delta_y&quot;</span><span class="p">],</span>
                <span class="s2">&quot;factor&quot;</span><span class="p">:</span> <span class="mf">1.0e0</span><span class="p">,</span>  <span class="c1"># Multiplicative factor for DEM values (e.g. to change the units of the elevation)</span>
                <span class="s2">&quot;dostep&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>  <span class="c1"># Step adopted in coarsening the mesh</span>
                <span class="s2">&quot;nzone&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>  <span class="c1"># The number of material types in the porous medium</span>
                <span class="s2">&quot;nstr&quot;</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span>  <span class="c1"># The number of vertical layers</span>
                <span class="s2">&quot;n1&quot;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span>  <span class="c1"># The maximum number of element connections to a node</span>
                <span class="s2">&quot;ivert&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>  <span class="c1">#</span>
                <span class="s2">&quot;isp&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s2">&quot;base&quot;</span><span class="p">:</span> <span class="mf">3.0</span><span class="p">,</span>
                <span class="s2">&quot;zratio(i),i=1,nstr&quot;</span><span class="p">:</span> <span class="n">ltmp</span><span class="p">,</span>
            <span class="p">}</span>

        <span class="c1"># create dictionnary from kwargs</span>
        <span class="k">for</span> <span class="n">keykwargs</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">keykwargs</span> <span class="o">==</span> <span class="s2">&quot;zratio&quot;</span><span class="p">:</span>
                <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;zratio(i),i=1,nstr&quot;</span>
                <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">rule</span><span class="p">(</span>
                        <span class="s2">&quot;:warning: warning messages above :warning:&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span>
                        <span class="sa">r</span><span class="s2">&quot;The sum of all the layers is not equal to 1 but to </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
                        <span class="p">),</span>
                        <span class="n">style</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">rule</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">key</span> <span class="o">=</span> <span class="n">keykwargs</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dem_parameters</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dem_parameters</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="n">dem_parameters_tmp</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dem_parameters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">strlst</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">value</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dem_parameters</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">strlst</span>

        <span class="c1">#         if (key +&#39;_list&#39;) in self.dem_parameters.keys() is False:</span>
        <span class="c1">#             dem_parameters_tmp[key +&#39;_list&#39;] = value</span>

        <span class="c1"># self.dem_parameters = self.dem_parameters | dem_parameters_tmp</span>
        <span class="c1"># write file</span>
        <span class="n">header_fmt</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_dirname</span><span class="p">,</span> <span class="s2">&quot;dem_parameters&quot;</span>
            <span class="p">),</span>
            <span class="s2">&quot;w+&quot;</span><span class="p">,</span>
        <span class="p">)</span> <span class="k">as</span> <span class="n">dem_parametersfile</span><span class="p">:</span>

            <span class="c1"># Write values first</span>
            <span class="c1"># -----------------------</span>
            <span class="n">counth</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">header_fmt</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">h</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">dem_parametersfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                        <span class="nb">str</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dem_parameters</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="n">counth</span><span class="p">])</span>
                        <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span>
                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dem_parameters</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="n">counth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
                        <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span>
                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dem_parameters</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="n">counth</span> <span class="o">+</span> <span class="mi">2</span><span class="p">])</span>
                        <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span>
                        <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
                    <span class="n">counth</span> <span class="o">+=</span> <span class="mi">3</span>
                <span class="k">if</span> <span class="n">h</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="c1"># print(str(list(self.dem_parameters.values())[counth]))</span>
                    <span class="n">dem_parametersfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                        <span class="nb">str</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dem_parameters</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="n">counth</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
                    <span class="n">counth</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># Write keys</span>
            <span class="c1"># -----------------------</span>
            <span class="n">counth</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">header_fmt</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">h</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">dem_parametersfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                        <span class="nb">str</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dem_parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="n">counth</span><span class="p">])</span>
                        <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span>
                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dem_parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="n">counth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
                        <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span>
                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dem_parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="n">counth</span> <span class="o">+</span> <span class="mi">2</span><span class="p">])</span>
                        <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span>
                        <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
                    <span class="n">counth</span> <span class="o">+=</span> <span class="mi">3</span>
                <span class="k">if</span> <span class="n">h</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">dem_parametersfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                        <span class="nb">str</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dem_parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="n">counth</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
                    <span class="n">counth</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">dem_parametersfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">pass</span></div>

<div class="viewcode-block" id="CATHY.update_dem"><a class="viewcode-back" href="../../content/api/generated/DA.cathy_DA.CATHY.html#DA.cathy_DA.CATHY.update_dem">[docs]</a>    <span class="k">def</span> <span class="nf">update_dem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">DEM</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update zone file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dem : np.array([]), optional</span>
<span class="sd">            2d numpy array describing the zone for x and y direction.</span>
<span class="sd">            The array dim must be equal to DEM dim.</span>
<span class="sd">            The default is [].&quot;&quot;&quot;</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;prepro/dem&quot;</span><span class="p">),</span> <span class="s2">&quot;w+&quot;</span>
        <span class="p">)</span> <span class="k">as</span> <span class="n">demfile</span><span class="p">:</span>

            <span class="n">demfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;north:     0&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">demfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;south:     &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hapin</span><span class="p">[</span><span class="s2">&quot;yllcorner&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">demfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;east:     0&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">demfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;west:     &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hapin</span><span class="p">[</span><span class="s2">&quot;xllcorner&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">demfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;rows:     &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hapin</span><span class="p">[</span><span class="s2">&quot;N&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">demfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;cols:     &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hapin</span><span class="p">[</span><span class="s2">&quot;M&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">demfile</span><span class="p">,</span> <span class="n">DEM</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%1.4e</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="c1"># np.shape(DEM)</span>
        <span class="n">demfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DEM</span> <span class="o">=</span> <span class="n">DEM</span></div>

<div class="viewcode-block" id="CATHY.update_zone"><a class="viewcode-back" href="../../content/api/generated/DA.cathy_DA.CATHY.html#DA.cathy_DA.CATHY.update_zone">[docs]</a>    <span class="k">def</span> <span class="nf">update_zone</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zone</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update zone file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        zone : np.array([]), optional</span>
<span class="sd">            2d numpy array describing the zone for x and y direction.</span>
<span class="sd">            The array dim must be equal to DEM dim.</span>
<span class="sd">            The smallest numbering is 1 (not 0!)</span>
<span class="sd">            If zone is empty, reset to homogeneous zone = 1</span>
<span class="sd">            The default is [].</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        .. note::</span>
<span class="sd">            - Create object zone variable</span>
<span class="sd">            - Update dem_parameters file (number of zones).</span>
<span class="sd">            - Update parm file.</span>
<span class="sd">            - Update CATHYH file.</span>
<span class="sd">            - Update vtk mesh file.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;:arrows_counterclockwise: [b]update zone file [/b]&quot;</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;prepro/zone&quot;</span><span class="p">),</span> <span class="s2">&quot;w+&quot;</span>
        <span class="p">)</span> <span class="k">as</span> <span class="n">zonefile</span><span class="p">:</span>

            <span class="n">zonefile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;north:     0&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">zonefile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;south:     &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hapin</span><span class="p">[</span><span class="s2">&quot;yllcorner&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">zonefile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;east:     0&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">zonefile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;west:     &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hapin</span><span class="p">[</span><span class="s2">&quot;xllcorner&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">zonefile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;rows:     &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hapin</span><span class="p">[</span><span class="s2">&quot;M&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">zonefile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;cols:     &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hapin</span><span class="p">[</span><span class="s2">&quot;N&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">zone</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">zone</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">hapin</span><span class="p">[</span><span class="s2">&quot;M&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">hapin</span><span class="p">[</span><span class="s2">&quot;N&quot;</span><span class="p">]])]</span>
                <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">zonefile</span><span class="p">,</span> <span class="n">zone</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%i</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># if np.shape(zone)== :</span>
                <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">zonefile</span><span class="p">,</span> <span class="n">zone</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%i</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">zonefile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">zone</span> <span class="o">=</span> <span class="n">zone</span>

        <span class="c1"># update number of zone in the dem parameter file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_dem_parameters</span><span class="p">(</span><span class="n">nzone</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">zone</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_parm</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_cathyH</span><span class="p">(</span><span class="n">MAXZON</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">zone</span><span class="p">)))</span></div>

    <span class="c1"># %% INPUT FILES</span>

<div class="viewcode-block" id="CATHY.update_parm"><a class="viewcode-back" href="../../content/api/generated/DA.cathy_DA.CATHY.html#DA.cathy_DA.CATHY.update_parm">[docs]</a>    <span class="k">def</span> <span class="nf">update_parm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update parm file</span>
<span class="sd">        .. note:</span>
<span class="sd">            - create object zone parm</span>
<span class="sd">            - Updated CATHYH file (NPRT and NUMVP).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;:arrows_counterclockwise: [b]update parm file [/b]&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parm</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>

            <span class="c1"># set default parameters</span>
            <span class="c1"># --------------------------------------------------------------------</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parm</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;IPRT1&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>  <span class="c1"># Flag for output of input and coordinate data</span>
                <span class="s2">&quot;NCOUT&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s2">&quot;TRAFLAG&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>  <span class="c1"># Flag for transport</span>
                <span class="s2">&quot;ISIMGR&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>  <span class="c1"># Flag for type of simulation and type of surface grid</span>
                <span class="s2">&quot;PONDH_MIN&quot;</span><span class="p">:</span> <span class="mf">0.00</span><span class="p">,</span>  <span class="c1"># Minimum ponding head</span>
                <span class="s2">&quot;VELREC&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s2">&quot;KSLOPE&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s2">&quot;TOLKSL&quot;</span><span class="p">:</span> <span class="mf">0.01</span><span class="p">,</span>
                <span class="s2">&quot;PKRL&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mf">3.0</span><span class="p">,</span>
                <span class="s2">&quot;PKRR&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>
                <span class="s2">&quot;PSEL&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mf">3.0</span><span class="p">,</span>
                <span class="s2">&quot;PSER&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>
                <span class="s2">&quot;PDSE1L&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mf">3.0</span><span class="p">,</span>
                <span class="s2">&quot;PDSE1R&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mf">2.5</span><span class="p">,</span>
                <span class="s2">&quot;PDSE2L&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mf">1.5</span><span class="p">,</span>
                <span class="s2">&quot;PDSE2R&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>
                <span class="s2">&quot;ISFONE&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s2">&quot;ISFCVG&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s2">&quot;DUPUIT&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s2">&quot;TETAF&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
                <span class="s2">&quot;LUMP&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s2">&quot;IOPT&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s2">&quot;NLRELX&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s2">&quot;OMEGA&quot;</span><span class="p">:</span> <span class="mf">0.8</span><span class="p">,</span>
                <span class="s2">&quot;L2NORM&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s2">&quot;TOLUNS&quot;</span><span class="p">:</span> <span class="mf">1.0e-4</span><span class="p">,</span>
                <span class="s2">&quot;TOLSWI&quot;</span><span class="p">:</span> <span class="mf">1.0e30</span><span class="p">,</span>
                <span class="s2">&quot;ERNLMX&quot;</span><span class="p">:</span> <span class="mf">1.0e30</span><span class="p">,</span>
                <span class="s2">&quot;ITUNS&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
                <span class="s2">&quot;ITUNS1&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
                <span class="s2">&quot;ITUNS2&quot;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
                <span class="s2">&quot;ISOLV&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                <span class="s2">&quot;ITMXCG&quot;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span>
                <span class="s2">&quot;TOLCG&quot;</span><span class="p">:</span> <span class="mf">1.0e-10</span><span class="p">,</span>
                <span class="s2">&quot;DELTAT&quot;</span><span class="p">:</span> <span class="mf">0.01</span><span class="p">,</span>
                <span class="s2">&quot;DTMIN&quot;</span><span class="p">:</span> <span class="mf">0.00001</span><span class="p">,</span>  <span class="c1"># Minimum FLOW3D time step size allowed</span>
                <span class="s2">&quot;DTMAX&quot;</span><span class="p">:</span> <span class="mf">10.0</span><span class="p">,</span>  <span class="c1"># Maximum FLOW3D time step size allowed</span>
                <span class="c1"># Time at end of simulation (TMAX is set to 0.0 for steady state problem)</span>
                <span class="s2">&quot;TMAX&quot;</span><span class="p">:</span> <span class="mf">3600.0</span><span class="p">,</span>
                <span class="s2">&quot;DTMAGA&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
                <span class="s2">&quot;DTMAGM&quot;</span><span class="p">:</span> <span class="mf">1.1</span><span class="p">,</span>
                <span class="s2">&quot;DTREDS&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
                <span class="s2">&quot;DTREDM&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
                <span class="s2">&quot;IPRT&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
                <span class="c1"># What is included into the output vtk file, CATHY default is pressure heads 1;</span>
                <span class="c1"># to add saturation VTKF&gt;=2</span>
                <span class="s2">&quot;VTKF&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                <span class="s2">&quot;NPRT&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
                <span class="c1"># Output times to record</span>
                <span class="s2">&quot;(TIMPRT(I),I=1,NPRT)&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1800.0</span><span class="p">,</span> <span class="mf">3600.0</span><span class="p">,</span> <span class="mf">7200.0</span><span class="p">],</span>
                <span class="s2">&quot;NUMVP&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s2">&quot;(NODVP(I),I=1,NUMVP)&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span>  <span class="c1"># should be positive (first node is 1)</span>
                <span class="s2">&quot;NR&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s2">&quot;NUM_QOUT&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s2">&quot;(ID_QOUT(I),I=1,NUM_QOUT)&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">441</span><span class="p">],</span>
            <span class="p">}</span>

        <span class="c1"># create self.parm dictionnary from kwargs</span>
        <span class="c1"># --------------------------------------------------------------------</span>
        <span class="k">for</span> <span class="n">kk</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">kk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parm</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;key: </span><span class="si">{</span><span class="n">kk</span><span class="si">}</span><span class="s2"> | value: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># times of interest TIMPRTi</span>
            <span class="c1"># ----------------------------------------------------------------</span>
            <span class="k">if</span> <span class="n">kk</span> <span class="o">==</span> <span class="s2">&quot;TIMPRTi&quot;</span><span class="p">:</span>
                <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;(TIMPRT(I),I=1,NPRT)&quot;</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">parm</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

            <span class="c1"># points of interest NODVP</span>
            <span class="c1"># ----------------------------------------------------------------</span>
            <span class="k">elif</span> <span class="n">kk</span> <span class="o">==</span> <span class="s2">&quot;NODVP&quot;</span><span class="p">:</span>
                <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;(NODVP(I),I=1,NUMVP)&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parm</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

                <span class="c1"># check if consistency between node of interest and</span>
                <span class="c1"># number of nodes of interest</span>
                <span class="c1"># ------------------------------------------------------------</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parm</span><span class="p">[</span><span class="s2">&quot;NUMVP&quot;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parm</span><span class="p">[</span><span class="s2">&quot;NUMVP&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

            <span class="c1"># other type of kwargs</span>
            <span class="c1"># ----------------------------------------------------------------</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">kk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parm</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parm</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

                    <span class="c1"># check if consistency between times of interest and TMAX</span>
                    <span class="c1"># ------------------------------------------------------------</span>
                    <span class="k">if</span> <span class="s2">&quot;(TIMPRT(I),I=1,NPRT)&quot;</span> <span class="ow">in</span> <span class="n">kk</span><span class="p">:</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parm</span><span class="p">[</span><span class="s2">&quot;TMAX&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parm</span><span class="p">[</span><span class="s2">&quot;(TIMPRT(I),I=1,NPRT)&quot;</span><span class="p">]):</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">parm</span><span class="p">[</span><span class="s2">&quot;TMAX&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parm</span><span class="p">[</span><span class="s2">&quot;(TIMPRT(I),I=1,NPRT)&quot;</span><span class="p">])</span>

        <span class="n">warnings_parm</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># check if consistency between times of interest and</span>
        <span class="c1"># number of times of interest</span>
        <span class="c1"># ------------------------------------------------------------</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parm</span><span class="p">[</span><span class="s2">&quot;(TIMPRT(I),I=1,NPRT)&quot;</span><span class="p">])</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parm</span><span class="p">[</span><span class="s2">&quot;NPRT&quot;</span><span class="p">]:</span>
            <span class="n">warnings_parm</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="s2">&quot;Adjusting NPRT with respect to time of interests requested&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parm</span><span class="p">[</span><span class="s2">&quot;NPRT&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parm</span><span class="p">[</span><span class="s2">&quot;(TIMPRT(I),I=1,NPRT)&quot;</span><span class="p">])</span>

        <span class="c1"># check if consistency between DELTAT, DTMIN, and DTMAX</span>
        <span class="c1"># ------------------------------------------------------------</span>

        <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parm</span><span class="p">[</span><span class="s2">&quot;(TIMPRT(I),I=1,NPRT)&quot;</span><span class="p">]))</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Vtk time steps should be monotonically increasing&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parm</span><span class="p">[</span><span class="s2">&quot;DELTAT&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="nb">min</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parm</span><span class="p">[</span><span class="s2">&quot;(TIMPRT(I),I=1,NPRT)&quot;</span><span class="p">])</span>
        <span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">parm</span><span class="p">[</span><span class="s2">&quot;DELTAT&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">1e-2</span> <span class="o">*</span> <span class="nb">min</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parm</span><span class="p">[</span><span class="s2">&quot;(TIMPRT(I),I=1,NPRT)&quot;</span><span class="p">])</span>
        <span class="p">):</span>
            <span class="n">warnings_parm</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="s2">&quot;Adjusting DELTAT with respect to time of interests requested&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parm</span><span class="p">[</span><span class="s2">&quot;DELTAT&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parm</span><span class="p">[</span><span class="s2">&quot;(TIMPRT(I),I=1,NPRT)&quot;</span><span class="p">]))</span> <span class="o">/</span> <span class="mf">1e2</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parm</span><span class="p">[</span><span class="s2">&quot;DELTAT&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">parm</span><span class="p">[</span><span class="s2">&quot;DTMIN&quot;</span><span class="p">]:</span>
            <span class="n">warnings_parm</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="s2">&quot;adjusting 2*DTMIN == DELTAT: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parm</span><span class="p">[</span><span class="s2">&quot;DTMIN&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parm</span><span class="p">[</span><span class="s2">&quot;DTMIN&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parm</span><span class="p">[</span><span class="s2">&quot;DELTAT&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parm</span><span class="p">[</span><span class="s2">&quot;DELTAT&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parm</span><span class="p">[</span><span class="s2">&quot;DTMAX&quot;</span><span class="p">]:</span>
            <span class="n">warnings_parm</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Adjusting DTMAX == 2*DELTAT&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parm</span><span class="p">[</span><span class="s2">&quot;DTMAX&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">parm</span><span class="p">[</span><span class="s2">&quot;DELTAT&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parm</span><span class="p">[</span><span class="s2">&quot;TMAX&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parm</span><span class="p">[</span><span class="s2">&quot;(TIMPRT(I),I=1,NPRT)&quot;</span><span class="p">]):</span>
            <span class="n">warnings_parm</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="s2">&quot;Adjusting TMAX with respect to time of interests requested&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parm</span><span class="p">[</span><span class="s2">&quot;TMAX&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parm</span><span class="p">[</span><span class="s2">&quot;(TIMPRT(I),I=1,NPRT)&quot;</span><span class="p">])</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">warnings_parm</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">rule</span><span class="p">(</span>
                <span class="s2">&quot;:warning: warning messages above :warning:&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">ww</span> <span class="ow">in</span> <span class="n">warnings_parm</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">warnings_parm</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">rule</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span><span class="p">)</span>

        <span class="c1"># transform array args to list</span>
        <span class="c1"># --------------------------------------------------------------------</span>
        <span class="k">for</span> <span class="n">kk</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parm</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="s2">&quot;numpy.array&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parm</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="c1"># update CATHYH</span>
        <span class="c1"># --------------------------------------------------------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_cathyH</span><span class="p">(</span>
            <span class="n">MAXPRT</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parm</span><span class="p">[</span><span class="s2">&quot;NPRT&quot;</span><span class="p">],</span>
            <span class="n">MAXVP</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parm</span><span class="p">[</span><span class="s2">&quot;NUMVP&quot;</span><span class="p">],</span>
            <span class="n">indent</span><span class="o">=</span><span class="s2">&quot;           :arrow_right_hook:&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># write parm file</span>
        <span class="c1"># --------------------------------------------------------------------</span>
        <span class="k">if</span> <span class="s2">&quot;filename&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">file2write</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">file2write</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_dirname</span><span class="p">,</span> <span class="s2">&quot;parm&quot;</span>
            <span class="p">)</span>

        <span class="c1"># backup file during DA scheme cycle</span>
        <span class="c1"># --------------------------------------------------------------------</span>
        <span class="n">backup</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="s2">&quot;backup&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">backup</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;backup&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">backup</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">count_DA_cycle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">dst_dir</span> <span class="o">=</span> <span class="n">file2write</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">count_DA_cycle</span><span class="p">)</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">file2write</span><span class="p">,</span> <span class="n">dst_dir</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_write_parm_file</span><span class="p">(</span><span class="n">file2write</span><span class="p">)</span>

        <span class="k">pass</span></div>

    <span class="k">def</span> <span class="nf">_write_parm_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file2write</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Overwrite existing parm file</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        New overwritten file.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># header_fmt_parm = [3, 3, 2, 4, 4, 3, 3, 2, 4, 3, 3, 4, 4, 3, 2, 1, 2]</span>
        <span class="n">header_fmt_parm</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
        <span class="n">counth</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># with open(</span>
        <span class="c1">#     os.path.join(self.workdir, self.project_name, self.input_dirname, &quot;parm&quot;),</span>
        <span class="c1">#     &quot;w+&quot;,</span>
        <span class="c1"># ) as parmfile:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file2write</span><span class="p">,</span> <span class="s2">&quot;w+&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">parmfile</span><span class="p">:</span>

            <span class="c1"># Write line by line according to header format</span>
            <span class="c1"># ----------------------------------------------------------------</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">h</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">header_fmt_parm</span><span class="p">):</span>
                <span class="n">left</span> <span class="o">=</span> <span class="n">right</span> <span class="o">=</span> <span class="p">[]</span>

                <span class="c1"># left = values</span>
                <span class="c1"># ------------------------------------------------------------</span>
                <span class="n">left</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parm</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="n">counth</span> <span class="p">:</span> <span class="n">counth</span> <span class="o">+</span> <span class="n">h</span><span class="p">])</span>
                <span class="n">left</span> <span class="o">=</span> <span class="n">left</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;[]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="n">left</span> <span class="o">=</span> <span class="n">left</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;[]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;[&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

                <span class="c1"># right = keys</span>
                <span class="c1"># ------------------------------------------------------------</span>
                <span class="n">right</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parm</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="n">counth</span> <span class="p">:</span> <span class="n">counth</span> <span class="o">+</span> <span class="n">h</span><span class="p">])</span>
                <span class="n">right</span> <span class="o">=</span> <span class="n">right</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;[]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="n">right</span> <span class="o">=</span> <span class="n">right</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

                <span class="c1"># add left + right</span>
                <span class="c1"># ------------------------------------------------------------</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">left</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">right</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="n">counth</span> <span class="o">+=</span> <span class="n">h</span>
                <span class="n">parmfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">line</span><span class="p">))</span>

        <span class="n">parmfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">pass</span>

<div class="viewcode-block" id="CATHY.update_ic"><a class="viewcode-back" href="../../content/api/generated/DA.cathy_DA.CATHY.html#DA.cathy_DA.CATHY.update_ic">[docs]</a>    <span class="k">def</span> <span class="nf">update_ic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">INDP</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">IPOND</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">WTPOSITION</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The initial conditions file contains the pressure heads distribution for the study area (INDP)</span>
<span class="sd">        For example, to simulate a uniform water table depth or 0.5 m or 1.0 m from the ground surface,</span>
<span class="sd">        INDP=3 and WTHEIGHT=4.5 are selected</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        INDP : int, optional</span>
<span class="sd">            Flag for pressure head initial conditions (all nodes). The default is 2.</span>

<span class="sd">            - =0 for input of uniform initial conditions (one value read in)</span>
<span class="sd">            - =1 for input of non-uniform IC&#39;s (one value read in for each node)</span>
<span class="sd">            - =2 for calculation of fully saturated vertical hydrostatic equilibrium IC&#39;s</span>
<span class="sd">              (calculated in subroutine ICVHE). In the case of IPOND&gt;0, the fully saturated</span>
<span class="sd">              hydrostatic IC is calculated (in subroutine ICVHEPOND) starting from the ponding head</span>
<span class="sd">              values at the surface nodes, rather than surface pressure heads of 0.</span>
<span class="sd">            - =3 for calculation of partially saturated vertical hydrostatic equilibrium IC&#39;s</span>
<span class="sd">              (calculated in subroutine ICVHWT) with the water table height (relative to the base</span>
<span class="sd">              of the 3‐d grid) given by parameter WTHEIGHT</span>
<span class="sd">            - =4 for calculation of partially saturated vertical hydrostatic equilibrium IC&#39;s</span>
<span class="sd">              (calculated in subroutine ICVDWT) with the water table depth (relative to the surface</span>
<span class="sd">              of the 3‐d grid) given by parameter WTHEIGHT</span>

<span class="sd">        IPOND : int, optional</span>
<span class="sd">            Flag for ponding head initial conditions (surface nodes). The default is 0.</span>

<span class="sd">            - =0 no input of ponding head initial conditions; otherwise (IPOND = 1 or 2) ponding</span>
<span class="sd">              head initial conditions are read into PONDNOD, and, where PONDNOD &gt; 0, these values</span>
<span class="sd">              are used to update the surface node values in PtimeP read in according to the</span>
<span class="sd">              previous INDP flag</span>
<span class="sd">            - =1 uniform ponding head initial conditions (one value read in)</span>
<span class="sd">            - =2 non-uniform ponding head initial conditions (one value read in for each node)</span>

<span class="sd">        WTPOSITION : float, optional</span>
<span class="sd">            For the case INDP=3, specifies the initial water table height relative to</span>
<span class="sd">            the base of the 3‐d grid. The default is 0.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        new ic file written/overwritten.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="s2">&quot;shellprint_update&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;shellprint_update&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;:arrows_counterclockwise: [b]Update ic[/b]&quot;</span><span class="p">)</span>

        <span class="c1">#  check value of WTPOSITION</span>
        <span class="c1"># --------------------------------------------------------------------</span>
        <span class="c1"># For the case INDP=3, specifies the initial water table</span>
        <span class="c1"># height relative to the base of the 3‐d grid</span>
        <span class="c1"># if WTPOSITION&gt;0:</span>
        <span class="c1">#     print(&#39;WTPOSITION must be negative - water table height</span>
        <span class="c1"># relative to the base of the 3‐d grid&#39;)</span>
        <span class="c1">#     sys.exit()</span>

        <span class="c1"># set default parameters</span>
        <span class="c1"># --------------------------------------------------------------------</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ic</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;INDP&quot;</span><span class="p">:</span> <span class="n">INDP</span><span class="p">,</span>
            <span class="s2">&quot;IPOND&quot;</span><span class="p">:</span> <span class="n">IPOND</span><span class="p">,</span>
            <span class="c1"># For the case INDP=3, specifies the initial water table</span>
            <span class="c1"># height relative to the base of the 3‐d grid</span>
            <span class="s2">&quot;WTPOSITION&quot;</span><span class="p">:</span> <span class="n">WTPOSITION</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="c1"># write ic file</span>
        <span class="c1"># --------------------------------------------------------------------</span>

        <span class="k">if</span> <span class="s2">&quot;filename&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_dirname</span><span class="p">,</span> <span class="s2">&quot;ic&quot;</span>
            <span class="p">)</span>

        <span class="n">backup</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="s2">&quot;backup&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">backup</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;backup&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">backup</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">count_DA_cycle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">dst_dir</span> <span class="o">=</span> <span class="n">filename</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">count_DA_cycle</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">dst_dir</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;w+&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">icfile</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">INDP</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">icfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">INDP</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">IPOND</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;INDP </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="s2">&quot;pressure_head_ini&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">icfile</span><span class="p">,</span> <span class="p">[</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;pressure_head_ini&quot;</span><span class="p">]],</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%1.3e</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">map_prop2mesh</span><span class="p">({</span><span class="s2">&quot;ic&quot;</span><span class="p">:</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;pressure_head_ini&quot;</span><span class="p">]})</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Missing initial pressure value&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">INDP</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">pressure_head_ini</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;pressure_head_ini&quot;</span><span class="p">]</span>
                <span class="n">icfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">INDP</span><span class="p">)</span>
                    <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span>
                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">IPOND</span><span class="p">)</span>
                    <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span>
                    <span class="o">+</span> <span class="s2">&quot;INDP&quot;</span>
                    <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span>
                    <span class="o">+</span> <span class="s2">&quot;IPOND&quot;</span>
                    <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="p">)</span>
                <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">icfile</span><span class="p">,</span> <span class="n">pressure_head_ini</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%1.3e</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">map_prop2mesh</span><span class="p">({</span><span class="s2">&quot;ic&quot;</span><span class="p">:</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;pressure_head_ini&quot;</span><span class="p">]})</span>

            <span class="k">elif</span> <span class="n">INDP</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]:</span>
                <span class="n">icfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">INDP</span><span class="p">)</span>
                    <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span>
                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">IPOND</span><span class="p">)</span>
                    <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span>
                    <span class="o">+</span> <span class="s2">&quot;INDP&quot;</span>
                    <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span>
                    <span class="o">+</span> <span class="s2">&quot;IPOND&quot;</span>
                    <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="p">)</span>
                <span class="n">icfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">WTPOSITION</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;WTPOSITION&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">icfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">pass</span></div>

<div class="viewcode-block" id="CATHY.update_atmbc"><a class="viewcode-back" href="../../content/api/generated/DA.cathy_DA.CATHY.html#DA.cathy_DA.CATHY.update_atmbc">[docs]</a>    <span class="k">def</span> <span class="nf">update_atmbc</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">HSPATM</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">IETO</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">VALUE</span><span class="o">=</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
        <span class="n">netValue</span><span class="o">=</span><span class="p">[],</span>
        <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Atmospheric forcing term (atmbc - IIN6)</span>

<span class="sd">        ..note:</span>


<span class="sd">                1 1                HSPATM,IETO</span>
<span class="sd">                0.0000000e+00      time</span>
<span class="sd">                5.5e-06              VALUE</span>
<span class="sd">                12.000000e+03      time</span>
<span class="sd">                0.00                 VALUE</span>
<span class="sd">                18.000000e+03      time</span>
<span class="sd">                0.00                 VALUE</span>

<span class="sd">                The values are those of a 200-min rainfall event at a uniform</span>
<span class="sd">                intensity of 3.3·10-4 m/min, followed by 100 min of drainage.</span>

<span class="sd">        ..note:</span>

<span class="sd">                In case of simultaneous precipitation and evaporation, we impose at</span>
<span class="sd">                the surface the net flux, i.e., precipitation minus evaporation.</span>





<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        HSPATM : int, optional</span>
<span class="sd">            - =0 for spatially variable atmospheric boundary condition inputs;</span>
<span class="sd">            blank or =9999 if unit IIN6 input is to be ignored; otherwise atmospheric BC&#39;s are</span>
<span class="sd">            homogeneous in space.</span>
<span class="sd">        IETO : int, optional</span>
<span class="sd">            - =0 for linear interpolation of the atmospheric boundary condition inputs between different</span>
<span class="sd">            - otherwise the inputs are assigned as a piecewise constant function (ietograph).</span>
<span class="sd">            The default is 0.</span>
<span class="sd">        time : list</span>
<span class="sd">            ATMBC Times in seconds. The default is None.</span>
<span class="sd">        VALUE : list</span>
<span class="sd">            List of array. The default is [Precipitation, EvapoTranspiration].</span>
<span class="sd">        show : bool, optional</span>
<span class="sd">            Plot atmbc. The default is False.</span>
<span class="sd">        verbose : bool, optional</span>
<span class="sd">            Display. The default is False.</span>
<span class="sd">        **kwargs</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        ..note:</span>

<span class="sd">                - Update parm file (NPRT).</span>
<span class="sd">                - Update CATHYH file (MAXPRT).</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="s2">&quot;shellprint_update&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;shellprint_update&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;:arrows_counterclockwise: [b]Update atmbc[/b]&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">netValue</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">v_atmbc</span> <span class="o">=</span> <span class="n">netValue</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">VALUE</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>
            <span class="p">):</span>  <span class="c1"># take the difference between Precipitation and EvapoTranspiration</span>
                <span class="n">v_atmbc</span> <span class="o">=</span> <span class="n">VALUE</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="nb">abs</span><span class="p">(</span><span class="n">VALUE</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">v_atmbc</span> <span class="o">=</span> <span class="n">VALUE</span>

        <span class="nb">len</span><span class="p">(</span><span class="n">v_atmbc</span><span class="p">)</span>
        <span class="nb">len</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
        <span class="c1"># set default parameters</span>
        <span class="c1"># --------------------------------------------------------------------</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">atmbc</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;HSPATM&quot;</span><span class="p">:</span> <span class="n">HSPATM</span><span class="p">,</span> <span class="s2">&quot;IETO&quot;</span><span class="p">:</span> <span class="n">IETO</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="n">time</span><span class="p">,</span> <span class="s2">&quot;VALUE&quot;</span><span class="p">:</span> <span class="n">VALUE</span><span class="p">}</span>

        <span class="c1"># len(self.atmbc[&#39;time&#39;])</span>
        <span class="c1"># overwrite existing input atmbc file</span>
        <span class="c1"># --------------------------------------------------------------------</span>

        <span class="k">if</span> <span class="s2">&quot;filename&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_dirname</span><span class="p">,</span> <span class="s2">&quot;atmbc&quot;</span>
            <span class="p">)</span>

        <span class="n">backup</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="s2">&quot;backup&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">backup</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;backup&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">backup</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">count_DA_cycle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">dst_dir</span> <span class="o">=</span> <span class="n">filename</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">count_DA_cycle</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">dst_dir</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;w+&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">atmbcfile</span><span class="p">:</span>
            <span class="n">atmbcfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">HSPATM</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">IETO</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;HSPATM&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;IETO&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="p">)</span>

            <span class="c1"># if v_atmbc is a scalar meaning that atmbc are homoegenous</span>
            <span class="c1"># -----------------------------------------------------------------</span>
            <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">v_atmbc</span><span class="p">):</span>

                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
                <span class="n">atmbcfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:.3e}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;time&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="c1"># atmbcfile.close()</span>

                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="o">|</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                    <span class="n">atmbcfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:.3e}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;VALUE&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="c1"># atmbcfile.write(str(v) + &quot;\t&quot; + &quot;VALUE&quot; + &quot;\n&quot;)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># atmbcfile.write(str(v) + &quot;\t&quot; + &quot;VALUE&quot; + &quot;\n&quot;)</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">atmbcfile</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%1.3e</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">atmbcfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_parm</span><span class="p">(</span><span class="n">TIMPRTi</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">time</span><span class="p">),</span> <span class="n">NPRT</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">time</span><span class="p">),</span> <span class="n">TMAX</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">time</span><span class="p">))</span>

        <span class="c1"># don&#39;t need to update if sequential DA as the cathy.exe is already created</span>
        <span class="c1"># ---------------------------------------------------------------------</span>
        <span class="k">if</span> <span class="s2">&quot;omit_cathyH&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_cathyH</span><span class="p">(</span><span class="n">MAXPRT</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">time</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
            <span class="c1"># if HSPATM !=0:</span>
            <span class="c1">#     print(&#39;impossible to plot for non homogeneous atmbc&#39;)</span>
            <span class="c1">#     # sys.exit()</span>
            <span class="c1"># else:</span>
            <span class="c1"># x_units = &quot;sec&quot;</span>
            <span class="c1"># for key, value in kwargs.items():</span>
            <span class="c1">#     if key == &quot;x_units&quot;:</span>
            <span class="c1">#         x_units = value</span>
            <span class="n">plt_CT</span><span class="o">.</span><span class="n">show_atmbc</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">VALUE</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="CATHY.update_nansfdirbc"><a class="viewcode-back" href="../../content/api/generated/DA.cathy_DA.CATHY.html#DA.cathy_DA.CATHY.update_nansfdirbc">[docs]</a>    <span class="k">def</span> <span class="nf">update_nansfdirbc</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">time</span><span class="o">=</span><span class="p">[],</span>
        <span class="n">NDIR</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">NDIRC</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">NQ3</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">no_flow</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">bound_xyz</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">pressure_head</span><span class="o">=</span><span class="p">[],</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dirichlet Boundary conditions (or specified pressure) at time t</span>

<span class="sd">        - To simulate the no-flow boundaries conditions for the bottom and</span>
<span class="sd">          vertical sides of the domain it is necessary to set NDIR and NDIRC</span>
<span class="sd">          equal to zero.</span>
<span class="sd">        - To simulate different boundary conditions, it is necessary to</span>
<span class="sd">          indicate the number of selected nodes through NDIR or NDIRC,</span>
<span class="sd">          then to specify the node ID’s that you want to consider and</span>
<span class="sd">          eventually the value of pressure head or flux that you want to assign.</span>


<span class="sd">        ..note::</span>
<span class="sd">            update_nansfdirbc use the grid3d to refer to mesh nodes</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        time : np.array([]), optional</span>
<span class="sd">            Absolute simulation time in sec.</span>
<span class="sd">            The default is [].</span>
<span class="sd">        NDIR : int, optional</span>
<span class="sd">            Number of non-atmospheric, non‐seepage face Dirichlet</span>
<span class="sd">            nodes in 2-d mesh. The BC&#39;s assigned to these surface nodes are replicated vertically.</span>
<span class="sd">            The default is 0.</span>
<span class="sd">        NDIRC : int, optional</span>
<span class="sd">            Number of &#39;fixed&#39; non-atmospheric, non-seepage face Dirichlet</span>
<span class="sd">            nodes in 3‐d mesh (&#39;fixed&#39; in the sense that these BC&#39;s are not replicated to other nodes ‐</span>
<span class="sd">            compare NDIR).</span>
<span class="sd">            The default is 0.</span>
<span class="sd">        NQ3 : int, optional</span>
<span class="sd">            Number of non-atmospheric, non‐seepage face Neumann nodes in 3‐d</span>
<span class="sd">            mesh.</span>
<span class="sd">            The default is None.</span>
<span class="sd">        noflow : Bool, optional</span>
<span class="sd">            To simulate the no-flow boundaries conditions for the bottom and</span>
<span class="sd">            # vertical sides of the domain. The default is True.</span>
<span class="sd">        bound_xyz : TYPE, optional</span>
<span class="sd">            DESCRIPTION. The default is None.</span>
<span class="sd">        pressure_head : TYPE, optional</span>
<span class="sd">            Specify a value of node pressure head to impose as Dirichlet boundary condition.</span>
<span class="sd">            The default is [].</span>


<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># check that the mesh exist</span>
        <span class="c1"># --------------------------------------------------------------------</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grid3d</span> <span class="o">=</span> <span class="n">in_CT</span><span class="o">.</span><span class="n">read_grid3d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;grid3d missing - need to run the processor with IPRT1=3 first&quot;</span><span class="p">)</span>

        <span class="c1"># check that mesh_bound_cond_df exist</span>
        <span class="c1"># --------------------------------------------------------------------</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;mesh_bound_cond_df&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">init_boundary_conditions</span><span class="p">(</span>
                <span class="s2">&quot;nansfdirbc&quot;</span><span class="p">,</span>
                <span class="n">time</span><span class="p">,</span>
                <span class="n">NDIR</span><span class="o">=</span><span class="n">NDIR</span><span class="p">,</span>
                <span class="n">NDIRC</span><span class="o">=</span><span class="n">NDIRC</span><span class="p">,</span>
                <span class="n">pressure_head</span><span class="o">=</span><span class="n">pressure_head</span><span class="p">,</span>
                <span class="n">no_flow</span><span class="o">=</span><span class="n">no_flow</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># apply BC</span>
        <span class="c1"># --------------------------------------------------------------------</span>
        <span class="k">if</span> <span class="n">no_flow</span><span class="p">:</span>  <span class="c1"># Dirichlet  == 0</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;shortcut set_BC_laterals mesh dataframe&quot;</span><span class="p">)</span>
            <span class="c1"># self.set_BC_laterals(time=time, BC_type=&#39;Dirichlet&#39;, val=0)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Non homogeneous Dirichlet Boundary conditions Not yet implemented&quot;</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_parm</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_cathyH</span><span class="p">()</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_dirname</span><span class="p">,</span> <span class="s2">&quot;nansfdirbc&quot;</span>
            <span class="p">),</span>
            <span class="s2">&quot;w+&quot;</span><span class="p">,</span>
        <span class="p">)</span> <span class="k">as</span> <span class="n">nansfdirbcfile</span><span class="p">:</span>

            <span class="c1"># self.mesh_bound_cond_df</span>

            <span class="c1"># To simulate the no-flow boundaries conditions for the bottom and</span>
            <span class="c1"># vertical sides of the domain --&gt; NDIR and NDIRC equal to zero</span>
            <span class="c1"># -------------------------------------------------------------</span>
            <span class="k">if</span> <span class="n">no_flow</span><span class="p">:</span>  <span class="c1"># Dirichlet</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">time</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atmbc</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">tt</span> <span class="ow">in</span> <span class="n">time</span><span class="p">:</span>
                    <span class="c1"># nansfdirbcfile.write(str(tt) + &quot;\t&quot; + &quot;time&quot; + &quot;\n&quot;)</span>
                    <span class="n">nansfdirbcfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:.3e}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tt</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;time&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                    <span class="n">nansfdirbcfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">NDIR</span><span class="p">)</span>
                        <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span>
                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">NDIRC</span><span class="p">)</span>
                        <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span>
                        <span class="o">+</span> <span class="s2">&quot;NDIR&quot;</span>
                        <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span>
                        <span class="o">+</span> <span class="s2">&quot;NDIRC&quot;</span>
                        <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Non homogeneous Dirichlet Boundary conditions Not yet implemented&quot;</span>
                <span class="p">)</span>

        <span class="n">nansfdirbcfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c1"># read existing input nansfdirbc file</span>
        <span class="c1"># --------------------------------------------------------------------</span>
        <span class="c1"># with open(os.path.join(self.workdir,</span>
        <span class="c1">#                        self.project_name,</span>
        <span class="c1">#                        self.input_dirname,</span>
        <span class="c1">#                        &quot;nansfdirbc&quot;</span>
        <span class="c1">#                        ),&quot;w+&quot;) as nansfdirbcfile:</span>

        <span class="c1">#     # To simulate the no-flow boundaries conditions for the bottom and</span>
        <span class="c1">#     # vertical sides of the domain --&gt; NDIR and NDIRC equal to zero</span>
        <span class="c1">#     #-------------------------------------------------------------</span>
        <span class="c1">#     if noflow: # Dirichlet</span>
        <span class="c1">#         if len(time) == 0:</span>
        <span class="c1">#             time = self.atmbc[&quot;time&quot;]</span>
        <span class="c1">#         for tt in time:</span>
        <span class="c1">#             # nansfdirbcfile.write(str(tt) + &quot;\t&quot; + &quot;time&quot; + &quot;\n&quot;)</span>
        <span class="c1">#             nansfdirbcfile.write(&quot;{:.3e}&quot;.format(tt) + &quot;\t&quot; + &quot;time&quot; + &quot;\n&quot;)</span>

        <span class="c1">#             nansfdirbcfile.write(str(NDIR) + &quot;\t&quot;+ str(NDIRC) + &quot;\t&quot; + &quot;NDIR&quot; + &quot;\t&quot; + &quot;NDIRC&quot; + &quot;\n&quot;)</span>
        <span class="c1">#     else:</span>
        <span class="c1">#         raise ValueError(&#39;Non homogeneous Dirichlet Boundary conditions Not yet implemented&#39;)</span>

        <span class="c1"># nansfdirbcfile.close()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_parm</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_cathyH</span><span class="p">()</span>

        <span class="c1"># len(bool_Dirichlet)</span>
        <span class="c1"># len(self.mesh_bound_cond_df[&#39;id_node&#39;])</span>

        <span class="c1"># elif bound_xyz is not None:</span>
        <span class="c1">#     for tt in time:</span>
        <span class="c1">#         #Se avessi delle variazioni dovrei indicare il nodo ed il valore di pressione</span>
        <span class="c1">#         nansfdirbcfile.write(str(tt) + &quot;\t&quot; + &#39;time&#39; + &quot;\n&quot;)</span>
        <span class="c1">#         for i in range(self.nnod3):</span>
        <span class="c1">#             if self.xmesh[i] == xb_left or self.xmesh[i] == xb_right or</span>
        <span class="c1">#                 self.ymesh[i] == yb_left or self.ymesh[i] == yb_right:</span>
        <span class="c1">#                     nansfdirbcfile.write(str(i) + &quot;\n&quot;)</span>

        <span class="c1">#         for i in range(self.nnod3):</span>
        <span class="c1">#             if self.xmesh[i] == xb_left or self.xmesh[i] == xb_right or</span>
        <span class="c1">#                 self.ymesh[i] == yb_left or self.ymesh[i] == yb_right:</span>
        <span class="c1">#                     nansfdirbcfile.write(str(self.zmesh[i]-self.ic[&#39;WTPOSITION&#39;]) + &quot;\n&quot;)</span>

        <span class="c1"># NPMAX = len(NDIRC)</span>
        <span class="c1"># NP2MAX = len(NDIR)</span>
        <span class="c1">#     self.update_cathyH(NPMAX, NP2MAX)</span>

        <span class="c1"># exemple provided by Laura B.</span>
        <span class="c1"># ----------------------------</span>

        <span class="c1"># C     Write dirbc</span>
        <span class="c1">#       write(33,*) 0.0, &#39;time&#39;</span>
        <span class="c1">#       write(33,*) &#39;0&#39;, a</span>
        <span class="c1">#       do i=1,nnod3</span>
        <span class="c1">#          if ((x(i).eq.0).or.(x(i).eq.5).or.(y(i).eq.0).or.</span>
        <span class="c1">#      1       (y(i).eq.5))then</span>
        <span class="c1">#          write(33,*) i</span>
        <span class="c1">#          endif</span>
        <span class="c1">#       enddo</span>
        <span class="c1">#       do i=1,nnod3</span>
        <span class="c1">#          if ((x(i).eq.0).or.(x(i).eq.5).or.(y(i).eq.0).or.</span>
        <span class="c1">#      1       (y(i).eq.5))then</span>
        <span class="c1">#          write(33,*) -z(i)-WTdepth</span>
        <span class="c1">#          endif</span>
        <span class="c1">#       enddo</span>

        <span class="c1">#       write(33,*) 2e+20, &#39;time&#39;</span>
        <span class="c1">#       write(33,*) &#39;0&#39;, a</span>
        <span class="c1">#       do i=1,nnod3</span>
        <span class="c1">#          if ((x(i).eq.0).or.(x(i).eq.5).or.(y(i).eq.0).or.</span>
        <span class="c1">#      1       (y(i).eq.5))then</span>
        <span class="c1">#          write(33,*) i</span>
        <span class="c1">#          endif</span>
        <span class="c1">#       enddo</span>
        <span class="c1">#       do i=1,nnod3</span>
        <span class="c1">#          if ((x(i).eq.0).or.(x(i).eq.5).or.(y(i).eq.0).or.</span>
        <span class="c1">#      1       (y(i).eq.5))then</span>
        <span class="c1">#          write(33,*) -z(i)-WTdepth</span>
        <span class="c1">#          endif</span>
        <span class="c1">#       enddo</span>

        <span class="c1"># modicare il valore di NPMAX nel file 27 CATHY.H nel caso</span>
        <span class="c1"># in cui si inseriscano dei NDIRC ed il valore di NP2MAX nel caso si inseriscano dei</span>
        <span class="c1"># NDIR. I valori di NPMAX e NP2MAX corrispondono al numero massimo</span>
        <span class="c1"># di nodi NDIRC e NDIR che si possono inserire.</span>

        <span class="k">pass</span></div>

<div class="viewcode-block" id="CATHY.update_nansfneubc"><a class="viewcode-back" href="../../content/api/generated/DA.cathy_DA.CATHY.html#DA.cathy_DA.CATHY.update_nansfneubc">[docs]</a>    <span class="k">def</span> <span class="nf">update_nansfneubc</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="p">[],</span> <span class="n">NQ</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ZERO</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">fixed_pressure</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">no_flow</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Neumann boundary conditions (or specifed flux) at time t</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        time : np.array([]), optional</span>
<span class="sd">            Absolute simulation time in sec.</span>
<span class="sd">            The default is [].</span>
<span class="sd">        NQ : TYPE, optional</span>
<span class="sd">            number of non-atmospheric, non seepage face Neumann nodes in</span>
<span class="sd">            3-D mesh. The default is 0.</span>
<span class="sd">        ZERO : TYPE, optional</span>
<span class="sd">            DESCRIPTION. The default is 0.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># check that the mesh exist</span>
        <span class="c1"># --------------------------------------------------------------------</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grid3d</span> <span class="o">=</span> <span class="n">in_CT</span><span class="o">.</span><span class="n">read_grid3d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;grid3d missing - need to run the processor with IPRT1=3 first&quot;</span><span class="p">)</span>

        <span class="c1"># check that mesh_bound_cond_df exist</span>
        <span class="c1"># --------------------------------------------------------------------</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;mesh_bound_cond_df&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">init_boundary_conditions</span><span class="p">(</span><span class="s2">&quot;nansfneubc&quot;</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">NQ</span><span class="o">=</span><span class="n">NQ</span><span class="p">,</span> <span class="n">ZERO</span><span class="o">=</span><span class="n">ZERO</span><span class="p">)</span>

        <span class="c1"># apply BC</span>
        <span class="c1"># --------------------------------------------------------------------</span>
        <span class="k">if</span> <span class="n">no_flow</span><span class="p">:</span>  <span class="c1"># Neumanm</span>
            <span class="c1"># self.set_BC_laterals(time=time, BC_type=&#39;Neumanm&#39;, val=0)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;shortcut set_BC_laterals mesh dataframe&quot;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Non homogeneous Neumanm Boundary conditions Not yet implemented&quot;</span>
            <span class="p">)</span>

        <span class="c1"># read existing input nansfneubc file</span>
        <span class="c1"># --------------------------------------------------------------------</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_dirname</span><span class="p">,</span> <span class="s2">&quot;nansfneubc&quot;</span>
            <span class="p">),</span>
            <span class="s2">&quot;w+&quot;</span><span class="p">,</span>
        <span class="p">)</span> <span class="k">as</span> <span class="n">nansfneubcfile</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">time</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atmbc</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">tt</span> <span class="ow">in</span> <span class="n">time</span><span class="p">:</span>
                <span class="n">nansfneubcfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:.3e}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tt</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;time&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">nansfneubcfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">ZERO</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">NQ</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;ZERO&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;NQ&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="p">)</span>
        <span class="n">nansfneubcfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">pass</span></div>

<div class="viewcode-block" id="CATHY.update_sfbc"><a class="viewcode-back" href="../../content/api/generated/DA.cathy_DA.CATHY.html#DA.cathy_DA.CATHY.update_sfbc">[docs]</a>    <span class="k">def</span> <span class="nf">update_sfbc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="p">[],</span> <span class="n">sfbc</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">no_flow</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Seepage face boundary conditions at time t</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        time : np.array([]), optional</span>
<span class="sd">            Absolute simulation time in sec.</span>
<span class="sd">            The default is [].</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># check that the mesh exist</span>
        <span class="c1"># --------------------------------------------------------------------</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grid3d</span> <span class="o">=</span> <span class="n">in_CT</span><span class="o">.</span><span class="n">read_grid3d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;grid3d missing - need to run the processor with IPRT1=3 first&quot;</span><span class="p">)</span>

        <span class="c1"># check that mesh_bound_cond_df exist</span>
        <span class="c1"># --------------------------------------------------------------------</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;mesh_bound_cond_df&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">init_boundary_conditions</span><span class="p">(</span><span class="s2">&quot;sfbc&quot;</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>

        <span class="c1"># apply BC</span>
        <span class="c1"># --------------------------------------------------------------------</span>
        <span class="k">if</span> <span class="n">no_flow</span><span class="p">:</span>
            <span class="c1"># self.set_BC_laterals(time=time, BC_type=&#39;sfbc&#39;, val=0)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;shortcut set_BC_laterals mesh dataframe&quot;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Non homogeneous Neumanm Boundary conditions Not yet implemented&quot;</span>
            <span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_dirname</span><span class="p">,</span> <span class="s2">&quot;sfbc&quot;</span><span class="p">),</span>
            <span class="s2">&quot;w+&quot;</span><span class="p">,</span>
        <span class="p">)</span> <span class="k">as</span> <span class="n">sfbcfile</span><span class="p">:</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">time</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atmbc</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">tt</span> <span class="ow">in</span> <span class="n">time</span><span class="p">:</span>
                <span class="n">sfbcfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:.3e}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tt</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">sfbcfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;0&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">sfbcfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">pass</span></div>

<div class="viewcode-block" id="CATHY.update_soil"><a class="viewcode-back" href="../../content/api/generated/DA.cathy_DA.CATHY.html#DA.cathy_DA.CATHY.update_soil">[docs]</a>    <span class="k">def</span> <span class="nf">update_soil</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">IVGHU</span><span class="o">=</span><span class="p">[],</span>
        <span class="n">FP</span><span class="o">=</span><span class="p">[],</span>
        <span class="n">FP_map</span><span class="o">=</span><span class="p">[],</span>
        <span class="n">SPP</span><span class="o">=</span><span class="p">[],</span>
        <span class="n">SPP_map</span><span class="o">=</span><span class="p">[],</span>
        <span class="n">zone3d</span><span class="o">=</span><span class="p">[],</span>
        <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Soil parameters (soil - IIN4). The porous media properties.</span>

<span class="sd">        ..note::</span>
<span class="sd">            The first thing that must be decides is the type of relationship to describe the hydraulic</span>
<span class="sd">            characteristics of the unsaturated soil (i.e. retention curves). This can be done through</span>
<span class="sd">            the choice of the parameter **IVGHU** amongst the several options.</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        IVGHU : int, optional</span>
<span class="sd">            = -1 table look up for moisture curves</span>
<span class="sd">            = 0 for van Genuchten moisture curves</span>
<span class="sd">            = 1 for extended van Genuchten moisture curves</span>
<span class="sd">            = 2 for moisture curves from Huyakorn et al (WRR 20(8) 1984, WRR 22(13) 1986) with Kr=Se**n conductivity relationship</span>
<span class="sd">            = 3 for moisture curves from Huyakorn et al (WRR 20(8) 1984, WRR 22(13) 1986)with conductivity relationship from Table 3 of 1984 paper (log_10 Kr(Se) curve)</span>
<span class="sd">            = 4 for Brooks‐Corey moisture curves.</span>

<span class="sd">            The default is [].</span>

<span class="sd">        FP : list, optional</span>
<span class="sd">            Feddes Parameters. The default is [].</span>
<span class="sd">            [PCANA PCREF PCWLT ZROOT PZ OMGC]</span>
<span class="sd">            - &#39;PCANA&#39;: float, anaerobiosis point --&gt; h2 (≈ -0.5m)</span>
<span class="sd">            - &#39;PCREF&#39;: float, field capacity --&gt; h3 (≈ 4-m)</span>
<span class="sd">            - &#39;PCWLT&#39;: float, wilting point --&gt; h4 (≈ -150m)</span>
<span class="sd">            - &#39;ZROOT&#39;: float, root depth</span>
<span class="sd">            - &#39;PZ&#39;: float, pz is an empirical parameter</span>
<span class="sd">            - &#39;OMGC&#39;: float, 0&lt;OMGC&lt;1 Compensatory mechanisms for root water uptake</span>

<span class="sd">            .. note:</span>
<span class="sd">                Calculate actual transpiration Ta (m d−1).</span>
<span class="sd">                A multiplicative reduction factor is defined by four pressure heads (0 &gt; h1 &gt; h2 &gt; h3 &gt; h4)</span>
<span class="sd">                delimiting five phases of uptake</span>
<span class="sd">                For details, see http://dx.doi.org/10.1002/2015WR017139</span>
<span class="sd">                BETA = (1-DEPTH/ZROOT(VEG_TYPE(I)))*DEXP(-1.0d0*PZ(VEG_TYPE(I))*DEPTH/ZROOT(VEG_TYPE(I)))</span>
<span class="sd">                BTRANI(K) = MAX(ZERO,BETA*DZ*GX)</span>
<span class="sd">                BTRAN(I)  = BTRAN(I) + BETA*DZ</span>
<span class="sd">                OMG(I)    = OMG(I) + GX*BETA*DZ</span>
<span class="sd">                QTRANIE(K)=ETP(I)*BTRANI(K)/BTRAN(I)/MAX(OMG(I),OMGC(VEG_TYPE(I)))</span>


<span class="sd">        FP : Dict, optional</span>
<span class="sd">            Dictionnary containing the SPP properies per zones (root map, indice of vegetation)</span>



<span class="sd">        SPP : DataFrame, optional</span>
<span class="sd">            Soil Physical Properties. The default is [].</span>
<span class="sd">            - &#39;PERMX&#39; (NSTR, NZONE): saturated hydraulic conductivity - xx</span>
<span class="sd">            - &#39;PERMY&#39; (NSTR, NZONE): saturated hydraulic conductivity - yy</span>
<span class="sd">            - &#39;PERMZ&#39; (NSTR, NZONE): saturated hydraulic conductivity - zz</span>
<span class="sd">            - &#39;ELSTOR&#39; (NSTR, NZONE): specific storage</span>
<span class="sd">            - &#39;POROS&#39;  (NSTR, NZONE): porosity (moisture content at saturation) = \thetaS</span>

<span class="sd">            retention curves parameters VGN, VGRMC, and VGPSAT</span>
<span class="sd">            - &#39;VGNCELL&#39; (NSTR, NZONE): van Genuchten curve exponent  = n</span>
<span class="sd">            - &#39;VGRMCCELL&#39; (NSTR, NZONE): residual moisture content = \thetaR</span>
<span class="sd">            - &#39;VGPSATCELL&#39; (NSTR, NZONE): van Genuchten curve exponent --&gt;</span>
<span class="sd">                                          VGPSAT == -1/alpha (with alpha expressed in [L-1]);</span>

<span class="sd">            Example for 1 zone:</span>

<span class="sd">                             PERMX     PERMY     PERMZ  ...  VGNCELL  VGRMCCELL  VGPSATCELL</span>
<span class="sd">                str zone                                ...</span>
<span class="sd">                0   0     0.000188  0.000188  0.000188  ...     1.46       0.15     0.03125</span>
<span class="sd">                1   0     0.000188  0.000188  0.000188  ...     1.46       0.15     0.03125</span>
<span class="sd">                2   0     0.000188  0.000188  0.000188  ...     1.46       0.15     0.03125</span>
<span class="sd">                3   0     0.000188  0.000188  0.000188  ...     1.46       0.15     0.03125</span>
<span class="sd">                4   0     0.000188  0.000188  0.000188  ...     1.46       0.15     0.03125</span>


<span class="sd">        SPP_map : Dict, optional</span>
<span class="sd">            Dictionnary containing the SPP properies per zones</span>
<span class="sd">            Example for 2 zones:</span>
<span class="sd">                {</span>
<span class="sd">                    &#39;PERMX&#39;: [0.000188, 9.4e-05],</span>
<span class="sd">                    &#39;PERMY&#39;: [0.000188, 0.000188],</span>
<span class="sd">                    &#39;PERMZ&#39;: [0.000188, 0.000188],</span>
<span class="sd">                    &#39;ELSTOR&#39;: [1e-05, 1e-05],</span>
<span class="sd">                    &#39;POROS&#39;: [0.55, 0.55],</span>
<span class="sd">                    &#39;VGNCELL&#39;: [1.46, 1.46],</span>
<span class="sd">                    &#39;VGRMCCELL&#39;: [0.15, 0.15],</span>
<span class="sd">                    &#39;VGPSATCELL&#39;: [0.03125, 0.03125]</span>
<span class="sd">                 }</span>


<span class="sd">        ..note::</span>

<span class="sd">            At the file level, this is an example of 3 layers and  2 zones; The inner reading cycle is by zone, and the outer one by layers, i.e.:</span>

<span class="sd">            PERMX_z1_str1 PERMY_z1_str1  PERMZ_z1_str1  ELSTOR_z1_str1 POROS_z1_str1 VGNCELL_z1_str1 VGRMCCELL__z1_str1 VGPSATCELL__z1_str1</span>
<span class="sd">            PERMX_z2_str1 PERMY_z2_str1  PERMZ_z2_str1  ELSTOR_z2_str1 POROS_z2_str1 VGNCELL_z2_str1 VGRMCCELL__z2_str1 VGPSATCELL__z2_str1</span>
<span class="sd">            PERMX_z1_str2 PERMY_z1_str2  PERMZ_z1_str2  ELSTOR_z1_str2 POROS_z1_str2 VGNCELL_z1_str2 VGRMCCELL__z1_str2 VGPSATCELL__z1_str2</span>
<span class="sd">            PERMX_z2_str2 PERMY_z2_str2  PERMZ_z2_str2  ELSTOR_z2_str2 POROS_z2_str2 VGNCELL_z2_str2 VGRMCCELL__z2_str2 VGPSATCELL__z2_str2</span>
<span class="sd">            PERMX_z1_str3 PERMY_z1_str3  PERMZ_z1_str3  ELSTOR_z1_str3 POROS_z1_str3 VGNCELL_z1_str3 VGRMCCELL__z1_str3 VGPSATCELL__z1_str3</span>
<span class="sd">            PERMX_z2_str3 PERMY_z2_str3  PERMZ_z2_str3  ELSTOR_z2_str3 POROS_z2_str3 VGNCELL_z2_str3 VGRMCCELL__z2_str3  VGPSATCELL__z2_str3</span>

<span class="sd">            Make sure all 8 parameters for each layer/zone are on the same line.</span>
<span class="sd">            Also, make sure NZONE = 2 in dem_parameters and MAXZON in CATHY.H is larger than or equal to NZONE.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        - update parm file</span>
<span class="sd">        - update CATHY.H file</span>
<span class="sd">        - update mesh vtk file</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;shellprint_update&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;shellprint_update&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;:arrows_counterclockwise: [b]Update soil[/b]&quot;</span><span class="p">)</span>

        <span class="c1"># set default parameters if SPP and/or FP args are not existing yet</span>
        <span class="c1"># --------------------------------------------------------------------</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">soil</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_SOIL_defaults</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">SPP_map</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">SPP_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_SOIL_defaults</span><span class="p">(</span><span class="n">SPP_map_default</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;soil_FP&quot;</span><span class="p">))</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">FP_map</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">FP_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_SOIL_defaults</span><span class="p">(</span><span class="n">FP_map_default</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">FP_map</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">FP_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">soil_FP</span><span class="p">[</span><span class="s2">&quot;FP_map&quot;</span><span class="p">]</span>

        <span class="c1"># check size of the heteregeneity</span>
        <span class="c1"># -----------------------------------</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">zone3d</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">soil_heteregeneous_in_z</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">soil_heteregeneous_in_xy</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;homogeneous soil&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xyvar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="p">[</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">zone3d</span><span class="p">[</span><span class="n">l</span><span class="p">]))</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">zone3d</span><span class="p">)[</span><span class="mi">0</span><span class="p">])]</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">xyvar</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">soil_heteregeneous_in_xy</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;xy soil heterogeneity detected&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">zone3d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">zone3d</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
                <span class="n">soil_heteregeneous_in_z</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;z soil heterogeneity detected&quot;</span><span class="p">)</span>

        <span class="c1"># check size of soil properties map versus nb of zones/ nb of layers</span>
        <span class="c1"># --------------------------------------------------------------------</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">SPP_map</span><span class="p">[</span><span class="s2">&quot;PERMX&quot;</span><span class="p">],</span> <span class="nb">float</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dem_parameters</span><span class="p">[</span><span class="s2">&quot;nzone&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Wrong number of zones&quot;</span><span class="p">)</span>
        <span class="c1"># else:</span>
        <span class="c1"># if self.dem_parameters[&quot;nzone&quot;]&gt;1:</span>
        <span class="c1">#     if len(SPP_map[&#39;PERMX&#39;])!=self.dem_parameters[&quot;nzone&quot;]:</span>
        <span class="c1">#         raise ValueError(&quot;Wrong number of zones: PERMX size is &quot; + str(len(SPP[&#39;PERMX&#39;]))</span>
        <span class="c1">#                          + &#39; while nzone is &#39; + str(self.dem_parameters[&quot;nzone&quot;]))</span>
        <span class="c1"># else: # case where soil properties are homogeneous in x and y direction (only z prop varies)</span>
        <span class="c1">#     if soil_heteregeneous_in_z:</span>
        <span class="c1">#         if len(SPP_map[&#39;PERMX&#39;])!=self.dem_parameters[&quot;nstr&quot;]:</span>
        <span class="c1">#             raise ValueError(&quot;Wrong number of zones: PERMX size is &quot; + str(len(SPP[&#39;PERMX&#39;]))</span>
        <span class="c1">#                              + &#39; while nlayers is &#39; + str(self.dem_parameters[&quot;nstr&quot;]))</span>

        <span class="c1"># read function arguments kwargs and udpate soil and parm files</span>
        <span class="c1"># --------------------------------------------------------------------</span>
        <span class="k">for</span> <span class="n">kk</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">soil</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parm</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="c1"># loop over Feddes parameters</span>
        <span class="c1"># --------------------------------------------------------------------</span>
        <span class="k">for</span> <span class="n">fp</span> <span class="ow">in</span> <span class="n">FP_map</span><span class="p">:</span>  <span class="c1"># loop over fedded parameterssoil_het_dim</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">soil</span><span class="p">[</span><span class="n">fp</span><span class="p">]</span> <span class="o">=</span> <span class="n">FP_map</span><span class="p">[</span><span class="n">fp</span><span class="p">]</span>

        <span class="c1"># check consistency between parameters</span>
        <span class="c1"># --------------------------------------------------------------------</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">SPP_map</span><span class="p">[</span><span class="s2">&quot;PERMX&quot;</span><span class="p">],</span> <span class="nb">float</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">SPP_map</span><span class="p">:</span>
                <span class="n">SPP_map</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">SPP_map</span><span class="p">[</span><span class="n">k</span><span class="p">]]</span>

        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">SPP_map</span><span class="p">[</span><span class="s2">&quot;VGRMCCELL&quot;</span><span class="p">])):</span>  <span class="c1"># loop over zones</span>
            <span class="k">if</span> <span class="n">SPP_map</span><span class="p">[</span><span class="s2">&quot;VGRMCCELL&quot;</span><span class="p">][</span><span class="n">z</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">SPP_map</span><span class="p">[</span><span class="s2">&quot;POROS&quot;</span><span class="p">][</span><span class="n">z</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;residual water content is&quot;</span>
                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">SPP_map</span><span class="p">[</span><span class="s2">&quot;VGRMCCELL&quot;</span><span class="p">][</span><span class="n">z</span><span class="p">])</span>
                    <span class="o">+</span> <span class="s2">&quot;&gt; porosity &quot;</span>
                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">SPP_map</span><span class="p">[</span><span class="s2">&quot;POROS&quot;</span><span class="p">][</span><span class="n">z</span><span class="p">])</span>
                <span class="p">)</span>

        <span class="c1"># create prepro inputs if not existing (containing info about the DEM)</span>
        <span class="c1"># --------------------------------------------------------------------</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;dem_parameters&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_prepo_inputs</span><span class="p">()</span>

        <span class="c1"># Soil Physical Properties strat by strat</span>
        <span class="c1"># --------------------------------------------------------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">soil_SPP</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">soil_SPP</span><span class="p">[</span><span class="s2">&quot;SPP_map&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SPP_map</span>  <span class="c1"># mapping with respect to zones</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">SPP</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">soil_SPP</span><span class="p">[</span><span class="s2">&quot;SPP&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SPP</span>  <span class="c1"># matrice with respect to zones</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">SoilPhysProp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_SPP_tb</span><span class="p">(</span><span class="n">SPP_map</span><span class="p">,</span> <span class="n">zone3d</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">soil_SPP</span><span class="p">[</span><span class="s2">&quot;SPP&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SoilPhysProp</span>  <span class="c1"># matrice with respect to zones</span>

        <span class="c1"># Vegetation properties (PCANA,PCREF,PCWLT,ZROOT,PZ,OMGC)</span>
        <span class="c1"># --------------------------------------------------------------------</span>
        <span class="n">FeddesParam</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_SOIL_vegetation_tb</span><span class="p">(</span><span class="n">FP_map</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">soil_FP</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">soil_FP</span><span class="p">[</span><span class="s2">&quot;FP&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FeddesParam</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">soil_FP</span><span class="p">[</span><span class="s2">&quot;FP_map&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FP_map</span>  <span class="c1"># mapping with respect to zones</span>

        <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
            <span class="n">update_map_veg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_prop_veg</span><span class="p">(</span><span class="n">FP_map</span><span class="p">)</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt_CT</span><span class="o">.</span><span class="n">dem_plot_2d_top</span><span class="p">(</span><span class="n">update_map_veg</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;map_veg.png&quot;</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">400</span>
            <span class="p">)</span>

        <span class="c1"># write soil file</span>
        <span class="c1"># --------------------------------------------------------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_SOIL_file</span><span class="p">(</span><span class="n">SoilPhysProp</span><span class="p">,</span> <span class="n">FeddesParam</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># map SPP to the mesh</span>
        <span class="c1"># --------------------------------------------------------------------</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">zone3d</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">mt</span><span class="o">.</span><span class="n">add_markers2mesh</span><span class="p">(</span>
                <span class="n">zone3d</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mesh_pv_attributes</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dem_parameters</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hapin</span><span class="p">,</span>
                <span class="n">to_nodes</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># mt.add_markers2mesh(</span>
            <span class="c1">#                         zone3d,</span>
            <span class="c1">#                         self.mesh_pv_attributes,</span>
            <span class="c1">#                         self.dem_parameters,</span>
            <span class="c1">#                         self.workdir,</span>
            <span class="c1">#                         self.project_name,</span>
            <span class="c1">#                         self.hapin,</span>
            <span class="c1">#                         to_nodes=True</span>
            <span class="c1">#                     )</span>

            <span class="k">for</span> <span class="n">spp</span> <span class="ow">in</span> <span class="n">SPP_map</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">map_dem_prop_2mesh</span><span class="p">(</span><span class="n">spp</span><span class="p">,</span> <span class="n">SPP_map</span><span class="p">[</span><span class="n">spp</span><span class="p">],</span> <span class="n">to_nodes</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">pass</span></div>

<div class="viewcode-block" id="CATHY.set_SOIL_defaults"><a class="viewcode-back" href="../../content/api/generated/DA.cathy_DA.CATHY.html#DA.cathy_DA.CATHY.set_SOIL_defaults">[docs]</a>    <span class="k">def</span> <span class="nf">set_SOIL_defaults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">FP_map_default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">SPP_map_default</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">soil</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;PMIN&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mf">5.0</span><span class="p">,</span>
            <span class="s2">&quot;IPEAT&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;SCF&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>  <span class="c1"># here we assume that all soil is covered by the vegetation</span>
            <span class="s2">&quot;CBETA0&quot;</span><span class="p">:</span> <span class="mf">0.4</span><span class="p">,</span>
            <span class="s2">&quot;CANG&quot;</span><span class="p">:</span> <span class="mf">0.225</span><span class="p">,</span>
            <span class="c1"># Feddes parameters default values</span>
            <span class="s2">&quot;PCANA&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">],</span>
            <span class="s2">&quot;PCREF&quot;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">4.0</span><span class="p">],</span>
            <span class="s2">&quot;PCWLT&quot;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mi">150</span><span class="p">],</span>
            <span class="s2">&quot;ZROOT&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">],</span>
            <span class="s2">&quot;PZ&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">],</span>
            <span class="s2">&quot;OMGC&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">],</span>
            <span class="s2">&quot;IVGHU&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>  <span class="c1"># The first thing that must be decided!</span>
            <span class="s2">&quot;HUALFA&quot;</span><span class="p">:</span> <span class="mf">0.02</span><span class="p">,</span>
            <span class="s2">&quot;HUBETA&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
            <span class="s2">&quot;HUGAMA&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
            <span class="s2">&quot;HUPSIA&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;HUSWR&quot;</span><span class="p">:</span> <span class="mf">0.333</span><span class="p">,</span>
            <span class="s2">&quot;HUN&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s2">&quot;HUA&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span>
            <span class="s2">&quot;HUB&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s2">&quot;BCBETA&quot;</span><span class="p">:</span> <span class="mf">1.2</span><span class="p">,</span>
            <span class="s2">&quot;BCRMC&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;BCPSAT&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.345</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">FP_map_default</span><span class="p">:</span>

            <span class="n">FP_map</span> <span class="o">=</span> <span class="p">{</span>
                <span class="c1"># Feddes parameters default values</span>
                <span class="s2">&quot;PCANA&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">],</span>
                <span class="s2">&quot;PCREF&quot;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">4.0</span><span class="p">],</span>
                <span class="s2">&quot;PCWLT&quot;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mi">150</span><span class="p">],</span>
                <span class="s2">&quot;ZROOT&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">],</span>
                <span class="s2">&quot;PZ&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">],</span>
                <span class="s2">&quot;OMGC&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">],</span>
            <span class="p">}</span>

            <span class="c1"># self.soil.update(FP)</span>

            <span class="k">return</span> <span class="n">FP_map</span>

        <span class="c1"># # set Soil Physical Properties defaults parameters</span>
        <span class="c1"># # --------------------------------------------------------------------</span>

        <span class="k">if</span> <span class="n">SPP_map_default</span><span class="p">:</span>

            <span class="n">PERMX</span> <span class="o">=</span> <span class="n">PERMY</span> <span class="o">=</span> <span class="n">PERMZ</span> <span class="o">=</span> <span class="mf">1.88e-04</span>
            <span class="n">ELSTOR</span> <span class="o">=</span> <span class="mf">1.00e-05</span>
            <span class="n">POROS</span> <span class="o">=</span> <span class="mf">0.55</span>
            <span class="n">VGNCELL</span> <span class="o">=</span> <span class="mf">1.46</span>
            <span class="n">VGRMCCELL</span> <span class="o">=</span> <span class="mf">0.15</span>
            <span class="n">VGPSATCELL</span> <span class="o">=</span> <span class="mf">0.03125</span>

            <span class="n">SPP_map</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;PERMX&quot;</span><span class="p">:</span> <span class="n">PERMX</span><span class="p">,</span>
                <span class="s2">&quot;PERMY&quot;</span><span class="p">:</span> <span class="n">PERMY</span><span class="p">,</span>
                <span class="s2">&quot;PERMZ&quot;</span><span class="p">:</span> <span class="n">PERMZ</span><span class="p">,</span>
                <span class="s2">&quot;ELSTOR&quot;</span><span class="p">:</span> <span class="n">ELSTOR</span><span class="p">,</span>
                <span class="s2">&quot;POROS&quot;</span><span class="p">:</span> <span class="n">POROS</span><span class="p">,</span>
                <span class="s2">&quot;VGNCELL&quot;</span><span class="p">:</span> <span class="n">VGNCELL</span><span class="p">,</span>
                <span class="s2">&quot;VGRMCCELL&quot;</span><span class="p">:</span> <span class="n">VGRMCCELL</span><span class="p">,</span>
                <span class="s2">&quot;VGPSATCELL&quot;</span><span class="p">:</span> <span class="n">VGPSATCELL</span><span class="p">,</span>
            <span class="p">}</span>

            <span class="k">return</span> <span class="n">SPP_map</span>

        <span class="k">pass</span></div>

    <span class="k">def</span> <span class="nf">_prepare_SPP_tb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">SPP</span><span class="p">,</span> <span class="n">zone3d</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        prepare SOIL Physical Properties table</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        SPP : TYPE</span>
<span class="sd">            DESCRIPTION.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        np.array describing the SoilPhysProp with rows corresponding to the layer.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># SPP = {&#39;PERMX&#39;: [[2e-07], [1e-07], [5e-08]], &#39;PERMY&#39;: [[2e-07], [1e-07], [5e-08]], &#39;PERMZ&#39;: [[2e-07], [1e-07], [5e-08]], &#39;ELSTOR&#39;: [1e-05], &#39;POROS&#39;: [0.55], &#39;VGNCELL&#39;: [1.914], &#39;VGRMCCELL&#39;: [0.1296], &#39;VGPSATCELL&#39;: [1.24]}</span>

        <span class="c1"># check number of zones</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dem_parameters</span><span class="p">[</span><span class="s2">&quot;nzone&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">zone3d</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">SPP</span><span class="p">[</span><span class="s2">&quot;PERMX&quot;</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">spp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">SPP</span><span class="p">):</span>
                    <span class="n">SPP</span><span class="p">[</span><span class="n">spp</span><span class="p">]</span> <span class="o">=</span> <span class="n">SPP</span><span class="p">[</span><span class="n">spp</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dem_parameters</span><span class="p">[</span><span class="s2">&quot;nzone&quot;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>

            <span class="c1"># check size of the heteregeneity of SPP</span>
            <span class="c1"># ----------------------------------------</span>
            <span class="c1"># 1d --&gt; uniform</span>
            <span class="c1"># 2d --&gt; lateral variations due to zones defined in surface</span>
            <span class="c1"># 3d --&gt; lateral + vertical variations due to zones and strates</span>

            <span class="n">SoilPhysProp</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">zone3d</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># loop over strates</span>
                <span class="c1"># -----------------------------------------------------------------</span>
                <span class="k">for</span> <span class="n">istr</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dem_parameters</span><span class="p">[</span><span class="s2">&quot;nstr&quot;</span><span class="p">]):</span>
                    <span class="c1">#  loop over zones (defined in the zone file)</span>
                    <span class="c1"># --------------------------------------------------------------</span>
                    <span class="n">LayeriZonei</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">dem_parameters</span><span class="p">[</span><span class="s2">&quot;nzone&quot;</span><span class="p">],</span> <span class="mi">8</span><span class="p">])</span>
                    <span class="k">for</span> <span class="n">izone</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dem_parameters</span><span class="p">[</span><span class="s2">&quot;nzone&quot;</span><span class="p">]):</span>
                        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">spp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">SPP</span><span class="p">):</span>
                            <span class="n">LayeriZonei</span><span class="p">[</span><span class="n">izone</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">SPP</span><span class="p">[</span><span class="n">spp</span><span class="p">][</span><span class="n">izone</span><span class="p">]</span>
                    <span class="n">SoilPhysProp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">LayeriZonei</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">zones3d_def</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hapin</span><span class="p">[</span><span class="s2">&quot;M&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">hapin</span><span class="p">[</span><span class="s2">&quot;N&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">zones3d_def</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
                    <span class="n">zones3d_def</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">hapin</span><span class="p">[</span><span class="s2">&quot;M&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">hapin</span><span class="p">[</span><span class="s2">&quot;N&quot;</span><span class="p">]]</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update_zone</span><span class="p">(</span><span class="n">zones3d_def</span><span class="p">)</span>
                <span class="c1"># loop over strates</span>
                <span class="c1"># -----------------------------------------------------------------</span>
                <span class="k">for</span> <span class="n">istr</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dem_parameters</span><span class="p">[</span><span class="s2">&quot;nstr&quot;</span><span class="p">]):</span>
                    <span class="c1">#  loop over zones (defined in the zone file)</span>
                    <span class="c1"># --------------------------------------------------------------</span>
                    <span class="n">LayeriZonei</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">dem_parameters</span><span class="p">[</span><span class="s2">&quot;nzone&quot;</span><span class="p">],</span> <span class="mi">8</span><span class="p">])</span>

                    <span class="k">for</span> <span class="n">izone</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hapin</span><span class="p">[</span><span class="s2">&quot;N&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">hapin</span><span class="p">[</span><span class="s2">&quot;M&quot;</span><span class="p">]):</span>

                        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">spp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">SPP</span><span class="p">):</span>
                            <span class="n">flag_zone</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">zone3d</span><span class="p">[</span><span class="n">istr</span><span class="p">])[</span><span class="n">izone</span><span class="p">])</span>
                            <span class="n">LayeriZonei</span><span class="p">[</span><span class="n">izone</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">SPP</span><span class="p">[</span><span class="n">spp</span><span class="p">][</span><span class="n">flag_zone</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="n">SoilPhysProp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">LayeriZonei</span><span class="p">)</span>
            <span class="n">SoilPhysProp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">SoilPhysProp</span><span class="p">)</span>
            <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">SoilPhysProp</span><span class="p">)</span>

        <span class="c1"># case if there is only one zone in the mesh</span>
        <span class="c1"># -------------------------------------------------------------</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">SPP</span><span class="p">[</span><span class="s2">&quot;PERMX&quot;</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">izoneSoil</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">spp</span> <span class="ow">in</span> <span class="n">SPP</span><span class="p">:</span>
                    <span class="n">izoneSoil</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SPP</span><span class="p">[</span><span class="n">spp</span><span class="p">])</span>
                <span class="n">izoneSoil</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">izoneSoil</span><span class="p">)</span>
                <span class="n">SoilPhysProp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">izoneSoil</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dem_parameters</span><span class="p">[</span><span class="s2">&quot;nstr&quot;</span><span class="p">],</span> <span class="mi">1</span><span class="p">))</span>

            <span class="c1"># case where it is heterogeneous in depth (z)</span>
            <span class="c1"># ------------------------------------------------------</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">izoneSoil_per_layer</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">stri</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dem_parameters</span><span class="p">[</span><span class="s2">&quot;nstr&quot;</span><span class="p">]):</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">stri</span><span class="p">)</span>
                    <span class="n">izoneSoil</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">spp</span> <span class="ow">in</span> <span class="n">SPP</span><span class="p">:</span>
                        <span class="n">izoneSoil</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SPP</span><span class="p">[</span><span class="n">spp</span><span class="p">][</span><span class="n">stri</span><span class="p">])</span>
                    <span class="n">izoneSoil_per_layer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">izoneSoil</span><span class="p">))</span>
                <span class="n">SoilPhysProp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">izoneSoil_per_layer</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">SoilPhysProp</span>

    <span class="k">def</span> <span class="nf">_prepare_SOIL_vegetation_tb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">FP_map</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        _prepare_SOIL_vegetation_tb</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        FP_map : dict</span>
<span class="sd">            dict containing Feddes parameters.</span>
<span class="sd">            - &#39;PCANA&#39;: anaerobiosis point</span>
<span class="sd">            - &#39;PCREF&#39;: field capacity</span>
<span class="sd">            - &#39;PCWLT&#39;: wilting point</span>
<span class="sd">            - &#39;ZROOT&#39;: float root depth</span>
<span class="sd">            - &#39;PZ&#39;: ??</span>
<span class="sd">            - &#39;OMGC&#39;: float ??</span>
<span class="sd">            For details, see http://dx.doi.org/10.1002/2015WR017139</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        FeddesParam: numpy array</span>
<span class="sd">            table or array describing Feddes parameters for a given DEM</span>




<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Vegetation properties (PCANA,PCREF,PCWLT,ZROOT,PZ,OMGC)</span>
        <span class="c1"># --------------------------------------------------------------------</span>

        <span class="c1"># Check if root_map file exist and is updated</span>
        <span class="c1"># -------------------------------------------</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;veg_map&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">FP_map</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">FP_map</span><span class="p">)[</span><span class="mi">0</span><span class="p">]])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update_veg_map</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Found multiple values of Feddes zones&quot;</span>
                    <span class="o">+</span> <span class="s2">&quot;but vegetation map is not defined&quot;</span>
                <span class="p">)</span>

        <span class="c1"># Check vegetation heterogeneity dimension</span>
        <span class="c1"># ----------------------------------------</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cathyH</span><span class="p">[</span><span class="s2">&quot;MAXVEG&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">FP_map</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">FP_map</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Wrong number of vegetations: PCANA size is &quot;</span>
                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">FP_map</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">FP_map</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]))</span>
                <span class="o">+</span> <span class="s2">&quot; while MAXVEG is &quot;</span>
                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cathyH</span><span class="p">[</span><span class="s2">&quot;MAXVEG&quot;</span><span class="p">])</span>
            <span class="p">)</span>

        <span class="c1"># check number of vegetation</span>
        <span class="c1"># --------------------------------------------------------------------</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cathyH</span><span class="p">[</span><span class="s2">&quot;MAXVEG&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">FeddesParam</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">cathyH</span><span class="p">[</span><span class="s2">&quot;MAXVEG&quot;</span><span class="p">],</span> <span class="mi">6</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">iveg</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cathyH</span><span class="p">[</span><span class="s2">&quot;MAXVEG&quot;</span><span class="p">]</span>
            <span class="p">):</span>  <span class="c1"># loop over veg zones within a strate</span>
                <span class="n">izoneVeg_tmp</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">sfp</span> <span class="ow">in</span> <span class="n">FP_map</span><span class="p">:</span>
                    <span class="n">izoneVeg_tmp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">FP_map</span><span class="p">[</span><span class="n">sfp</span><span class="p">][</span><span class="n">iveg</span><span class="p">])</span>

                <span class="n">izoneVeg_tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">izoneVeg_tmp</span><span class="p">)</span>
                <span class="n">FeddesParam</span><span class="p">[</span><span class="n">iveg</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">izoneVeg_tmp</span>

        <span class="c1"># case where unique vegetation type</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">FeddesParam</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">soil</span><span class="p">[</span><span class="s2">&quot;PCANA&quot;</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">soil</span><span class="p">[</span><span class="s2">&quot;PCREF&quot;</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">soil</span><span class="p">[</span><span class="s2">&quot;PCWLT&quot;</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">soil</span><span class="p">[</span><span class="s2">&quot;ZROOT&quot;</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">soil</span><span class="p">[</span><span class="s2">&quot;PZ&quot;</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">soil</span><span class="p">[</span><span class="s2">&quot;OMGC&quot;</span><span class="p">],</span>
            <span class="p">]</span>

        <span class="k">return</span> <span class="n">FeddesParam</span>

    <span class="k">def</span> <span class="nf">_write_SOIL_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">SoilPhysProp</span><span class="p">,</span> <span class="n">FeddesParam</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        _write_SOIL_file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        SoilPhysProp : TYPE</span>
<span class="sd">            DESCRIPTION.</span>
<span class="sd">        FeddesParam : TYPE</span>
<span class="sd">            DESCRIPTION.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># backup file during DA scheme cycle</span>
        <span class="c1"># --------------------------------------------------------------------</span>
        <span class="n">backup</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="s2">&quot;backup&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">backup</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;backup&quot;</span><span class="p">]</span>

        <span class="c1"># number of side header for each row</span>
        <span class="n">header_fmt_soil</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>

        <span class="c1"># open soil file</span>
        <span class="c1"># --------------------------------------------------------------------</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">DAFLAG</span><span class="p">:</span>
            <span class="n">soil_filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_dirname</span><span class="p">,</span> <span class="s2">&quot;soil&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">soil_filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_dirname</span><span class="p">,</span> <span class="s2">&quot;soil&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;path&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">soil_filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">],</span> <span class="s2">&quot;soil&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">backup</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">count_DA_cycle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">dst_dir</span> <span class="o">=</span> <span class="n">soil_filepath</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">count_DA_cycle</span><span class="p">)</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">soil_filepath</span><span class="p">,</span> <span class="n">dst_dir</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">soil_filepath</span><span class="p">),</span> <span class="s2">&quot;w+&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">soilfile</span><span class="p">:</span>

            <span class="n">counth</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># count header index</span>

            <span class="c1"># Write line by line according to header format</span>
            <span class="c1"># ----------------------------------------------------------------</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">h</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">header_fmt_soil</span><span class="p">):</span>

                <span class="c1"># left = values</span>
                <span class="c1"># ------------------------------------------------------------</span>
                <span class="n">left</span> <span class="o">=</span> <span class="n">right</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">left</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">soil</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="n">counth</span> <span class="p">:</span> <span class="n">counth</span> <span class="o">+</span> <span class="n">h</span><span class="p">])</span>
                <span class="n">left</span> <span class="o">=</span> <span class="n">left</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;[]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

                <span class="c1"># right = keys</span>
                <span class="c1"># ------------------------------------------------------------</span>
                <span class="n">right</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">soil</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="n">counth</span> <span class="p">:</span> <span class="n">counth</span> <span class="o">+</span> <span class="n">h</span><span class="p">])</span>
                <span class="n">right</span> <span class="o">=</span> <span class="n">right</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;[]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="n">right</span> <span class="o">=</span> <span class="n">right</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

                <span class="c1"># Line 4: write Feddes Parameters Table</span>
                <span class="c1"># ------------------------------------------------------------</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>  <span class="c1"># Feddes parameters</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">soilfile</span><span class="p">,</span> <span class="n">FeddesParam</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%1.3e</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">counth</span> <span class="o">+=</span> <span class="n">h</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="n">left</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">right</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="n">counth</span> <span class="o">+=</span> <span class="n">h</span>
                    <span class="n">soilfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">line</span><span class="p">))</span>

            <span class="c1"># End of soil file: write Soil Properties Table</span>
            <span class="c1"># ------------------------------------------------------------</span>
            <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">soilfile</span><span class="p">,</span> <span class="n">SoilPhysProp</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%1.3e</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">soilfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="s2">&quot;PERMX PERMY  PERMZ  ELSTOR POROS,VGNCELL,VGRMCCELL,VGPSATCELL&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="n">soilfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<div class="viewcode-block" id="CATHY.update_veg_map"><a class="viewcode-back" href="../../content/api/generated/DA.cathy_DA.CATHY.html#DA.cathy_DA.CATHY.update_veg_map">[docs]</a>    <span class="k">def</span> <span class="nf">update_veg_map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indice_veg</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Contains the raster map describing which type of vegetation every cell belongs to.</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        indice_veg : TYPE, optional</span>
<span class="sd">            DESCRIPTION. The default is 1.</span>
<span class="sd">        show : TYPE, optional</span>
<span class="sd">            DESCRIPTION. The default is False.</span>
<span class="sd">        **kwargs : TYPE</span>
<span class="sd">            DESCRIPTION.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        indice_veg : TYPE</span>
<span class="sd">            DESCRIPTION.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">indice_veg</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">indice_veg</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">indice_veg</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;hapin&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_prepo_inputs</span><span class="p">()</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_dirname</span><span class="p">,</span> <span class="s2">&quot;root_map&quot;</span>
            <span class="p">),</span>
            <span class="s2">&quot;w+&quot;</span><span class="p">,</span>
        <span class="p">)</span> <span class="k">as</span> <span class="n">rootmapfile</span><span class="p">:</span>
            <span class="n">rootmapfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;north:     0&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">rootmapfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;south:     &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hapin</span><span class="p">[</span><span class="s2">&quot;yllcorner&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">rootmapfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;east:     0&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">rootmapfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;west:     &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hapin</span><span class="p">[</span><span class="s2">&quot;xllcorner&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">rootmapfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;rows:     &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hapin</span><span class="p">[</span><span class="s2">&quot;M&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">rootmapfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;cols:     &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hapin</span><span class="p">[</span><span class="s2">&quot;N&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">indice_veg</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
                <span class="n">indice_veg</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hapin</span><span class="p">[</span><span class="s2">&quot;M&quot;</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hapin</span><span class="p">[</span><span class="s2">&quot;N&quot;</span><span class="p">])])]</span>
                    <span class="o">*</span> <span class="n">indice_veg</span>
                <span class="p">)</span>
                <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">rootmapfile</span><span class="p">,</span> <span class="n">indice_veg</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%1.2e</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">rootmapfile</span><span class="p">,</span> <span class="n">indice_veg</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%1.2e</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">rootmapfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_cathyH</span><span class="p">(</span><span class="n">MAXVEG</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">indice_veg</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">veg_map</span> <span class="o">=</span> <span class="n">indice_veg</span>

        <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
            <span class="n">plt</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt_CT</span><span class="o">.</span><span class="n">show_indice_veg</span><span class="p">(</span><span class="n">indice_veg</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">indice_veg</span><span class="p">,</span> <span class="n">plt</span><span class="p">,</span> <span class="n">ax</span>
        <span class="k">return</span> <span class="n">indice_veg</span></div>

    <span class="c1">#%% Add inputs and outputs attributes to the mesh</span>

<div class="viewcode-block" id="CATHY.init_boundary_conditions"><a class="viewcode-back" href="../../content/api/generated/DA.cathy_DA.CATHY.html#DA.cathy_DA.CATHY.init_boundary_conditions">[docs]</a>    <span class="k">def</span> <span class="nf">init_boundary_conditions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">BCtypName</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        .. note:</span>
<span class="sd">            The boundary conditions are defined in the nansfdirbc (Dirichlet),</span>
<span class="sd">            nansfneubc (Neumann), and sfbc (seepage face) files.</span>

<span class="sd">            We have two types of boundary conditions (BC):</span>
<span class="sd">            - Neumann BC (or specifed flux)</span>
<span class="sd">            - Dirichlet BC (or pressure).</span>


<span class="sd">        .. note:</span>
<span class="sd">            - Pioggia: condizioni di Neumann. Quando non ci può più essere</span>
<span class="sd">            infiltrazione metto Dirichlet.</span>
<span class="sd">            - Evaporazione: si indica un limite di pressione minimo ( Pmin ) al di</span>
<span class="sd">            sotto del quale si ha uno switch da Neumann a Dirichlet</span>
<span class="sd">            (in quanto al di sotto di questo valore non si ha più evapotraspirazione).</span>

<span class="sd">        .. note:</span>
<span class="sd">            The boundary condition for any given surface node can switch between a</span>
<span class="sd">            Dirichlet condition and a Neumann condition depending on the saturation</span>
<span class="sd">            (or pressure) state of that node.</span>

<span class="sd">        .. note:</span>
<span class="sd">            A Neumann (or specified flux) boundary condition corresponds to</span>
<span class="sd">            atmosphere-controlled infiltration or exfiltration, with the flux equal</span>
<span class="sd">            to the rainfall or potential evaporation rate given by the atmospheric input data.</span>
<span class="sd">            When the surface node reaches a threshold level of saturation or moisture deficit,</span>
<span class="sd">            the boundary condition is switched to a Dirichlet (specified head) condition,</span>
<span class="sd">            and the infiltration or exfiltration process becomes soil limited [1].</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># self.update_nansfdirbc()</span>
        <span class="c1"># self.update_nansfneubc()</span>
        <span class="c1"># self.update_sfbc()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span>
                <span class="s2">&quot;:orange_square: [b] init boundary condition dataframe [/b]&quot;</span>
            <span class="p">)</span>

            <span class="c1"># self.create_mesh_vtk()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="s2">&quot;nnod3&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid3d</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">run_processor</span><span class="p">(</span><span class="n">IPRT1</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;mesh_bound_cond_df&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">create_mesh_bounds_df</span><span class="p">(</span>
                    <span class="n">BCtypName</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid3d</span><span class="p">[</span><span class="s2">&quot;nodes_idxyz&quot;</span><span class="p">],</span> <span class="n">time</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
                <span class="p">)</span>
            <span class="n">plt_CT</span><span class="o">.</span><span class="n">plot_mesh_bounds</span><span class="p">(</span><span class="n">BCtypName</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_bound_cond_df</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;cannot init boundary conditions dataframe&quot;</span><span class="p">)</span>
            <span class="k">pass</span>

        <span class="k">pass</span></div>

<div class="viewcode-block" id="CATHY.check_for_inconsistent_BC"><a class="viewcode-back" href="../../content/api/generated/DA.cathy_DA.CATHY.html#DA.cathy_DA.CATHY.check_for_inconsistent_BC">[docs]</a>    <span class="k">def</span> <span class="nf">check_for_inconsistent_BC</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="CATHY.set_BC_laterals"><a class="viewcode-back" href="../../content/api/generated/DA.cathy_DA.CATHY.html#DA.cathy_DA.CATHY.set_BC_laterals">[docs]</a>    <span class="k">def</span> <span class="nf">set_BC_laterals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">BC_type</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set all sides expect surface one</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">nnodes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mesh_bound_cond_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh_bound_cond_df</span><span class="p">[</span><span class="s2">&quot;time (s)&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">][</span><span class="s2">&quot;id_node&quot;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">tt</span> <span class="ow">in</span> <span class="n">time</span><span class="p">:</span>
            <span class="n">BC_bool_name</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">BC_bool_val</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">id_node</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nnodes</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_bound_cond_df</span><span class="p">[</span><span class="s2">&quot;bound&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">id_node</span><span class="p">)]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">BC_bool_name</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">BC_type</span><span class="p">)</span>
                    <span class="n">BC_bool_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">BC_bool_name</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                    <span class="n">BC_bool_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">update_mesh_boundary_cond</span><span class="p">(</span>
                <span class="n">time</span><span class="o">=</span><span class="n">tt</span><span class="p">,</span> <span class="n">BC_bool_name</span><span class="o">=</span><span class="n">BC_bool_name</span><span class="p">,</span> <span class="n">BC_bool_val</span><span class="o">=</span><span class="n">BC_bool_val</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">check_for_inconsistent_BC</span><span class="p">()</span>

        <span class="c1"># self.update_mesh_vtk(BC_bool_name,BC_bool_val)</span>

        <span class="k">pass</span></div>

<div class="viewcode-block" id="CATHY.create_mesh_bounds_df"><a class="viewcode-back" href="../../content/api/generated/DA.cathy_DA.CATHY.html#DA.cathy_DA.CATHY.create_mesh_bounds_df">[docs]</a>    <span class="k">def</span> <span class="nf">create_mesh_bounds_df</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">BCtypName</span><span class="p">,</span> <span class="n">grid3d</span><span class="p">,</span> <span class="n">times</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a dataframe with flag for different boundary condtions assigned to each nodes</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        grid3d : TYPE</span>
<span class="sd">            DESCRIPTION.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Step 1 find mesh bottom and sides</span>
        <span class="c1"># ----------------------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mesh_bound_cond_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">grid3d</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mesh_bound_cond_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_bound_cond_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
            <span class="n">columns</span><span class="o">=</span><span class="p">{</span>
                <span class="mi">0</span><span class="p">:</span> <span class="s2">&quot;id_node&quot;</span><span class="p">,</span>
                <span class="mi">1</span><span class="p">:</span> <span class="s2">&quot;x&quot;</span><span class="p">,</span>
                <span class="mi">2</span><span class="p">:</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span>
                <span class="mi">3</span><span class="p">:</span> <span class="s2">&quot;z&quot;</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mesh_bound_cond_df</span><span class="p">[</span><span class="s2">&quot;id_node&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_bound_cond_df</span><span class="p">[</span><span class="s2">&quot;id_node&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span>
            <span class="nb">int</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mesh_bound_cond_df</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">max_axis_bound_ids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">min_axis_bound_ids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">axi</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">]:</span>
            <span class="n">min_ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_bound_cond_df</span><span class="p">[</span><span class="n">axi</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
            <span class="n">max_ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_bound_cond_df</span><span class="p">[</span><span class="n">axi</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
            <span class="n">cond_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_bound_cond_df</span><span class="p">[</span><span class="n">axi</span><span class="p">]</span> <span class="o">==</span> <span class="n">min_ax</span>
            <span class="n">min_axis_bound_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mesh_bound_cond_df</span><span class="p">[</span><span class="s2">&quot;id_node&quot;</span><span class="p">][</span><span class="n">cond_min</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="n">cond_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_bound_cond_df</span><span class="p">[</span><span class="n">axi</span><span class="p">]</span> <span class="o">==</span> <span class="n">max_ax</span>
            <span class="n">max_axis_bound_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mesh_bound_cond_df</span><span class="p">[</span><span class="s2">&quot;id_node&quot;</span><span class="p">][</span><span class="n">cond_max</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
            <span class="p">)</span>

        <span class="n">bounds_id</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">min_axis_bound_ids</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">max_axis_bound_ids</span><span class="p">)]</span>
            <span class="p">)</span>
            <span class="o">-</span> <span class="mi">1</span>
        <span class="p">)</span>

        <span class="n">bound_bool</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">idb</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_bound_cond_df</span><span class="p">[</span><span class="s2">&quot;id_node&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">idb</span> <span class="ow">in</span> <span class="n">bounds_id</span><span class="p">:</span>
                <span class="n">bound_bool</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">bound_bool</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mesh_bound_cond_df</span><span class="p">[</span><span class="s2">&quot;bound&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bound_bool</span>

        <span class="nb">max</span><span class="p">(</span><span class="n">bounds_id</span><span class="p">)</span>
        <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh_bound_cond_df</span><span class="p">)</span>

        <span class="c1"># step 2 add flag for each type of BC</span>
        <span class="c1"># ---------------------------------------</span>
        <span class="c1"># specified pressure</span>
        <span class="k">if</span> <span class="s2">&quot;nansfdirbc&quot;</span> <span class="ow">in</span> <span class="n">BCtypName</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;no_flow&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mesh_bound_cond_df</span><span class="p">[</span><span class="n">BCtypName</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">99</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_bound_cond_df</span><span class="p">[</span><span class="s2">&quot;bound&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mesh_bound_cond_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="n">BCtypName</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># specified flux</span>
        <span class="k">if</span> <span class="s2">&quot;nansfneubc&quot;</span> <span class="ow">in</span> <span class="n">BCtypName</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;no_flow&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mesh_bound_cond_df</span><span class="p">[</span><span class="n">BCtypName</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">99</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_bound_cond_df</span><span class="p">[</span><span class="s2">&quot;bound&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mesh_bound_cond_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="n">BCtypName</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># specified seepage</span>
        <span class="k">if</span> <span class="s2">&quot;sfbc&quot;</span> <span class="ow">in</span> <span class="n">BCtypName</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;no_flow&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mesh_bound_cond_df</span><span class="p">[</span><span class="n">BCtypName</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">99</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_bound_cond_df</span><span class="p">[</span><span class="s2">&quot;bound&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mesh_bound_cond_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="n">BCtypName</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;SKip time dependence init boundary condition dataframe - consequences (?)&quot;</span>
        <span class="p">)</span>

        <span class="k">pass</span></div>

<div class="viewcode-block" id="CATHY.update_mesh_boundary_cond"><a class="viewcode-back" href="../../content/api/generated/DA.cathy_DA.CATHY.html#DA.cathy_DA.CATHY.update_mesh_boundary_cond">[docs]</a>    <span class="k">def</span> <span class="nf">update_mesh_boundary_cond</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">time</span><span class="p">,</span>
        <span class="n">BC_bool_name</span><span class="o">=</span><span class="p">[],</span>
        <span class="n">BC_bool_val</span><span class="o">=</span><span class="p">[],</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        update_mesh_bounds</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        bound_type : str</span>
<span class="sd">            Neumann or Dirichlet.</span>
<span class="sd">        bound_bool : TYPE</span>
<span class="sd">            Boolean for bound cond.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;:sponge: [b]update boundary condition dataframe[/b]&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mesh_bound_cond_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mesh_bound_cond_df</span><span class="p">[</span><span class="s2">&quot;time (s)&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">time</span><span class="p">,</span> <span class="s2">&quot;BC_type&quot;</span>
        <span class="p">]</span> <span class="o">=</span> <span class="n">BC_bool_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mesh_bound_cond_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mesh_bound_cond_df</span><span class="p">[</span><span class="s2">&quot;time (s)&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">time</span><span class="p">,</span> <span class="s2">&quot;BC_type_val&quot;</span>
        <span class="p">]</span> <span class="o">=</span> <span class="n">BC_bool_val</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="CATHY.create_mesh_vtkris3d_vtk9"><a class="viewcode-back" href="../../content/api/generated/DA.cathy_DA.CATHY.html#DA.cathy_DA.CATHY.create_mesh_vtkris3d_vtk9">[docs]</a>    <span class="k">def</span> <span class="nf">create_mesh_vtkris3d_vtk9</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create mesh for vtk format version 9</span>


<span class="sd">        # vtk DataFile Version 9.0</span>
<span class="sd">        3D Unstructured Grid of Linear Triangles</span>
<span class="sd">        ASCII</span>
<span class="sd">        DATASET STRUCTURED_GRID</span>
<span class="sd">        FIELD FieldData  1</span>
<span class="sd">        TIME 1 1 double</span>
<span class="sd">                   0.00000</span>
<span class="sd">        POINTS     7056 float</span>
<span class="sd">        TETRA (5,NT)       - element connectivities in 3-d mesh (TETRA(5,I)</span>
<span class="sd">        # C                        indicates material type for 3-d element I)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="s2">&quot;nnod3&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid3d</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">run_processor</span><span class="p">(</span><span class="n">IPRT1</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;vtk/mesh_tmp.vtk&quot;</span><span class="p">),</span> <span class="s2">&quot;w+&quot;</span>
        <span class="p">)</span> <span class="k">as</span> <span class="n">vtkmesh</span><span class="p">:</span>
            <span class="n">vtkmesh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;# vtk DataFile Version 2.0</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">vtkmesh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;3D Unstructured Grid of Linear Triangles</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">vtkmesh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;ASCII</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">vtkmesh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DATASET UNSTRUCTURED_GRID</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">vtkmesh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;FIELD FieldData  1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">vtkmesh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;TIME 1 1 double</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">vtkmesh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;           0.00000</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">vtkmesh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="s2">&quot;POINTS &quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">{:3.0f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid3d</span><span class="p">[</span><span class="s2">&quot;nnod3&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot; float</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">vtkmesh</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid3d</span><span class="p">[</span><span class="s2">&quot;mesh3d_nodes&quot;</span><span class="p">],</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%1.6e</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid3d</span><span class="p">[</span><span class="s2">&quot;mesh3d_nodes&quot;</span><span class="p">])</span>
            <span class="n">ntetra</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid3d</span><span class="p">[</span><span class="s2">&quot;mesh_tetra&quot;</span><span class="p">])</span>
            <span class="n">numb</span> <span class="o">=</span> <span class="n">ntetra</span> <span class="o">*</span> <span class="mi">5</span>
            <span class="n">mesh_tretra_m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid3d</span><span class="p">[</span><span class="s2">&quot;mesh_tetra&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="c1"># np.shape(mesh_tretra_m)</span>
            <span class="n">tetra_mesh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">ntetra</span><span class="p">),</span> <span class="n">mesh_tretra_m</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
            <span class="n">vtkmesh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="s2">&quot;CELLS &quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">{:d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ntetra</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">{:d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">numb</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">vtkmesh</span><span class="p">,</span> <span class="n">tetra_mesh</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">vtkmesh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CELL_TYPES &quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">{:d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ntetra</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">vtkmesh</span><span class="p">,</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">ntetra</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">vtkmesh</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">pass</span></div>

<div class="viewcode-block" id="CATHY.create_mesh_vtkris3d_vtk2"><a class="viewcode-back" href="../../content/api/generated/DA.cathy_DA.CATHY.html#DA.cathy_DA.CATHY.create_mesh_vtkris3d_vtk2">[docs]</a>    <span class="k">def</span> <span class="nf">create_mesh_vtkris3d_vtk2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbose</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create mesh for vtk format version 2</span>


<span class="sd">        # vtk DataFile Version 2.0</span>
<span class="sd">        3D Unstructured Grid of Linear Triangles</span>
<span class="sd">        ASCII</span>
<span class="sd">        DATASET STRUCTURED_GRID</span>
<span class="sd">        FIELD FieldData  1</span>
<span class="sd">        TIME 1 1 double</span>
<span class="sd">                   0.00000</span>
<span class="sd">        POINTS     7056 float</span>
<span class="sd">        TETRA (5,NT)       - element connectivities in 3-d mesh (TETRA(5,I)</span>
<span class="sd">        # C                        indicates material type for 3-d element I)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;vtk/mesh_tmp.vtk&quot;</span><span class="p">),</span> <span class="s2">&quot;w+&quot;</span>
        <span class="p">)</span> <span class="k">as</span> <span class="n">vtkmesh</span><span class="p">:</span>
            <span class="n">vtkmesh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;# vtk DataFile Version 2.0</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">vtkmesh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;3D Unstructured Grid of Linear Triangles</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">vtkmesh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;ASCII</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">vtkmesh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DATASET UNSTRUCTURED_GRID</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">vtkmesh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;FIELD FieldData  1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">vtkmesh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;TIME 1 1 double</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">vtkmesh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;           0.00000</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">vtkmesh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="s2">&quot;POINTS &quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">{:3.0f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid3d</span><span class="p">[</span><span class="s2">&quot;nnod3&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot; float</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">vtkmesh</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid3d</span><span class="p">[</span><span class="s2">&quot;mesh3d_nodes&quot;</span><span class="p">],</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%1.6e</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid3d</span><span class="p">[</span><span class="s2">&quot;mesh3d_nodes&quot;</span><span class="p">])</span>
            <span class="n">ntetra</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid3d</span><span class="p">[</span><span class="s2">&quot;mesh_tetra&quot;</span><span class="p">])</span>
            <span class="n">numb</span> <span class="o">=</span> <span class="n">ntetra</span> <span class="o">*</span> <span class="mi">5</span>
            <span class="n">mesh_tretra_m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid3d</span><span class="p">[</span><span class="s2">&quot;mesh_tetra&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="c1"># np.shape(mesh_tretra_m)</span>
            <span class="n">tetra_mesh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">ntetra</span><span class="p">),</span> <span class="n">mesh_tretra_m</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
            <span class="n">vtkmesh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="s2">&quot;CELLS &quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">{:d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ntetra</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">{:d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">numb</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">vtkmesh</span><span class="p">,</span> <span class="n">tetra_mesh</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">vtkmesh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CELL_TYPES &quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">{:d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ntetra</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">vtkmesh</span><span class="p">,</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">ntetra</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">vtkmesh</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">pass</span></div>

<div class="viewcode-block" id="CATHY.create_mesh_vtk"><a class="viewcode-back" href="../../content/api/generated/DA.cathy_DA.CATHY.html#DA.cathy_DA.CATHY.create_mesh_vtk">[docs]</a>    <span class="k">def</span> <span class="nf">create_mesh_vtk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create custum mesh</span>
<span class="sd">        THIS SHOULD BE MOVED TO MESHTOOLS</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># if not &#39;nnod3&#39; in self.grid3d.keys():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_preprocessor</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_processor</span><span class="p">(</span><span class="n">IPRT1</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">create_mesh_vtkris3d_vtk2</span><span class="p">(</span><span class="n">verbose</span><span class="p">)</span>
        <span class="c1"># self.create_mesh_vtkris3d_vtk9()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mesh_pv_attributes</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">read</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;vtk/mesh_tmp.vtk&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mesh_pv_attributes</span><span class="o">.</span><span class="n">save</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;vtk/&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span> <span class="o">+</span> <span class="s2">&quot;.vtk&quot;</span>
            <span class="p">),</span>
            <span class="n">binary</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># THIS IS A TEMPORARY IMPLEMENTATION OF THE PYVISTA MESH</span>
        <span class="c1">#  https://docs.pyvista.org/examples/00-load/create-structured-surface.html</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="CATHY.update_mesh_vtk"><a class="viewcode-back" href="../../content/api/generated/DA.cathy_DA.CATHY.html#DA.cathy_DA.CATHY.update_mesh_vtk">[docs]</a>    <span class="k">def</span> <span class="nf">update_mesh_vtk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">prop_value</span><span class="o">=</span><span class="p">[],</span> <span class="n">replaceVTK</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        https://docs.pyvista.org/api/core/_autosummary/pyvista.ExplicitStructuredGrid.add_field_data.html#pyvista.ExplicitStructuredGrid.add_field_data</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        prop : TYPE, optional</span>
<span class="sd">            DESCRIPTION. The default is &#39;&#39;.</span>
<span class="sd">        prop_value : TYPE, optional</span>
<span class="sd">            DESCRIPTION. The default is [].</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mesh_pv_attributes</span><span class="o">.</span><span class="n">add_field_data</span><span class="p">(</span><span class="n">prop_value</span><span class="p">,</span> <span class="n">prop</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">replaceVTK</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mesh_pv_attributes</span><span class="o">.</span><span class="n">save</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;vtk/&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span> <span class="o">+</span> <span class="s2">&quot;.vtk&quot;</span>
                <span class="p">),</span>
                <span class="n">binary</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">pass</span></div>

<div class="viewcode-block" id="CATHY.map_dem_prop_2mesh"><a class="viewcode-back" href="../../content/api/generated/DA.cathy_DA.CATHY.html#DA.cathy_DA.CATHY.map_dem_prop_2mesh">[docs]</a>    <span class="k">def</span> <span class="nf">map_dem_prop_2mesh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop_name</span><span class="p">,</span> <span class="n">prop_map</span><span class="p">,</span> <span class="n">to_nodes</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Map DEM raster property to the CATHY mesh nodes/cells.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        prop_name : str</span>
<span class="sd">            DESCRIPTION.</span>
<span class="sd">        prop_map : list</span>
<span class="sd">            DESCRIPTION.</span>
<span class="sd">        to_nodes : bool, optional</span>
<span class="sd">            DESCRIPTION. The default is False.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        TYPE</span>
<span class="sd">            DESCRIPTION.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">to_nodes</span><span class="p">:</span>
            <span class="n">prop_mesh_nodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh_pv_attributes</span><span class="p">[</span><span class="s2">&quot;node_markers&quot;</span><span class="p">]))</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">prop_map</span><span class="p">)):</span>
                <span class="n">prop_mesh_nodes</span><span class="p">[</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">mesh_pv_attributes</span><span class="p">[</span><span class="s2">&quot;node_markers&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">m</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="p">]</span> <span class="o">=</span> <span class="n">prop_map</span><span class="p">[</span><span class="n">m</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mesh_pv_attributes</span><span class="p">[</span><span class="n">prop_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">prop_mesh_nodes</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">mesh_pv_attributes</span><span class="o">.</span><span class="n">save</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;vtk/&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span> <span class="o">+</span> <span class="s2">&quot;.vtk&quot;</span>
                <span class="p">),</span>
                <span class="n">binary</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">prop_mesh_nodes</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">prop_mesh_cells</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh_pv_attributes</span><span class="p">[</span><span class="s2">&quot;cell_markers&quot;</span><span class="p">]))</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">prop_map</span><span class="p">)):</span>
                <span class="n">prop_mesh_cells</span><span class="p">[</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">mesh_pv_attributes</span><span class="p">[</span><span class="s2">&quot;cell_markers&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">m</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="p">]</span> <span class="o">=</span> <span class="n">prop_map</span><span class="p">[</span><span class="n">m</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mesh_pv_attributes</span><span class="p">[</span><span class="n">prop_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">prop_mesh_cells</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">mesh_pv_attributes</span><span class="o">.</span><span class="n">save</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;vtk/&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span> <span class="o">+</span> <span class="s2">&quot;.vtk&quot;</span>
                <span class="p">),</span>
                <span class="n">binary</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mesh_pv_attributes</span><span class="o">.</span><span class="n">set_active_scalars</span><span class="p">(</span><span class="n">prop_name</span><span class="p">)</span>
            <span class="n">prop_mesh_nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_pv_attributes</span><span class="o">.</span><span class="n">cell_data_to_point_data</span><span class="p">()</span>

            <span class="k">return</span> <span class="n">prop_mesh_cells</span><span class="p">,</span> <span class="n">prop_mesh_nodes</span><span class="p">[</span><span class="n">prop_name</span><span class="p">]</span></div>

<div class="viewcode-block" id="CATHY.map_prop2mesh"><a class="viewcode-back" href="../../content/api/generated/DA.cathy_DA.CATHY.html#DA.cathy_DA.CATHY.map_prop2mesh">[docs]</a>    <span class="k">def</span> <span class="nf">map_prop2mesh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dict_props</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a given physical property to the CATHY mesh</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;mesh_pv_attributes&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_mesh_vtk</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mesh_pv_attributes</span>

        <span class="k">for</span> <span class="n">dp</span> <span class="ow">in</span> <span class="n">dict_props</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dict_props</span><span class="p">[</span><span class="n">dp</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="s2">&quot;Single value detected for &quot;</span>
                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span>
                    <span class="o">+</span> <span class="s2">&quot; ==&gt; assumming it homogeneous&quot;</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update_mesh_vtk</span><span class="p">(</span>
                    <span class="n">prop</span><span class="o">=</span><span class="n">dp</span><span class="p">,</span>
                    <span class="n">prop_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh_pv_attributes</span><span class="o">.</span><span class="n">points</span><span class="p">))</span>
                    <span class="o">*</span> <span class="n">dict_props</span><span class="p">[</span><span class="n">dp</span><span class="p">],</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update_mesh_vtk</span><span class="p">(</span><span class="n">prop</span><span class="o">=</span><span class="n">dp</span><span class="p">,</span> <span class="n">prop_value</span><span class="o">=</span><span class="n">dict_props</span><span class="p">[</span><span class="n">dp</span><span class="p">])</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="CATHY.map_prop_veg"><a class="viewcode-back" href="../../content/api/generated/DA.cathy_DA.CATHY.html#DA.cathy_DA.CATHY.map_prop_veg">[docs]</a>    <span class="k">def</span> <span class="nf">map_prop_veg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dict_props</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;veg_map&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;no known existing vegetation map.&quot;</span><span class="p">)</span>
            <span class="k">pass</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">map_veg_dict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">update_map_veg</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dict_props</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">map_veg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">veg_map</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dict_props</span><span class="p">[</span><span class="n">d</span><span class="p">]):</span>
                    <span class="n">map_veg</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">veg_map</span> <span class="o">==</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                <span class="n">update_map_veg</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">=</span> <span class="n">map_veg</span>

            <span class="k">return</span> <span class="n">update_map_veg</span></div>

<div class="viewcode-block" id="CATHY.map_prop2zone"><a class="viewcode-back" href="../../content/api/generated/DA.cathy_DA.CATHY.html#DA.cathy_DA.CATHY.map_prop2zone">[docs]</a>    <span class="k">def</span> <span class="nf">map_prop2zone</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dict_props</span><span class="p">,</span> <span class="n">prop</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;zone&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;no known existing zones.&quot;</span><span class="p">)</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">prop_zones</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zone</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zone</span><span class="p">))):</span>
                <span class="n">prop_zones</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">zone</span> <span class="o">==</span> <span class="n">z</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">dict_props</span><span class="p">[</span><span class="n">prop</span><span class="p">][</span><span class="n">z</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">prop_zones</span></div>

    <span class="c1"># ------------------------------------------------------------------------</span>
    <span class="c1">#%% Plot call</span>
    <span class="c1"># ------------------------------------------------------------------------</span>
<div class="viewcode-block" id="CATHY.show"><a class="viewcode-back" href="../../content/api/generated/DA.cathy_DA.CATHY.html#DA.cathy_DA.CATHY.show">[docs]</a>    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop</span><span class="o">=</span><span class="s2">&quot;hgsfdet&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call and parse to cathy.plotter from the main CATHY class</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        prop : str</span>
<span class="sd">            property to plot.</span>
<span class="sd">        **kwargs : kwargs</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_outputs</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">prop</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">prop</span> <span class="o">==</span> <span class="s2">&quot;hgsfdet&quot;</span><span class="p">:</span>
            <span class="n">plt_CT</span><span class="o">.</span><span class="n">show_hgsfdet</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">prop</span> <span class="o">==</span> <span class="s2">&quot;hgraph&quot;</span><span class="p">:</span>
            <span class="n">plt_CT</span><span class="o">.</span><span class="n">show_hgraph</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">prop</span> <span class="o">==</span> <span class="s2">&quot;cumflowvol&quot;</span><span class="p">:</span>
            <span class="n">plt_CT</span><span class="o">.</span><span class="n">show_COCumflowvol</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">prop</span> <span class="o">==</span> <span class="s2">&quot;dtcoupling&quot;</span><span class="p">:</span>
            <span class="n">plt_CT</span><span class="o">.</span><span class="n">show_dtcoupling</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">prop</span> <span class="o">==</span> <span class="s2">&quot;wtdepth&quot;</span><span class="p">:</span>
            <span class="n">plt_CT</span><span class="o">.</span><span class="n">show_wtdepth</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;no proxy to plot&quot;</span><span class="p">)</span>
        <span class="c1"># elif filename == &#39;psi&#39;:</span>
        <span class="c1">#     plt_CT.show_psi(path)</span>
        <span class="c1"># elif filename == &#39;sw&#39;:</span>
        <span class="c1">#     plt_CT.show_sw(path)</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="CATHY.show_bc"><a class="viewcode-back" href="../../content/api/generated/DA.cathy_DA.CATHY.html#DA.cathy_DA.CATHY.show_bc">[docs]</a>    <span class="k">def</span> <span class="nf">show_bc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">BCtypName</span><span class="o">=</span><span class="s2">&quot;nansfneubc&quot;</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Show bc&quot;&quot;&quot;</span>
        <span class="c1"># - atmbc spatially</span>
        <span class="c1"># nansfdirbc</span>
        <span class="c1"># nansfneubc</span>
        <span class="c1"># sfbc</span>
        <span class="c1"># fig, ax = plt.subplots(3,1,1)</span>
        <span class="c1"># df = self.read_inputs(filename=&#39;dirichlet&#39;)</span>
        <span class="c1"># df = self.update_nansfdirbc()</span>
        <span class="n">plt_CT</span><span class="o">.</span><span class="n">plot_mesh_bounds</span><span class="p">(</span><span class="n">BCtypName</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_bound_cond_df</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">ax</span><span class="p">)</span>

        <span class="c1"># self.init_boundary_conditions(BCtypName,time)</span>
        <span class="c1"># self.update_mesh_boundary_cond(time)</span>
        <span class="c1"># self.set_BC_laterals(time=time)</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="CATHY.show_input"><a class="viewcode-back" href="../../content/api/generated/DA.cathy_DA.CATHY.html#DA.cathy_DA.CATHY.show_input">[docs]</a>    <span class="k">def</span> <span class="nf">show_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop</span><span class="o">=</span><span class="s2">&quot;hgsfdet&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call and parse to cathy.plotter from the main CATHY class</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        prop : str</span>
<span class="sd">            property to plot.</span>
<span class="sd">        **kwargs : kwargs</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_inputs</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">prop</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">prop</span> <span class="o">==</span> <span class="s2">&quot;atmbc&quot;</span><span class="p">:</span>
            <span class="n">plt_CT</span><span class="o">.</span><span class="n">show_atmbc</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">prop</span> <span class="o">==</span> <span class="s2">&quot;root_map&quot;</span><span class="p">:</span>
            <span class="n">plt_CT</span><span class="o">.</span><span class="n">show_indice_veg</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">prop</span> <span class="o">==</span> <span class="s2">&quot;dem&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;hapin&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update_prepo_inputs</span><span class="p">()</span>
            <span class="n">hapin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hapin</span>
            <span class="n">plt_CT</span><span class="o">.</span><span class="n">show_dem</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">hapin</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">prop</span> <span class="o">==</span> <span class="s2">&quot;zone&quot;</span><span class="p">:</span>
            <span class="n">plt_CT</span><span class="o">.</span><span class="n">show_zone</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">prop</span> <span class="o">==</span> <span class="s2">&quot;soil&quot;</span><span class="p">:</span>

            <span class="c1"># in 2 dimensions</span>
            <span class="c1"># -------------</span>
            <span class="n">zone_mat</span> <span class="o">=</span> <span class="n">in_CT</span><span class="o">.</span><span class="n">read_zone</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;prepro/zone&quot;</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="n">layer_nb</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="s2">&quot;layer_nb&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">layer_nb</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;layer_nb&quot;</span><span class="p">]</span>

            <span class="n">yprop</span> <span class="o">=</span> <span class="s2">&quot;PERMX&quot;</span>
            <span class="k">if</span> <span class="s2">&quot;yprop&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">yprop</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;yprop&quot;</span><span class="p">]</span>

            <span class="n">soil_map</span> <span class="o">=</span> <span class="n">zone_mat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">zone_mat</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
                <span class="n">soil_map</span><span class="p">[</span><span class="n">zone_mat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">z</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">yprop</span><span class="p">]</span><span class="o">.</span><span class="n">xs</span><span class="p">(</span>
                    <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">layer_nb</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">z</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))]</span>
                <span class="p">)</span>  <span class="c1"># ,level=0)</span>
            <span class="n">plt_CT</span><span class="o">.</span><span class="n">show_soil</span><span class="p">(</span><span class="n">soil_map</span><span class="p">,</span> <span class="n">yprop</span><span class="o">=</span><span class="n">yprop</span><span class="p">,</span> <span class="n">layer_nb</span><span class="o">=</span><span class="n">layer_nb</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>

            <span class="c1"># in 3 dimensions</span>
            <span class="c1"># --------------</span>
            <span class="c1"># SPP = df[0].to_dict()</span>
            <span class="c1"># SoilPhysProp = self._prepare_SPP_tb(SPP)</span>
            <span class="c1"># soil_SPP_plot = {}</span>
            <span class="c1"># soil_SPP_plot[&#39;SPP&#39;] = SoilPhysProp # matrice with respect to zones</span>
            <span class="c1"># soil_SPP_plot[&#39;SPP_map&#39;] = SPP # mapping with respect to zones</span>
            <span class="c1"># self.map_prop2mesh(SPP)</span>

        <span class="k">elif</span> <span class="p">(</span><span class="s2">&quot;dtm_&quot;</span> <span class="ow">in</span> <span class="n">prop</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="s2">&quot;lakes_map&quot;</span> <span class="ow">in</span> <span class="n">prop</span><span class="p">):</span>
            <span class="n">raster_mat</span><span class="p">,</span> <span class="n">header_raster</span> <span class="o">=</span> <span class="n">in_CT</span><span class="o">.</span><span class="n">read_raster</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;prepro/&quot;</span> <span class="o">+</span> <span class="n">prop</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;hapin&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update_prepo_inputs</span><span class="p">()</span>
            <span class="n">hapin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hapin</span>
            <span class="n">plt_CT</span><span class="o">.</span><span class="n">show_raster</span><span class="p">(</span>
                <span class="n">raster_mat</span><span class="p">,</span> <span class="n">header_raster</span><span class="p">,</span> <span class="n">prop</span><span class="o">=</span><span class="n">prop</span><span class="p">,</span> <span class="n">hapin</span><span class="o">=</span><span class="n">hapin</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;no proxy to plot&quot;</span><span class="p">)</span>

        <span class="k">pass</span></div>

    <span class="c1">#%% Read outputs/inputs</span>
    <span class="c1"># ------------------------------------------------------------------------</span>
<div class="viewcode-block" id="CATHY.read_outputs"><a class="viewcode-back" href="../../content/api/generated/DA.cathy_DA.CATHY.html#DA.cathy_DA.CATHY.read_outputs">[docs]</a>    <span class="k">def</span> <span class="nf">read_outputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read CATHY format output file</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : str</span>
<span class="sd">            name of the output file to read.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        A dataframe or a dict describing file data/entries.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;output&quot;</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;path&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">filename</span>

        <span class="k">if</span> <span class="n">filename</span> <span class="o">==</span> <span class="s2">&quot;vp&quot;</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">out_CT</span><span class="o">.</span><span class="n">read_vp</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">df</span>
        <span class="k">elif</span> <span class="n">filename</span> <span class="o">==</span> <span class="s2">&quot;hgraph&quot;</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">out_CT</span><span class="o">.</span><span class="n">read_hgraph</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">df</span>
        <span class="k">elif</span> <span class="n">filename</span> <span class="o">==</span> <span class="s2">&quot;dtcoupling&quot;</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">out_CT</span><span class="o">.</span><span class="n">read_dtcoupling</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">df</span>
        <span class="k">elif</span> <span class="n">filename</span> <span class="o">==</span> <span class="s2">&quot;hgsfdet&quot;</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">out_CT</span><span class="o">.</span><span class="n">read_hgsfdet</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">df</span>
        <span class="k">elif</span> <span class="n">filename</span> <span class="o">==</span> <span class="s2">&quot;psi&quot;</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">out_CT</span><span class="o">.</span><span class="n">read_psi</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">df</span>
        <span class="k">elif</span> <span class="n">filename</span> <span class="o">==</span> <span class="s2">&quot;sw&quot;</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">out_CT</span><span class="o">.</span><span class="n">read_sw</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">df</span>
        <span class="k">elif</span> <span class="n">filename</span> <span class="o">==</span> <span class="s2">&quot;mbeconv&quot;</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">out_CT</span><span class="o">.</span><span class="n">read_mbeconv</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">df</span>
        <span class="k">elif</span> <span class="n">filename</span> <span class="o">==</span> <span class="s2">&quot;cumflowvol&quot;</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">out_CT</span><span class="o">.</span><span class="n">read_cumflowvol</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">df</span>
        <span class="k">elif</span> <span class="n">filename</span> <span class="o">==</span> <span class="s2">&quot;wtdepth&quot;</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">out_CT</span><span class="o">.</span><span class="n">read_wtdepth</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">df</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;no file specified&quot;</span><span class="p">)</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="CATHY.read_inputs"><a class="viewcode-back" href="../../content/api/generated/DA.cathy_DA.CATHY.html#DA.cathy_DA.CATHY.read_inputs">[docs]</a>    <span class="k">def</span> <span class="nf">read_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read CATHY format input file</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : str</span>
<span class="sd">            name of the input CATHY file to read.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        A dataframe or a dict describing file data/entries.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="o">==</span> <span class="s2">&quot;atmbc&quot;</span><span class="p">:</span>
            <span class="n">df</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">in_CT</span><span class="o">.</span><span class="n">read_atmbc</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">df</span>
        <span class="k">elif</span> <span class="n">filename</span> <span class="o">==</span> <span class="s2">&quot;dem&quot;</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">in_CT</span><span class="o">.</span><span class="n">read_dem</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;prepro/dem&quot;</span><span class="p">),</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;prepro/dtm_13.val&quot;</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">df</span>
        <span class="k">elif</span> <span class="n">filename</span> <span class="o">==</span> <span class="s2">&quot;root_map&quot;</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">in_CT</span><span class="o">.</span><span class="n">read_root_map</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">df</span>
        <span class="k">elif</span> <span class="n">filename</span> <span class="o">==</span> <span class="s2">&quot;soil&quot;</span><span class="p">:</span>
            <span class="n">dem_parm</span> <span class="o">=</span> <span class="n">in_CT</span><span class="o">.</span><span class="n">read_dem_parameters</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="s2">&quot;dem_parameters&quot;</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="n">df</span> <span class="o">=</span> <span class="n">in_CT</span><span class="o">.</span><span class="n">read_soil</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="n">filename</span><span class="p">),</span>
                <span class="n">dem_parm</span><span class="p">,</span>
                <span class="n">MAXVEG</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cathyH</span><span class="p">[</span><span class="s2">&quot;MAXVEG&quot;</span><span class="p">],</span>
            <span class="p">)</span>
            <span class="c1"># df[0]</span>
            <span class="k">return</span> <span class="n">df</span>
        <span class="k">elif</span> <span class="n">filename</span> <span class="o">==</span> <span class="s2">&quot;zone&quot;</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">in_CT</span><span class="o">.</span><span class="n">read_zone</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;prepro/zone&quot;</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">df</span>
        <span class="k">elif</span> <span class="n">filename</span> <span class="o">==</span> <span class="s2">&quot;zone&quot;</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">in_CT</span><span class="o">.</span><span class="n">read_zone</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;prepro/zone&quot;</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">df</span>

        <span class="k">elif</span> <span class="p">(</span><span class="s2">&quot;dtm_&quot;</span> <span class="ow">in</span> <span class="n">filename</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="s2">&quot;lakes_map&quot;</span> <span class="ow">in</span> <span class="n">filename</span><span class="p">):</span>
            <span class="n">raster_mat</span><span class="p">,</span> <span class="n">header_raster</span> <span class="o">=</span> <span class="n">in_CT</span><span class="o">.</span><span class="n">read_raster</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;prepro/&quot;</span> <span class="o">+</span> <span class="n">filename</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">raster_mat</span><span class="p">,</span> <span class="n">header_raster</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;unknown file requested&quot;</span><span class="p">)</span>
        <span class="k">pass</span></div>

    <span class="c1"># -------------------------------------------------------------------#</span>
    <span class="c1"># %% utils</span>
    <span class="c1"># -------------------------------------------------------------------#</span>

<div class="viewcode-block" id="CATHY.find_nearest_node"><a class="viewcode-back" href="../../content/api/generated/DA.cathy_DA.CATHY.html#DA.cathy_DA.CATHY.find_nearest_node">[docs]</a>    <span class="k">def</span> <span class="nf">find_nearest_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_coords</span><span class="p">,</span> <span class="n">grid3d</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find nearest mesh node</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        node_coords : list</span>
<span class="sd">            List of coordinates [[x,y,z],[x2,y2,z2]].</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        closest_idx : list</span>
<span class="sd">            Node indice in the grid3d.</span>
<span class="sd">        closest : list</span>
<span class="sd">            Node coordinate in the grid3d.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">node_coords</span><span class="p">)</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">node_coords</span> <span class="o">=</span> <span class="p">[</span><span class="n">node_coords</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">grid3d</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">grid3d</span> <span class="o">=</span> <span class="n">in_CT</span><span class="o">.</span><span class="n">read_grid3d</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">))</span>

        <span class="n">closest_idx</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">closest</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">nc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">node_coords</span><span class="p">):</span>
            <span class="c1"># euclidean distance</span>
            <span class="n">d</span> <span class="o">=</span> <span class="p">(</span>
                <span class="p">(</span><span class="n">grid3d</span><span class="p">[</span><span class="s2">&quot;nodes_idxyz&quot;</span><span class="p">][:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">nc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span>
                <span class="o">+</span> <span class="p">(</span><span class="n">grid3d</span><span class="p">[</span><span class="s2">&quot;nodes_idxyz&quot;</span><span class="p">][:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">nc</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span>
                <span class="o">+</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">grid3d</span><span class="p">[</span><span class="s2">&quot;nodes_idxyz&quot;</span><span class="p">][:,</span> <span class="mi">3</span><span class="p">])</span> <span class="o">-</span> <span class="nb">abs</span><span class="p">(</span><span class="n">nc</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span> <span class="o">**</span> <span class="mi">2</span>
            <span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span>
            <span class="n">closest_idx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">d</span><span class="p">))</span>
            <span class="n">closest</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">grid3d</span><span class="p">[</span><span class="s2">&quot;nodes_idxyz&quot;</span><span class="p">][</span><span class="n">closest_idx</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">1</span><span class="p">:])</span>
            <span class="n">threshold</span> <span class="o">=</span> <span class="mf">5e-1</span>
            <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">d</span><span class="p">)]</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span>
                    <span class="s2">&quot;:warning: [b]No node close to the required points![/b]&quot;</span>
                <span class="p">)</span>

        <span class="k">return</span> <span class="n">closest_idx</span><span class="p">,</span> <span class="n">closest</span></div>

<div class="viewcode-block" id="CATHY.rich_display"><a class="viewcode-back" href="../../content/api/generated/DA.cathy_DA.CATHY.html#DA.cathy_DA.CATHY.rich_display">[docs]</a>    <span class="k">def</span> <span class="nf">rich_display</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Star Wars Movies&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Describe the variable state and fate during the simulation with a rich table</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="s2">&quot;self.&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">title</span><span class="p">)))</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="CATHY.backup_simu"><a class="viewcode-back" href="../../content/api/generated/DA.cathy_DA.CATHY.html#DA.cathy_DA.CATHY.backup_simu">[docs]</a>    <span class="k">def</span> <span class="nf">backup_simu</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save a copy of the simulation for reuse within python</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        project_filename.pkl</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span> <span class="o">+</span> <span class="s2">&quot;.pkl&quot;</span><span class="p">),</span>
            <span class="s2">&quot;wb&quot;</span><span class="p">,</span>
        <span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">CATHY</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="CATHY.backup_results_DA"><a class="viewcode-back" href="../../content/api/generated/DA.cathy_DA.CATHY.html#DA.cathy_DA.CATHY.backup_results_DA">[docs]</a>    <span class="k">def</span> <span class="nf">backup_results_DA</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">meta_DA</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save minimal dataframes of the simulation for result visualisation within python</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        project_filename_df.pkl</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span> <span class="o">+</span> <span class="s2">&quot;_df.pkl&quot;</span>
            <span class="p">),</span>
            <span class="s2">&quot;wb&quot;</span><span class="p">,</span>
        <span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">meta_DA</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dict_parm_pert</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df_DA</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dict_obs</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;df_performance&quot;</span><span class="p">):</span>
                <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df_performance</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Archie&quot;</span><span class="p">):</span>
                <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Archie</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="CATHY.load_pickle_backup"><a class="viewcode-back" href="../../content/api/generated/DA.cathy_DA.CATHY.html#DA.cathy_DA.CATHY.load_pickle_backup">[docs]</a>    <span class="k">def</span> <span class="nf">load_pickle_backup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span> <span class="o">+</span> <span class="s2">&quot;_df.pkl&quot;</span>
            <span class="p">)</span>
        <span class="n">backup_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">all_names</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;meta_DA&quot;</span><span class="p">,</span>
            <span class="s2">&quot;dict_parm_pert&quot;</span><span class="p">,</span>
            <span class="s2">&quot;df_DA&quot;</span><span class="p">,</span>
            <span class="s2">&quot;dict_obs&quot;</span><span class="p">,</span>
            <span class="s2">&quot;df_performance&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Archie&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">backup_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
                    <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">all_names</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">except</span> <span class="ne">EOFError</span><span class="p">:</span>
                    <span class="k">break</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">dict_backup</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">names</span><span class="p">):</span>
            <span class="n">dict_backup</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">backup_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">dict_backup</span></div></div>
</pre></div>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By B. Mary<br/>
    
        &copy; Copyright 2022, B. Mary.<br/>
      Last updated on Feb 10, 2023.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="../../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>